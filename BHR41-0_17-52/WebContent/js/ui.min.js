var from="#/advanced";
angular.module("advanced.controllers",[]).controller("basicAdvancedCtrl",["$scope","$route","$routeParams","$location",function(a,b,d,c){a.tab=b.current.tab;a.section=b.current.section;a.warning=!1;null!=d.warn&&(a.warning=!0);a.acceptWarning=function(){c.search({});c.replace()}}]).controller("dhcpCtrl",["$scope","$route","$routeParams","DhcpSettings","NetworkConnections",function(a,b,d,c,e){a.tab=b.current.tab;a.section=b.current.section;null!=d.from&&(from="#/"+d.from.replace(RegExp("_","g"),"/"));
a.returnLink=from;a.dhcpSettings=c.get(function(){a.dhcpSettings.connection=e.get({id:0},function(){a.dhcpSettings.connection.displayName=unescape(a.dhcpSettings.connection.name)})})}]).controller("dhcpEditCtrl",["$scope","$route","$routeParams","$location","DhcpSettings","DhcpOptions","NetworkConnections",function(a,b,d,c,e,f,g){a.tab=b.current.tab;a.section=b.current.section;a.dhcpOptions=f.query();a.dhcpSettings=e.get(function(){a.connection=g.get({id:0},function(){a.connection.name=unescape(a.connection.name)});
a.dhcpStartIpAddress=splitIpArr(a.dhcpSettings.startIpAddress);a.dhcpEndIpAddress=splitIpArr(a.dhcpSettings.endIpAddress);var b=a.dhcpSettings.winsServer;0==b.length&&(b="0.0.0.0");a.dhcpWinsServer=splitIpArr(b)});a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.save=function(){a.dhcpSettings.mode=parseInt(a.dhcpSettings.mode);if(2==a.dhcpSettings.mode&&(a.errorMessages=validateIPv4DhcpSettings(splitIpArr(a.connection.ipAddress),a.dhcpStartIpAddress,a.dhcpEndIpAddress,splitIpArr(a.connection.subnetMask),
a.dhcpWinsServer,a.dhcpSettings.leaseTime),0!=a.errorMessages.length)){a.showErrorPage=!0;window.scrollTo(0,0);return}var b=getIpString(a.dhcpWinsServer);a.dhcpSettings.winsServer="0.0.0.0"!=b&&0!=a.dhcpSettings.mode?b:"";a.dhcpSettings.startIpAddress=getIpString(a.dhcpStartIpAddress);a.dhcpSettings.endIpAddress=getIpString(a.dhcpEndIpAddress);a.dhcpSettings.$update(function(){c.path("/advanced/dhcp")})}}]).controller("dhcpConnectionsCtrl",["$scope","$route","$location","DhcpConnections","NetworkConnections",
"Diagnostics","DhcpSettings","securityTips",function(a,b,d,c,e,f,g,h){a.tab=b.current.tab;a.section=b.current.section;a.showErrorPage=!1;a.adding=!1;a.showSettings=!1;a.lanIp="0.0.0.0";a.addStaticConnection=function(){a.name="new-host";a.ipAddress=[0,0,0,0];a.macAddress="00 00 00 00 00 00".split(" ");a.adding=!0;a.editing=!1;a.showSettings=!0;a.useStaticIp=!0};a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.saveStaticConnection=function(){a.errorMessages=[];0!=a.name.length&&(validateHostname(a.name)||
a.errorMessages.push("Host Name: Name may not contain spaces. Only letters, digits and the special characters dash (-), underscore (_) and dot (.) may be used. These special characters may not appear at the beginning or at the end of a name. The maximum length of a label (text between two dots) is 63."));for(var b=getMacString(a.macAddress),d=getIpString(a.ipAddress),e=splitIpArr(a.lanIp),f=0;f<a.devices.length;f++)if((a.editIndex!=f||!a.editing)&&d===a.devices[f].ipAddress){a.errorMessages.push("IP Address: IP address already exists in Wireless Broadband Router's database.");
break}"00:00:00:00:00:00"==b&&a.errorMessages.push("MAC Address: MAC address must consist of 6 fields. Each field's value must be between 00 and FF (in hexadecimal representation), without any spaces. The LSB of the first byte must be zero.");checkMacAddress(a,a.macAddress);"0.0.0.0"==d?a.errorMessages.push("IP Address: IP address may not be 0.0.0.0. IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces. At least one of the values must be greater than 0."):
validateIp(a.ipAddress)||a.errorMessages.push("IP Address: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces.");a.lanIp==d&&a.errorMessages.push("IP Address: The IP address "+d+" conflicts with Subnet connection's IP.");if(0==a.errorMessages.length){f=!0;if((a.ipAddress[0]&a.subnetMask[0])!=(e[0]&a.subnetMask[0])||(a.ipAddress[1]&a.subnetMask[1])!=(e[1]&a.subnetMask[1])||(a.ipAddress[2]&a.subnetMask[2])!=(e[2]&a.subnetMask[2])||(a.ipAddress[3]&a.subnetMask[3])!=
(e[3]&a.subnetMask[3]))f=!1;f||a.errorMessages.push("IP Address: The IP address "+d+" is illegal for any of the connections subnets.")}validateMac(b)||a.errorMessages.push("MAC Address: MAC address must consist of 6 fields. Each field's value must be between 00 and FF (in hexadecimal representation), without any spaces. The LSB of the first byte must be zero.");if(0==a.errorMessages.length){for(f=0;f<a.devices.length;f++)if((!a.editing||f!=a.editIndex)&&a.name===a.devices[f].name){a.errorMessages.push("Name: Name already exists in Wireless Broadband Router's database.");
a.errorMessages.push('If you are trying to make changes to the lease type on this interface, please edit the host name to make it unique (e.g. "Hostname-Ethernet" or "Hostname-WiFi")');break}for(f=0;f<a.devices.length;f++)if((!a.editing||f!=a.editIndex)&&b===a.devices[f].mac){a.errorMessages.push("MAC Address: MAC Address already exists in Wireless Broadband Router's database.");break}}0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.useStaticIp&&a.showSettings&&a.ipAdd!=d&&!a.useStaticIp&&
h.showMessage("DHCP Connection Update Warning","Changes to the DHCP connections table IP addresses won\u2019t take effect on the actual host table until the client device renews its DHCP lease. You can either wait until the lease expires and is renewed by the client, or you can manually renew the lease on the client."),a.editing&&b!=a.devices[a.editIndex].mac?c.remove({clientId:a.editIndex},function(){c.save({},{name:a.name,ipAddress:d,mac:b,staticAddress:a.useStaticIp},function(){a.adding=!1;a.refresh()})}):
c.save({},{name:a.name,ipAddress:d,mac:b,staticAddress:a.useStaticIp},function(){a.adding=!1;a.refresh()}))};a.doPingTest=function(b){f.save({destination:a.devices[b].ipAddress,count:4},function(){d.path("/advanced/diagnostics")})};a.editConnection=function(b){a.adding=!0;a.editing=!0;a.editIndex=b;b=a.devices[b];a.name=b.name;a.ipAddress=splitIpArr(b.ipAddress);a.ipAdd=b.ipAddress;a.macAddress=splitMacArr(b.mac);a.macAdd=b.mac;a.useStaticIp=b.staticCheckbox;a.showSettings=b.staticCheckbox};a.cancelStaticConnection=
function(){a.adding=!1;a.showSettings=!1};a.deleteConnection=function(b){c.remove({id:0,clientId:b},function(){a.refresh()})};a.refresh=function(){var b=g.get(function(){a.startAddress=splitIpArr(b.startIpAddress);a.endAddress=splitIpArr(b.endIpAddress)});a.conn=e.get({id:0},function(){a.lanIp=a.conn.ipAddress;a.subnetMask=splitIpArr(a.conn.subnetMask);a.conn.displayName=unescape(a.conn.name)});a.devices=c.query()};a.refresh()}]).controller("fwUpgradeCtrl",["$scope","$route","FirmwareUpgrade","Reboot",
"SystemSettings","$location","$templateCache",function(a,b,d,c,e,f,g){a.tab=b.current.tab;a.section=b.current.section;a.page=0;a.restarting=!1;a.inputfile=null;a.refresh=function(){a.stats=d.get()};a.refresh();a.errorPageOk=function(){a.showErrorPage=!1;a.page=0;window.scrollTo(0,0)};window.uploadDone=function(){a.isFileSubmitted&&(a.stats=d.get(function(){""==a.stats.standbyVersion||null==a.stats.standbyVersion?(a.errorMessages=["Invalid Firmware"],a.showErrorPage=!0):a.page=2;window.scrollTo(0,
0)}))};a.applyFirmware=function(){d.save({executeUpdate:!0});c.save(function(){window.setTimeout(a.testConnection,0)});a.page=3;window.scrollTo(0,0)};a.cancelFirmwareUpdate=function(){a.page=0;window.scrollTo(0,0)};a.submittingFile=function(){a.isFileSubmitted=!0};a.fileUpgradePage=function(){a.inputfile=null;a.page=1;window.scrollTo(0,0)};a.testConnection=function(){e.get(function(){window.setTimeout(a.testConnection,3E3)},function(b){401==b.status?(a.restarting=!0,g.removeAll(),f.path("/login").search({rebooting:"true"})):
window.setTimeout(a.testConnection,3E3)})}}]).controller("fwRestoreCtrl",["$scope","$route","FirmwareUpgrade","Reboot","SystemSettings","$location","$templateCache",function(a,b,d,c,e,f,g){a.tab=b.current.tab;a.section=b.current.section;a.valid=!1;a.restarting=!1;a.stats=d.get(function(){a.valid=""!==a.stats.restoreVersion});a.apply=function(){d.save({executeRestore:!0});c.save(function(){window.setTimeout(a.testConnection,0)});a.page=3};a.testConnection=function(){e.get(function(){window.setTimeout(a.testConnection,
3E3)},function(b){401==b.status?(a.restarting=!0,g.removeAll(),f.path("/login").search({rebooting:"true"})):window.setTimeout(a.testConnection,3E3)})}}]).controller("localAdminCtrl",["$scope","$route","$location","LocalAdmin","SystemSettings",function(a,b,d,c,e){a.tab=b.current.tab;a.section=b.current.section;a.sysSettings=e.get();a.locAdmin=c.get();a.save=function(){a.locAdmin.$update(function(){d.path("/advanced")})}}]).controller("remoteAdminCtrl",["$scope","$route","$routeParams","$location",
"RemoteAdmin","SystemSettings",function(a,b,d,c,e,f){a.tab=b.current.tab;a.section=b.current.section;a.sysSettings=f.get();a.remAdmin=e.get();a.fromString="?from=ad";b="";a.prev="";a.back="/advanced";if(null!=d.from){a.fromString="?from="+d.from+"-ad";a.back="/advanced/settings";d=d.from.split("-");for(e=0;e<d.length-1;e++)0!=e&&(b+="-"),b+=d[e];""!==b&&(a.prev="?from="+b)}else a.back="/advanced";a.save=function(){a.remAdmin.$update(function(){""==a.oldFrom?c.path(a.back).search({}):c.path(a.back).search({from:a.oldFrom})})}}]).controller("systemSettingsCtrl",
["$scope","$route","$routeParams","$location","SystemSettings",function(a,b,d,c,e){a.tab=b.current.tab;a.section=b.current.section;a.showErrorPage=!1;a.fromString="?from=settings";a.oldFrom="";a.prev="";if(null!=d.from){a.fromString="?from="+d.from+"-settings";b=d.from.split("-");"fw"==b[b.length-1]?a.back="/firewall/remoteadmin":"ad"==b[b.length-1]&&(a.back="/advanced/remoteadmin");for(d=0;d<b.length-1;d++)0!=d&&(a.oldFrom+="-"),a.oldFrom+=b[d];""!==a.oldFrom&&(a.prev="?from="+a.oldFrom)}else a.back=
"/advanced";a.sysSettings=e.get(function(){a.systemIpAddress=splitIpArr(a.sysSettings.systemRemoteHost);a.securityIpAddress=splitIpArr(a.sysSettings.securityRemoteHost)});a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.save=function(){a.errorMessages=[];validateLocalDomains(a.sysSettings.localDomain)||a.errorMessages.push("Domain Name: Name may not contain spaces. Only letters, digits and the special characters dash (-), underscore (_) and dot (.) may be used. These special characters may not appear at the beginning or at the end of a name. The maximum length of a label (text between two dots) is 63");
/^[a-z0-9]$|^[a-z0-9][a-z0-9\-\_]{0,}[a-z0-9]$/i.test(a.sysSettings.routerHostname)||a.errorMessages.push("Wireless Broadband Router's Hostname: Host name may contain only letters, digits and the special characters dash (-) and underscore (_), without any spaces. The special characters cannot appear at the beginning or the end of the name.");(isNaN(a.sysSettings.sessionLifetime)||60>a.sysSettings.sessionLifetime||7200<a.sysSettings.sessionLifetime)&&a.errorMessages.push("Session Lifetime: Please enter a numeric value between 60 and 7200.");
for(var b=[{title:"Primary HTTPS Management Port",port:parseInt(a.sysSettings.primaryHttpsPort)},{title:"Secondary HTTPS Management Port",port:parseInt(a.sysSettings.secondaryHttpsPort)},{title:"Primary ssh Port",port:parseInt(a.sysSettings.primarySshPort)},{title:"Secondary ssh Port",port:parseInt(a.sysSettings.secondarySshPort)}],d=0;d<b.length;d++)(isNaN(b[d].port)||1>b[d].port||65535<b[d].port)&&a.errorMessages.push(b[d].title+": Please enter a numeric value between 1 and 65535.");if(0==a.errorMessages.length)for(d=
0;d<b.length;d++)for(var e=d+1;e<b.length;e++)b[d].port==b[e].port&&a.errorMessages.push("Remote Administration: Port "+b[d].port+' cannot be used for both "'+b[d].title+'" and "'+b[e].title+'".');0==a.sysSettings.systemRemoteNotifyLevel||validateIp(a.systemIpAddress)?0!=a.sysSettings.systemRemoteNotifyLevel&&"0.0.0.0"===getIpString(a.systemIpAddress)&&a.errorMessages.push("Remote System Host IP Address: IP address may not be 0.0.0.0. IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces. At least one of the values must be greater than 0."):
a.errorMessages.push("Remote System Host IP Address: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces.");0==a.sysSettings.securityRemoteNotifyLevel||validateIp(a.securityIpAddress)?0!=a.sysSettings.securityRemoteNotifyLevel&&"0.0.0.0"===getIpString(a.securityIpAddress)&&a.errorMessages.push("Remote Security Host IP Address: IP address may not be 0.0.0.0. IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces. At least one of the values must be greater than 0."):
a.errorMessages.push("Remote Security Host IP Address: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces.");a.sysSettings.autoWanDhcpTimeout=parseInt(a.sysSettings.autoWanDhcpTimeout);b=a.sysSettings.autoWanDhcpTimeout;(""===b||isNaN(b)||0>b)&&a.errorMessages.push("DHCP Timeout: Please enter a numeric value between 0 and 4294967295.");0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.sysSettings.concurrentUsers=parseInt(a.sysSettings.concurrentUsers),
a.sysSettings.securityRemoteNotifyLevel=parseInt(a.sysSettings.securityRemoteNotifyLevel),a.sysSettings.systemRemoteNotifyLevel=parseInt(a.sysSettings.systemRemoteNotifyLevel),0!=a.sysSettings.systemRemoteNotifyLevel&&(a.sysSettings.systemRemoteHost=getIpString(a.systemIpAddress)),0!=a.sysSettings.securityRemoteNotifyLevel&&(a.sysSettings.securityRemoteHost=getIpString(a.securityIpAddress)),a.sysSettings.$update(function(){systemSettings=a.sysSettings;""==a.oldFrom?c.path(a.back).search({}):c.path(a.back).search({from:a.oldFrom})}))};
a.systemLowCapacityChanged=function(){a.sysSettings.systemLowCapacityNotificationEnabled||(a.sysSettings.securityLowCapacityNotificationEnabled=!0)};a.securityLowCapacityChanged=function(){a.sysSettings.securityLowCapacityNotificationEnabled||(a.sysSettings.systemLowCapacityNotificationEnabled=!0)}}]).controller("dateTimeCtrl",["$scope","$route","$routeParams","$location","DateTimeSettings",function(a,b,d,c,e){a.tab=b.current.tab;a.section=b.current.section;a.dateTimeSettings=e.get(function(){a.checkTime();
a.checkTempDateObj();for(var b=0;b<a.dateTimeSettings.servers.length;b++){var d={};d.name=a.dateTimeSettings.servers[b];d.id=b;a.dateTimeSettings.servers[b]=d}a.timezone=parseInt(a.dateTimeSettings.timeZone)});a.pageToShow=0;a.serverName="Name";a.showErrorPage=!1;a.tempDateObj=null;a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.syncNow=function(){};a.refresh=function(){void 0!=window?window.location.reload(!0):location.reload(!0)};a.togglePage=function(b){a.pageToShow=b;window.scrollTo(0,
0)};a.save=function(){for(var b=0;b<a.dateTimeSettings.servers.length;b++)a.dateTimeSettings.servers[b].hasOwnProperty("name")&&(a.dateTimeSettings.servers[b]=a.dateTimeSettings.servers[b].name);a.dateTimeSettings.timeZone=parseInt(a.dateTimeSettings.timeZone);a.dateTimeSettings.$update(function(){var b={autoTimeUpdate:a.dateTimeSettings.autoTimeUpdate,timeZone:parseInt(a.dateTimeSettings.timeZone),offset:parseInt(a.dateTimeSettings.offset),servers:a.dateTimeSettings.servers};e.update(b,function(){a.dateTimeSettings=
e.get(function(){for(var b=0;b<a.dateTimeSettings.servers.length;b++){var d={};d.name=a.dateTimeSettings.servers[b];d.id=b;a.dateTimeSettings.servers[b]=d}})})})};a.offsetToZone=function(){var b=a.offset/60;0==b?a.dateTimeSettings.timeZone=0:-5>=b&&-10<=b&&(a.dateTimeSettings.timeZone=b)};a.checkTime=function(){null!=d.tz&&(a.dateTimeSettings.timeZone=d.tz);a.offset=0;a.localTimeMoment=findTimeNow(a.dateTimeSettings);a.localTimeFormatted=a.localTimeMoment.format("MMM DD, YYYY HH:mm:ss")};a.checkTempDateObj=
function(){null!=d.tmplocalTime&&(a.tempDateObj={localTime:d.tmplocalTime},a.tempDateObj.timeZone=a.dateTimeSettings.timeZone,a.dateTimeSettings.autoTimeUpdate=!1,a.localTimeMoment=findTimeNow(a.tempDateObj),a.localTimeFormatted=a.localTimeMoment.format("MMM DD, YYYY HH:mm:ss"),a.tempDateObj.month=a.localTimeMoment.month(),a.tempDateObj.day=a.localTimeMoment.date(),a.tempDateObj.year=a.localTimeMoment.year(),a.tempDateObj.hours=a.localTimeMoment.hour(),a.tempDateObj.minutes=a.localTimeMoment.minute(),
a.tempDateObj.seconds=a.localTimeMoment.second())};a.checkTempObj=function(){a.dateTimeSettings.autoTimeUpdate&&(a.tempDateObj=null)};a.setTimeZone=function(){null==a.tempDateObj?c.path("/advanced/datetime").search({tz:a.dateTimeSettings.timeZone}):c.path("/advanced/datetime").search({tz:a.dateTimeSettings.timeZone,tmplocalTime:a.tempDateObj.localTime});c.replace();a.checkTime();a.checkTempDateObj()};a.setClock=function(){null==a.tempDateObj&&(a.tempDateObj={month:a.localTimeMoment.month(),day:a.localTimeMoment.date(),
year:a.localTimeMoment.year(),hours:a.localTimeMoment.hour(),minutes:a.localTimeMoment.minute(),seconds:a.localTimeMoment.second(),timeZone:a.dateTimeSettings.timeZone});10>a.tempDateObj.hours&&2>a.tempDateObj.hours.toString().length&&(a.tempDateObj.hours="0"+a.tempDateObj.hours);10>a.tempDateObj.minutes&&2>a.tempDateObj.minutes.toString().length&&(a.tempDateObj.minutes="0"+a.tempDateObj.minutes);10>a.tempDateObj.seconds&&2>a.tempDateObj.seconds.toString().length&&(a.tempDateObj.seconds="0"+a.tempDateObj.seconds);
a.togglePage(2)};a.calDate=function(){var b=a.tempDateObj.hours,d=a.tempDateObj.minutes,c=a.tempDateObj.year+"-"+(parseInt(a.tempDateObj.month)+1)+"-"+a.tempDateObj.day+"-"+a.tempDateObj.hours+"-"+a.tempDateObj.minutes+"-"+a.tempDateObj.seconds,e=-11==a.tempDateObj.timeZone?-7:a.tempDateObj.timeZone,c=moment.unix(moment.utc(moment(c,"YYYY-MM-DD-HH-mm-ss")).unix()-60*(new Date).getTimezoneOffset()-3600*e),l={};l.localTime=c.unix();l.timeZone=a.tempDateObj.timeZone;var l=findTimeNow(l),e=l.format("HH"),
l=l.format("mm"),q=!1,y=0,q=0;if(q=Number(e)==Number(b)&&Number(l)==Number(d)?!1:!0)q=4>b&&20<e?Number(b)-Number(e-24):20<b&&4>e?Number(b-24)-Number(e):Number(b)-Number(e),0!=q&&(y=3600*q),q=Number(d)-Number(l),0!=q&&(y+=60*q);a.tempDateObj.localTime=c.unix()+y;a.localTimeMoment=findTimeNow(a.tempDateObj);a.localTimeFormatted=a.localTimeMoment.format("MMM DD, YYYY HH:mm:ss")};a.applySetClock=function(){a.errorMessages=[];var b=a.tempDateObj.hours,d=a.tempDateObj.minutes,c=a.tempDateObj.seconds,k=
moment(a.tempDateObj.year+"-"+(parseInt(a.tempDateObj.month)+1)+"-"+a.tempDateObj.day,"YYYY-MM-DD");(""===b||isNaN(b)||0>b||23<b)&&a.errorMessages.push("Hours: Please enter a numeric value between 0 and 23.");(""===d||isNaN(d)||0>d||59<d)&&a.errorMessages.push("Minutes: Please enter a numeric value between 0 and 59.");(""===c||isNaN(c)||0>c||59<c)&&a.errorMessages.push("Seconds: Please enter a numeric value between 0 and 59.");k.isValid()||a.errorMessages.push("Local Date and Time:  Entered time or date value are incorrect.");
0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.calDate(),e.update({localTime:a.tempDateObj.localTime},function(){a.togglePage(0)}))};a.cancelSetClock=function(){a.tempDateObj=null;a.togglePage(0)};a.saveServer=function(){a.errorMessages=[];if(validateIpDomain(a.serverName)){for(var b=0;b<a.dateTimeSettings.servers.length;b++)a.dateTimeSettings.servers[b]=a.dateTimeSettings.servers[b].name;-1==a.editing?a.dateTimeSettings.servers.push(a.serverName):a.dateTimeSettings.servers[a.editing]=
a.serverName;a.save();a.togglePage(0)}else a.errorMessages.push("Server Address: The value must be a valid IP address or a valid domain name."),a.showErrorPage=!0,window.scrollTo(0,0)};a.addServer=function(){a.serverName="";a.editing=-1;a.togglePage(1);window.scrollTo(0,0)};a.editServer=function(b){a.serverName=a.dateTimeSettings.servers[b].name;a.editing=b;a.togglePage(1);window.scrollTo(0,0)};a.removeServer=function(b){for(var d=0;d<a.dateTimeSettings.servers.length;d++)a.dateTimeSettings.servers[d]=
a.dateTimeSettings.servers[d].name;a.dateTimeSettings.servers.splice(b,1);a.save()}}]).controller("configFileCtrl",["$scope","$route","$location","ConfigInfo","Reboot","Login","SystemSettings","$templateCache",function(a,b,d,c,e,f,g,h){a.tab=b.current.tab;a.section=b.current.section;a.loadFile=!1;a.completed=!1;a.showErrorPage=!1;a.inputFile=null;a.restarting=!1;window.uploadDone=function(){if(a.loadFile)var b=c.get(function(){b.successful?(e.save(function(){window.setTimeout(a.testConnection,0)}),
a.completed=!0):(a.errorMessages=["Configuration File: Bad format of configuration file."],a.showErrorPage=!0)})};a.testConnection=function(){g.get(function(){window.setTimeout(a.testConnection,3E3)},function(b){401==b.status?(a.restarting=!0,h.removeAll(),d.path("/login").search({rebooting:"true"})):window.setTimeout(a.testConnection,3E3)})};a.toggleShow=function(b){a.loadFile=!a.loadFile;0==b&&(a.inputFile=null)};a.errorPageOk=function(){a.showErrorPage=!1;a.loadFile=!1;a.completed=!1;a.isFileSubmitted=
!1;window.scrollTo(0,0)};a.submittingFile=function(){a.isFileSubmitted=!0};a.saving=function(){f.get(function(a){window.location="api/settings/configfile"})}}]).controller("diagnosticsCtrl",["$scope","$route","$rootScope","Diagnostics",function(a,b,d,c){a.tab=b.current.tab;a.section=b.current.section;a.destination="";a.pingCount=4;a.showErrorPage=!1;a.previousPath=d.pre_path;a.isCancelled=!1;a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.refresh=function(){var b=c.get(function(){a.destination=
b.destination;a.pingCount=b.count;a.total=b.count;a.status=b.running?1:0;a.testRan=!0;null==b.transmitted?b.running?window.setTimeout(a.refresh,1E3):a.testRan=!1:(a.sent=b.transmitted,a.received=b.received,0==a.received&&0==a.sent&&0==a.status&&(a.status=5),0==a.status&&a.sent!=a.total&&(a.status=4),0==a.status&&a.sent==a.total&&a.received!=a.sent&&(a.status=2),a.loss=0<a.sent?Math.floor((a.sent-a.received)/a.sent*100):0,a.isCancelled&&(a.status=4),0<a.received?(a.min=b.min.toFixed(2),a.max=b.max.toFixed(2),
a.average=b.average.toFixed(2),a.hasResults=!0):a.hasResults=!1,1==a.status&&b.transmitted!=b.count&&window.setTimeout(a.refresh,1E3))})};a.goButton=function(){a.isCancelled=!1;a.errorMessages=[];var b=a.destination.split("."),d=!1;(d=validateIp(b))||(d=validateIPv6(a.destination));b=validateGivenHostName(a.destination);d||b||a.errorMessages.push("Server Address: The value must be a valid IP address or a valid domain name.");(isNaN(a.pingCount)||1>a.pingCount||999<a.pingCount)&&a.errorMessages.push("Number of pings: Please enter a numeric value between 1 and 999.");
0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.status=-1,a.total=4,a.sent=0,a.received=0,a.loss=0,a.hasResults=!1,c.save({destination:a.destination,count:parseInt(a.pingCount)},function(){a.status=-1;a.refresh()}))};a.cancel=function(){a.isCancelled=!0;c.remove({})};a.refresh()}]).controller("defaultsCtrl",["$scope","$route","Defaults","Login","Reboot","SystemSettings","$location","$templateCache",function(a,b,d,c,e,f,g,h){a.tab=b.current.tab;a.section=b.current.section;a.restDefaults=
0;a.resetType=0;a.restarting=!1;a.defaults=function(){a.restDefaults=1};a.cancel=function(){a.restDefaults=0};a.restoreDefaults=function(){a.restDefaults=2;d.save({resetType:parseInt(a.resetType)},function(){e.save(function(){window.setTimeout(a.testConnection,0)})})};a.saving=function(){c.get(function(a){window.location="api/settings/configfile"})};a.testConnection=function(){f.get(function(){window.setTimeout(a.testConnection,3E3)},function(b){401==b.status?(a.restarting=!0,h.removeAll(),0==a.resetType?
g.path("/setup"):g.path("/login").search({rebooting:"true"})):window.setTimeout(a.testConnection,3E3)})}}]).controller("rebootCtrl",["$scope","$route","Reboot","SystemSettings","Login","$location","$templateCache",function(a,b,d,c,e,f,g){a.tab=b.current.tab;a.section=b.current.section;a.sysSettings=c.get();a.rebooting=!1;a.restarting=!1;a.reboot=function(){a.rebooting=!0;d.save(function(){window.setTimeout(a.testConnection,0)})};a.testConnection=function(){c.get(function(){window.setTimeout(a.testConnection,
3E3)},function(b){401==b.status?(a.restarting=!0,g.removeAll(),f.path("/login").search({rebooting:"true"})):window.setTimeout(a.testConnection,3E3)})}}]).controller("macCloningCtrl",["$scope","$route","$location","MacCloning",function(a,b,d,c){a.tab=b.current.tab;a.section=b.current.section;a.showErrorPage=!1;a.macCloning=c.get(function(){a.macAddress=splitMacArr(a.macCloning.mac)});a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.save=function(){a.errorMessages=[];a.macCloning.mac=
getMacString(a.macAddress);if(!validateMac(a.macCloning.mac))a.errorMessages=["MAC Address: MAC address must consist of 6 fields. Each field's value must be between 00 and FF (in hexadecimal representation), without any spaces. The LSB of the first byte must be zero."];else if(/[f\:]{17}$/i.test(a.macCloning.mac))a.errorMessages.push("MAC Address: MAC FF:FF:FF:FF:FF:FF is reserved for broadcast.");else if(!validateMac(a.macCloning.mac)||/[0\:]{17}$/i.test(a.macCloning.mac)||1==(parseInt(a.macAddress[0],
16)&1))a.errorMessages=["MAC Address: MAC address must consist of 6 fields. Each field's value must be between 00 and FF (in hexadecimal representation), without any spaces. The LSB of the first byte must be zero."];0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):a.macCloning.$update(function(){d.path("/advanced")})};a.restore=function(){a.macAddress=splitMacArr(a.macCloning.defaultMac)}}]).controller("usersCtrl",["$scope","$route","$routeParams","$location","Users","SystemSettings",
function(a,b,d,c,e,f){a.tab=b.current.tab;a.section=b.current.section;a.sysSettings=f.get();a.updateContent=function(){a.userObj=e.get(function(){a.user=a.userObj.users[0];a.userObj.users[0].fullName=unescape(a.userObj.users[0].fullName);null!=d.edit&&a.edit(0)})};a.updateContent();a.pageToShow=0;a.editing=-1;a.showErrorPage=!1;a.setPassword=!1;a.showPassword=!1;a.userObjs=null;a.newPass=!1;a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.save=function(){a.errorMessages=[];var b=
Number(a.userObj.maxLoginAttempts);(isNaN(b)||1>b||99<b)&&a.errorMessages.push("Maximum Unsuccessful Login Attempts: Please enter a numeric value between 1 and 99.");0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):e.update({maxLoginAttempts:b},function(){void 0!=window?window.location.reload(!0):location.reload(!0)})};a.togglePage=function(b){0==b?null!=d.frommain?c.url(c.path("/main")):(a.pageToShow=b,a.updateContent()):a.pageToShow=b;window.scrollTo(0,0)};a.edit=function(b){a.newName=
a.userObj.users[0].fullName;a.newPassword="";a.rtNewPassword="";a.setPassword=!1;a.editing=b;a.togglePage(1)};a.saveUserCfm=function(){e.update({users:[a.userObjs]},function(){a.userObj.users[0].fullName=unescape(a.userObj.users[0].fullName);a.newPass?c.path("/logout"):a.togglePage(0)})};a.saveUser=function(){a.userObjs={id:0};a.errorMessages=[];""==a.newName&&a.errorMessages.push("Full Name: A string must be specified.");a.newPass=!1;a.setPassword&&(0==a.newPassword.length&&0==a.rtNewPassword.length&&
a.errorMessages.push("New Password: A password must be specified."),a.newPassword!=a.rtNewPassword&&a.errorMessages.push("Incorrect New Password: Entered passwords mismatch."),0==a.errorMessages.length&&(a.user.password=a.newPassword),a.userObjs.salt=uuid(),a.userObjs.password=CryptoJS.SHA512(a.newPassword+a.userObjs.salt).toString(),a.newPass=!0);0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.userObjs.fullName=escape(a.newName).replace(/\+/g,"%2B"),a.newPass?!0==a.sysSettings.warnBeforeChanges?
a.togglePage(2):a.saveUserCfm():a.saveUserCfm())}}]).controller("schedulerCtrl",["$scope","$route","Schedules","DateTimeSettings",function(a,b,d,c){a.tab=b.current.tab;a.section=b.current.section;init_schedules(a);a.pageToShow=0;a.editing=!1;a.showErrorPage=!1;a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.save=function(){a.schedules.$update(function(){void 0!=window?window.location.reload(!0):location.reload(!0)})};a.refresh=function(){a.schedules=d.query(function(){for(var b=
0;b<a.schedules.length;b++)a.schedules[b].name=unescape(a.schedules[b].name);a.printSchedArr=[];printSchedule(0,a.schedules,a.printSchedArr);a.dateTimeSettings=c.get(function(){a.localTimeMoment=findTimeNow(a.dateTimeSettings);for(var b=0;b<a.schedules.length;b++)a.schedules[b].status=isScheduleActive(a.schedules[b],a.localTimeMoment)})})};a.refresh();a.togglePage=function(b){a.pageToShow=b;window.scrollTo(0,0)};a.removeSchedule=function(b){d.remove({id:a.schedules[b].id},function(){a.refresh()})};
a.applyRuleScheduler=function(){a.errorMessages=[];""===a.schedule.name&&a.errorMessages.push("Description: A string must be specified.");for(var b=0;b<a.schedules.length;b++)if(b!=a.editingRuleSchedule&&a.schedules[b].name==a.schedule.name){a.errorMessages.push("Name: This name is already used by another scheduler rule.");break}0==a.schedule.timeSegments.length&&a.errorMessages.push("Rule Schedule: At least one time segment should be defined.");if(0<a.errorMessages.length)a.showErrorPage=!0,window.scrollTo(0,
0);else{var c={};copySchedule(c,a.schedule);for(b=0;b<c.timeSegments.length;b++)for(var g=0;g<c.timeSegments[b].hourRanges.length;g++)c.timeSegments[b].hourRanges[g].startTimeHour=parseInt(c.timeSegments[b].hourRanges[g].startTimeHour),c.timeSegments[b].hourRanges[g].startTimeMinute=parseInt(c.timeSegments[b].hourRanges[g].startTimeMinute),c.timeSegments[b].hourRanges[g].endTimeHour=parseInt(c.timeSegments[b].hourRanges[g].endTimeHour),c.timeSegments[b].hourRanges[g].endTimeMinute=parseInt(c.timeSegments[b].hourRanges[g].endTimeMinute);
c.name=escape(a.schedule.name).replace(/\+/g,"%2B");-1==a.editingRuleSchedule?d.save(c,function(){a.refresh()}):(c.id=a.schedules[a.editingRuleSchedule].id,d.update(c,function(){a.refresh()}));a.togglePage(0);init_schedules(a)}};a.formatTimeString=function(a,b){return(10>a?"0"+a:a)+":"+(10>b?"0"+b:b)};a.applyTimeSegment=function(){a.errorMessages=[];for(var b=!1,d=0;d<a.daysOfTheWeek.length;d++)a.daysOfTheWeek[d]&&(b=!0);b||a.errorMessages.push("Days of Week: At least one day must be selected.");
0==a.hourRanges.length&&a.errorMessages.push("Hours Range: At least one hour range must be set.");0<a.errorMessages.length?a.showErrorPage=!0:applyTimeSegment(a);window.scrollTo(0,0)};a.applyHourRange=function(){a.errorMessages=[];var b=a.hourRange.startTimeHour,d=a.hourRange.endTimeHour,c=a.hourRange.startTimeMinute,h=a.hourRange.endTimeMinute;(""===b||isNaN(b)||0>b||23<b)&&a.errorMessages.push("Start Time Hour: Please enter a numeric value between 0 and 23.");(""===d||isNaN(d)||0>d||23<d)&&a.errorMessages.push("End Time Hour: Please enter a numeric value between 0 and 23.");
(""===c||isNaN(c)||0>c||59<c)&&a.errorMessages.push("Start Time Minutes: Please enter a numeric value between 0 and 59.");(""===h||isNaN(h)||0>h||59<h)&&a.errorMessages.push("End Time Minutes: Please enter a numeric value between 0 and 59.");0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.hourRange.startTimeHour=parseInt(a.hourRange.startTimeHour),a.hourRange.startTimeMinute=parseInt(a.hourRange.startTimeMinute),a.hourRange.endTimeHour=parseInt(a.hourRange.endTimeHour),a.hourRange.endTimeMinute=
parseInt(a.hourRange.endTimeMinute),applyHourRange(a))};a.cancelRuleScheduler=function(){cancelRuleScheduler(a)};a.cancelTimeSegment=function(){cancelTimeSegment(a)};a.cancelHourRange=function(){cancelHourRange(a)};a.editSchedule=function(b){editRuleScheduler(a,a.schedules,b)};a.editTimeSegment=function(b){editTimeSegment(a,b)};a.editHourRange=function(b){editHourRange(a,b)};a.removeTimeSegment=function(b){removeObject(a.schedule.timeSegments,b)};a.removeHourRange=function(b){removeObject(a.hourRanges,
b)}}]).controller("networkObjectCtrl",["$scope","$route","NetworkObjects","Devices",function(a,b,d,c){a.tab=b.current.tab;a.section=b.current.section;a.networkObjects=d.query(function(){for(var b=0;b<a.networkObjects.length;b++)a.networkObjects[b].name=unescape(a.networkObjects[b].name);a.printAddArr=[];printAddresses(1,a.networkObjects,a.printAddArr)});init_networkObjs(a);a.pageToShow=0;a.editing=-1;a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.togglePage=function(b){a.pageToShow=
b};a.addNetworkObject=function(){init_networkObjs(a);a.togglePage(1);a.editing=-1};a.loadDeviceData=function(b){a.devices=c.query();a.macSelect=-1;a.togglePage(2)};a.copyMacAddress=function(){var b=macSelecter.value;a.rule.mac=-1!=b?splitMacArr(a.devices[b].mac):splitMacArr("00:00:00:00:00:00");a.rule.macMask=splitMacArr("ff:ff:ff:ff:ff:ff")};a.applyNetworkObj=function(){a.errorMessages=[];if(""===a.networkObj.name)a.errorMessages.push("Description: A string must be specified.");else for(var b=0;b<
a.networkObjects.length;b++)a.editingNetworkObj!=b&&a.networkObj.name===a.networkObjects[b].name&&a.errorMessages.push("Description: This name is already used by another network object.");0==a.networkObj.rules.length&&a.errorMessages.push("Items: At least one item entry must be defined.");0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(b={},copyNetworkObj(b,a.networkObj),a.networkObj.name=escape(a.networkObj.name),-1==a.editingNetworkObj?d.save(b,function(){a.networkObjects=d.query(function(){a.printAddArr=
[];printAddresses(1,a.networkObjects,a.printAddArr)})}):d.update({id:a.networkObjects[a.editing].id},b,function(){a.networkObjects=d.query(function(){a.printAddArr=[];printAddresses(1,a.networkObjects,a.printAddArr)})}),a.togglePage(0),init_schedules(a))};a.applyAddress=function(){applyAddressCheck(a);0==a.errorMessages&&applyAddress(a)};a.cancelNetworkObj=function(){cancelNetworkObj(a);a.editing=-1};a.cancelAddress=function(){cancelAddress(a)};a.editNetworkObj=function(b){editNetworkObj(a,a.networkObjects,
b);a.editing=b};a.editAddress=function(b){editAddress(a,b)};a.removeNetworkObj=function(b){d.remove({id:a.networkObjects[b].id},function(){a.networkObjects=d.query(function(){a.printAddArr=[];printAddresses(1,a.networkObjects,a.printAddArr)})})};a.removeAddress=function(b){removeObject(a.networkObj.rules,b)}}]).controller("portForwardRuleCtrl",["$scope","$route","PortForwardRules","StaticNAT","PortForward",function(a,b,d,c,e){a.tab=b.current.tab;a.section=b.current.section;a.showErrorPage=!1;init_services(a);
a.tempPortForward={name:"Global Application",description:"",servType:1,protocols:[]};a.pageToShow=0;a.editing=-1;a.showBasic=!1;a.togglePage=function(b){a.pageToShow=b;window.scrollTo(0,0)};a.toggleBasic=function(){a.showBasic=!a.showBasic;window.scrollTo(0,0)};a.refresh=function(){a.nat=c.query();a.forwards=e.query();a.portForwardRules=d.query(function(){a.portForwardRules=sortListItems(a.portForwardRules);a.printProtArr=[];printProtocol(1,a.portForwardRules,a.printProtArr)})};a.refresh();a.errorPageOk=
function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.applyPortForwardRule=function(){a.errorMessages=[];""==a.tempPortForward.name?a.errorMessages.push("Service Name: A name must be specified."):/^[0-9A-Z\!\-\_]+$/i.test(a.tempPortForward.name)||a.errorMessages.push('Service Name: Rule name should consist of standard characters only (ASCII 32-126) excluding the special character space and any of :@"|\\/=+<>()[]{}&%^$*?,;');for(var b=0;b<a.portForwardRules.length;b++)b!=a.editing&&a.portForwardRules[b].name==
a.tempPortForward.name&&a.errorMessages.push("Service Name: This name is already used by another protocol.");0==a.tempPortForward.protocols.length&&a.errorMessages.push("Server Ports: At least one server ports entry must be defined.");if(0<a.errorMessages.length)a.showErrorPage=!0,window.scrollTo(0,0);else{var c={};c.name=escape(a.tempPortForward.name).replace(/\+/g,"%2B");c.description=escape(a.tempPortForward.description).replace(/\+/g,"%2B");c.servType=a.tempPortForward.servType;c.protocols=[];
for(b=0;b<a.tempPortForward.protocols.length;b++){var e={};copyProtocol(e,a.tempPortForward.protocols[b]);c.protocols.push(e)}-1==a.editing?d.save(c,function(){a.refresh()}):d.update({id:a.portForwardRules[a.editing].id},c,function(){a.refresh()});init_services(a);a.tempPortForward={name:"Global Application",description:"",servType:1,protocols:[]};a.editing=-1;a.togglePage(0)}};a.applyProtocol=function(){a.errorMessages=[];a.protocols.protocol=parseInt(a.protocols.protocol);a.protocols.incomingPorts=
parseInt(a.protocols.incomingPorts);a.protocols.outgoingPorts=parseInt(a.protocols.outgoingPorts);a.protocols.icmpMessage=parseInt(a.protocols.icmpMessage);a.protocols.protocolNumber=parseInt(a.protocols.protocolNumber);var b=a.protocols.incomingPortStart,d=a.protocols.incomingPortEnd,c=a.protocols.outgoingPortStart,e=a.protocols.outgoingPortEnd;switch(a.protocols.protocol){case 0:var l=a.protocols.protocolNumber;(null==l||""===l||isNaN(l)||0>l||255<l)&&a.errorMessages.push("Protocol Number: Please enter a numeric value between 0 and 255.");
break;case 1:case 2:switch(a.protocols.incomingPorts){case 1:(null==b||""===b||1>b||65535<b)&&a.errorMessages.push("Source Port: Please enter a numeric value between 1 and 65535.");break;case 2:(null==b||""===b||1>b||65535<b)&&a.errorMessages.push("Start Source Port: Please enter a numeric value between 1 and 65535."),(null==d||""===d||1>d||65535<d)&&a.errorMessages.push("End Source Port: Please enter a numeric value between 1 and 65535."),0==a.errorMessages.length&&b>=d&&a.errorMessages.push("Source Ports: The From value must be lower than the To value in a range of ports (from="+
b+", to="+d+").")}switch(a.protocols.outgoingPorts){case 1:(null==c||""===c||1>c||65535<c)&&a.errorMessages.push("Destination Port: Please enter a numeric value between 1 and 65535.");4567==c&&!1==a.protocols.outgoingExclude&&1==a.protocols.protocol&&a.errorMessages.push("Invalid rule: Port 4567 cannot be blocked");break;case 2:(null==c||""===c||1>c||65535<c)&&a.errorMessages.push("Start Destination Port: Please enter a numeric value between 1 and 65535."),(null==e||""===e||1>e||65535<e)&&a.errorMessages.push("End Destination Port: Please enter a numeric value between 1 and 65535."),
0==a.errorMessages.length&&c>=e&&a.errorMessages.push("Destination Ports: The From value must be lower than the To value in a range of ports (from="+c+", to="+e+").")}break;case 3:if(10==a.protocols.icmpMessage){var l=a.protocols.icmpType,q=a.protocols.icmpCode;(null==l||""===l||0>l||255<l)&&a.errorMessages.push("ICMP Type:  Please enter a numeric value between 0 and 255.");(null==q||""===q||0>q||255<q)&&a.errorMessages.push("ICMP Code:  Please enter a numeric value between 0 and 255.")}}0!=a.errorMessages.length||
1!=a.protocols.protocol&&2!=a.protocols.protocol||(q=l=!1,0==a.protocols.incomingPorts?l=!0:2==a.protocols.incomingPorts&&!1==a.protocols.incomingExclude&&1==b&&65535==d&&(l=!0),0==a.protocols.outgoingPorts?q=!0:2==a.protocols.outgoingPorts&&!1==a.protocols.outgoingExclude&&1==c&&65535==e&&(q=!0),l&&q&&a.errorMessages.push('Port forwarding rules can not be Any-to-Any (or "source: 1-65535" with "destination: 1-65535").'));0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.protocols.icmpType=
parseInt(a.protocols.icmpType),a.protocols.icmpCode=parseInt(a.protocols.icmpCode),applyProtocol(a,a.tempPortForward.protocols),printProtocol(2,a.tempPortForward.protocols,a.printPortsArr))};a.cancelPortForwardRule=function(){cancelService(a);a.tempPortForward={name:"Global Application",description:"",protocols:[]}};a.cancelProtocol=function(){cancelProtocol(a)};a.editPortForwardRule=function(b){a.tempPortForward.name=a.portForwardRules[b].name;a.tempPortForward.description=a.portForwardRules[b].description;
a.tempPortForward.servType=a.portForwardRules[b].servType;a.tempPortForward.protocols=[];for(var d=0;d<a.portForwardRules[b].protocols.length;d++){var c={};copyProtocol(c,a.portForwardRules[b].protocols[d]);a.tempPortForward.protocols.push(c)}a.printPortsArr=[];printProtocol(2,a.tempPortForward.protocols,a.printPortsArr);a.editing=b;a.togglePage(3)};a.editProtocol=function(b){editProtocol(a,b,a.tempPortForward.protocols)};a.removePortForwardRule=function(b){a.errorMessages=[];for(var c=a.portForwardRules[b].name,
e=0;e<a.nat.length;e++)for(var k=0;k<a.nat[e].services.length;k++)if(c===a.nat[e].services[k].name){a.errorMessages.push("Protocol: Protocol is in use.");break}if(0==a.errorMessages.length)for(e=0;e<a.forwards.length;e++)for(k=0;k<a.forwards[e].protocols.length;k++)if(c===a.forwards[e].name){a.errorMessages.push("Protocol: Protocol is in use.");break}0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):d.remove({id:a.portForwardRules[b].id},function(){a.portForwardRules=d.query(function(){a.portForwardRules=
sortListItems(a.portForwardRules);a.printProtArr=[];printProtocol(1,a.portForwardRules,a.printProtArr)})})};a.removeProtocol=function(b){removeObject(a.tempPortForward.protocols,b);a.printPortsArr=[];printProtocol(2,a.tempPortForward.protocols,a.printPortsArr)}}]).controller("dnsServerCtrl",["$scope","$route","DnsServer","securityTips",function(a,b,d,c){a.tab=b.current.tab;a.section=b.current.section;a.dnsServer=d.query();a.showErrorPage=!1;a.showAdd=!1;a.editing=-1;a.errorPageOk=function(){a.showErrorPage=
!1;window.scrollTo(0,0)};a.validateBeforeSave=function(){a.errorMessages=[];validateHostname(a.tempDnsServer.hostname)||a.errorMessages.push("Host Name: Name may not contain spaces. Only letters, digits and the special characters dash (-), underscore (_) and dot (.) may be used. These special characters may not appear at the beginning or at the end of a name. The maximum length of a label (text between two dots) is 63.");validateIp(a.tempDnsServer.ipAddress)?"0.0.0.0"===getIpString(a.tempDnsServer.ipAddress)&&
a.errorMessages.push("IP Address: IP address may not be 0.0.0.0. IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces. At least one of the values must be greater than 0."):a.errorMessages.push("IP Address: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces.");for(var b=0;b<a.dnsServer.length;b++)a.editing!=b&&(a.tempDnsServer.hostname==a.dnsServer[b].hostname&&a.errorMessages.push("Host Name: This name is already used by another DNS object."),
getIpString(a.tempDnsServer.ipAddress)==a.dnsServer[b].ipAddress&&a.errorMessages.push("IP Address:You have entered an IP address that already exists. Please enter new IP address."));0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):hasADot(a.tempDnsServer.hostname)?c.showWarningMsgBeforeSaving("DNS Entry","Hostnames including a period (.) may not resolve correctly.",[""]).then(function(b){"cancel"!=b&&a.save()}):a.save()};a.save=function(){var b={hostname:a.tempDnsServer.hostname,
type:a.tempDnsServer.type};1==b.type&&(b.ipAddress=getIpString(a.tempDnsServer.ipAddress));-1==a.editing?d.save(b,function(){a.dnsServer=d.query()}):d.update({id:a.dnsServer[a.editing].id},b,function(){a.dnsServer=d.query()});a.tempDnsServer={};a.toggleShow()};a.toggleShow=function(){a.showAdd=!a.showAdd};a.addDnsEntry=function(){a.tempDnsServer={hostname:"new-host",type:1,ipAddress:[0,0,0,0]};a.editing=-1;a.toggleShow()};a.editDnsEntry=function(b){a.editing=b;a.tempDnsServer={hostname:a.dnsServer[a.editing].hostname,
type:a.dnsServer[a.editing].type};1==a.tempDnsServer.type&&(a.tempDnsServer.ipAddress=splitIpArr(a.dnsServer[a.editing].ipAddress));a.showAdd=!a.showAdd};a.removeDnsEntry=function(b){d.remove({id:a.dnsServer[b].id},function(){a.dnsServer=d.query()})}}]).controller("ipv6Ctrl",["$scope","$route","$location","IPv6",function(a,b,d,c){a.tab=b.current.tab;a.section=b.current.section;a.ipv6=c.get(function(){a.ipv6.addressStart=a.ipv6.addressStart.toString(16);a.ipv6.addressEnd=a.ipv6.addressEnd.toString(16);
for(var b=0;b<a.ipv6.interfaces.length;b++)a.ipv6.interfaces[b].name=unescape(a.ipv6.interfaces[b].name);a.autoDns=1==a.ipv6.mode?a.ipv6.autoDns:0});a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.save=function(){if(a.ipv6.enabled){a.errorMessages=[];a.ipv6.autoDns=a.autoDns;if(2==a.ipv6.mode)if(a.ipv6.staticAddress=a.ipv6.staticAddress.replace(/^\s+|\s+$/g,""),a.ipv6.staticDefaultGateway=a.ipv6.staticDefaultGateway.replace(/^\s+|\s+$/g,""),a.ipv6.staticPrimaryDns=a.ipv6.staticPrimaryDns.replace(/^\s+|\s+$/g,
""),a.ipv6.staticSecondaryDns=a.ipv6.staticSecondaryDns.replace(/^\s+|\s+$/g,""),validateIPv6(a.ipv6.staticAddress)||a.errorMessages.push("IPv6 WAN Address: Invalid IP Address."),(isNaN(a.ipv6.staticPrefixLength)||16>a.ipv6.staticPrefixLength||128<a.ipv6.staticPrefixLength)&&a.errorMessages.push("Prefix Length: Please enter a numeric value between 16 and 128."),validateIPv6(a.ipv6.staticDefaultGateway)||a.errorMessages.push("IPv6 Default Gateway: Invalid IP Address."),validateIPv6(a.ipv6.staticPrimaryDns)||
""!=a.ipv6.staticPrimaryDns&&a.errorMessages.push("Primary DNS Server: Invalid IP Address."),validateIPv6(a.ipv6.staticSecondaryDns)||""!=a.ipv6.staticSecondaryDns&&a.errorMessages.push("Secondary DNS Server: Invalid IP Address."),validateIPv6(a.ipv6.lanPrefix)){var b=getPrefixLength(a.ipv6.lanPrefix);16>b||128==b?a.errorMessages.push("LAN Prefix: Invalid LAN prefix."):a.ipv6.lanPrefix=a.ipv6.lanPrefix+"/"+b}else validatePrefixLength(a.ipv6.lanPrefix)||a.errorMessages.push("LAN Prefix: Invalid LAN prefix.");
else 1==a.ipv6.mode&&1==a.ipv6.autoDns&&(a.ipv6.staticPrimaryDns=a.ipv6.staticPrimaryDns.replace(/^\s+|\s+$/g,""),a.ipv6.staticSecondaryDns=a.ipv6.staticSecondaryDns.replace(/^\s+|\s+$/g,""),validateIPv6(a.ipv6.staticPrimaryDns)||a.errorMessages.push("Primary DNS Server: Invalid IP Address."),validateIPv6(a.ipv6.staticSecondaryDns)||a.errorMessages.push("Secondary DNS Server: Invalid IP Address."));if(1==a.ipv6.lanMode)if(""===a.ipv6.addressStart||""===a.ipv6.addressEnd)a.errorMessages.push("LAN IPv6 Address Range: Please enter a numeric value between 2 and ffff");
else if(/^[0-9A-F]+$/i.test(a.ipv6.addressStart)&&/^[0-9A-F]+$/i.test(a.ipv6.addressEnd)){var f=parseInt(a.ipv6.addressStart,16),g=parseInt(a.ipv6.addressEnd,16);2>f||65535<f||2>g||65535<g?a.errorMessages.push("LAN IPv6 Address Range: Please enter a numeric value between 2 and ffff"):f>g&&a.errorMessages.push("LAN IPv6 Address Range: Start addr must be little or equal to end addr.")}else a.errorMessages.push("LAN IPv6 Address Range: Please enter hex digit as LAN range.");(""===a.ipv6.advertisementLifetime||
isNaN(a.ipv6.advertisementLifetime)||0>a.ipv6.advertisementLifetime||150<a.ipv6.advertisementLifetime)&&a.errorMessages.push("Router Advertisement Lifetime: Please enter a numeric value between 0 and 150.");0!=a.ipv6.mode&&1==a.ipv6.lanMode&&(""===a.ipv6.addressLifetime||isNaN(a.ipv6.addressLifetime)||3>a.ipv6.addressLifetime||150<a.ipv6.addressLifetime)&&a.errorMessages.push("IPv6 Address Lifetime: Please enter a numeric value between 3 and 150.");if(0<a.errorMessages.length)a.showErrorPage=!0,window.scrollTo(0,
0);else{a.ipv6.mode=parseInt(a.ipv6.mode);switch(a.ipv6.mode){case 0:a.ipv6.autoDns=2;break;case 1:a.ipv6.autoDns=parseInt(a.autoDns);break;case 2:a.ipv6.autoDns=1}a.ipv6.staticPrefixLength=parseInt(a.ipv6.staticPrefixLength);a.ipv6.lanMode=parseInt(a.ipv6.lanMode);a.ipv6.advertisementLifetime=parseInt(a.ipv6.advertisementLifetime);a.ipv6.addressLifetime=parseInt(a.ipv6.addressLifetime);a.ipv6.addressStart=f;a.ipv6.addressEnd=g;for(b=0;b<a.ipv6.interfaces.length;b++)a.ipv6.interfaces[b].name=escape(a.ipv6.interfaces[b].name).replace(/\+/g,
"%2B");a.ipv6.$update(function(){a.ipv6.addressStart=a.ipv6.addressStart.toString(16);a.ipv6.addressEnd=a.ipv6.addressEnd.toString(16);for(var b=0;b<a.ipv6.interfaces.length;b++)a.ipv6.interfaces[b].name=unescape(a.ipv6.interfaces[b].name);d.path("/advanced")})}}else c.update({enabled:!1},function(){d.path("/advanced")})}}]).controller("ArpCtrl",["$scope","$route","ARPTable","NetworkConnections",function(a,b,d,c){a.tab=b.current.tab;a.section=b.current.section;a.interfaces=c.query(function(){for(var b=
0;b<a.interfaces.length;b++)a.interfaces[b].name=unescape(a.interfaces[b].name)});a.refresh=function(){a.connections=d.query()};a.refresh()}]).controller("PortConfigCtrl",["$scope","$route","$location","Ethernet",function(a,b,d,c){a.tab=b.current.tab;a.section=b.current.section;var e=c.get(function(){a.ports=[];a.ports.push({name:"WAN Port",currentMode:e.wan.currentMode,desiredMode:e.wan.desiredMode,status:e.wan.status});a.ports.push({name:"LAN Port 1",currentMode:e.lan1.currentMode,desiredMode:e.lan1.desiredMode,
status:e.lan1.status});a.ports.push({name:"LAN Port 2",currentMode:e.lan2.currentMode,desiredMode:e.lan2.desiredMode,status:e.lan2.status});a.ports.push({name:"LAN Port 3",currentMode:e.lan3.currentMode,desiredMode:e.lan3.desiredMode,status:e.lan3.status});a.ports.push({name:"LAN Port 4",currentMode:e.lan4.currentMode,desiredMode:e.lan4.desiredMode,status:e.lan4.status})});a.checkSave=function(){systemSettings.warnBeforeChanges?a.isOK=!0:(a.isOK=!1,a.save())};a.cancelOK=function(){a.isOK=!1;d.path("/advanced")};
a.save=function(){c.update({wan:{desiredMode:parseInt(a.ports[0].desiredMode)},lan1:{desiredMode:parseInt(a.ports[1].desiredMode)},lan2:{desiredMode:parseInt(a.ports[2].desiredMode)},lan3:{desiredMode:parseInt(a.ports[3].desiredMode)},lan4:{desiredMode:parseInt(a.ports[4].desiredMode)}},function(){d.path("/advanced")})}}]).controller("RoutesCtrl",["$scope","$route","$location","Routes","NetworkConnections","SystemSettings",function(a,b,d,c,e,f){a.tab=b.current.tab;a.section=b.current.section;a.editingRoute=
!1;a.showErrorPage=!1;a.routesConnections=[];a.routingObject=c.get(function(){a.routes=a.routingObject.routes});a.sysSettings=f.get(function(){});a.connections=e.query(function(){for(var b=0,c=0;c<a.connections.length;c++){if(null!=a.connections[c].bridged)for(var d=0;d<a.connections[c].bridged.length;d++)a.connections[c].bridged[d]&&(a.connections[a.connections[c].availableBridges[d]].name=2==a.connections[c].availableBridges[d]?unescape(a.connections[c].name)+" Wireless 802.11 2.4GHz Access Point":
3==a.connections[c].availableBridges[d]?unescape(a.connections[c].name)+" Wireless 802.11 5.0GHz Access Point":unescape(a.connections[c].name+" "+a.connections[a.connections[c].availableBridges[d]].name));a.connections[c].name=unescape(a.connections[c].name);a.connections[c].hasOwnProperty("connectionUsed")||(a.routesConnections[b]=a.connections[c],b++)}});a.errorIGMPPageOk=function(){a.showIGMPwarning=!1;window.scrollTo(0,0);c.update({domainRouting:a.routingObject.domainRouting,igmpRouting:a.routingObject.igmpRouting},
function(){d.path("/advanced")})};a.errorIGMPPageNo=function(){a.showIGMPwarning=!1};a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.addNewRoute=function(){a.routeIndex=-1;a.routeEditing={type:0,destination:[0,0,0,0],netmask:[255,255,255,255],gateway:[0,0,0,0],metric:0};a.editingRoute=!0};a.save=function(b){b||!0!==a.sysSettings.warnBeforeChanges?c.update({domainRouting:a.routingObject.domainRouting,igmpRouting:a.routingObject.igmpRouting},function(){d.path("/advanced")}):(a.errorMessages=
[],a.errorMessages.push("Internet Group Management Protocol (IGMP): You are attempting to disable Internet Group Management Protocol (IGMP). Please note that Internet Group Management Protocol (IGMP) will be disabled for the following connections:"),a.showIGMPwarning=!0,window.scrollTo(0,0))};a.warningMsgGen=function(){return null!=a.routes&&0<a.routes.length?a.connections[a.routes[0].type].name:a.connections[0].name};a.editRoute=function(b){a.editingRoute=!0;b=a.routes[b];a.routeIndex=b.id;a.routeEditing=
{type:b.type,destination:splitIpArr(b.destination),netmask:splitIpArr(b.netmask),gateway:splitIpArr(b.gateway),metric:b.metric}};a.deleteRoute=function(b){c.remove({id:a.routes[b].id},function(){a.routingObject=c.get(function(){a.routes=a.routingObject.routes})})};a.cancelRouteEdit=function(){a.editingRoute=!1};a.saveRoute=function(){a.errorMessages=[];validateIp(a.routeEditing.destination)||a.errorMessages.push("Destination: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces.");
validateIp(a.routeEditing.netmask)||a.errorMessages.push("Netmask: Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0.");"0.0.0.0"==getIpString(a.routeEditing.netmask)&&a.errorMessages.push("Netmask: Subnet mask may not be 0.0.0.0. Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0.");
(null==a.routeEditing.metric||""===a.routeEditing.metric||isNaN(a.routeEditing.metric)||0>a.routeEditing.metric||255<a.routeEditing.metric)&&a.errorMessages.push("Metric: Please enter a numeric value between 0 and 255.");"0.0.0.0"==getIpString(a.routeEditing.gateway)&&a.errorMessages.push("Gateway: IP Address may not be 0.0.0.0.");validateIp(a.routeEditing.gateway)||a.errorMessages.push("Gateway : IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces.");
for(var b=!0,d=!1,e=0;4>e;e++){for(var f=7;-1<f;f--){var q=1==(a.routeEditing.netmask[e]>>f&1);if(q&&d){b=!1;break}q||(d=!0)}if(!b)break}b||a.errorMessages.push("Netmask: Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0.");0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.editingRoute=!1,a.routeEditing.type=parseInt(a.routeEditing.type),a.routeEditing.destination=
getIpString(a.routeEditing.destination),a.routeEditing.netmask=getIpString(a.routeEditing.netmask),a.routeEditing.gateway=getIpString(a.routeEditing.gateway),a.routeEditing.metric=parseInt(a.routeEditing.metric),-1!=a.routeIndex?c.update({id:a.routeIndex},a.routeEditing,function(){a.routingObject=c.get(function(){a.routes=a.routingObject.routes})}):c.save(a.routeEditing,function(){a.routingObject=c.get(function(){a.routes=a.routingObject.routes})}))}}]).controller("UPnPCtrl",["$scope","$route","$location",
"UPnP",function(a,b,d,c){a.tab=b.current.tab;a.section=b.current.section;a.upnpSettings=c.get();a.save=function(){a.upnpSettings.$update(function(){d.path("/advanced")})}}]).controller("dynamicDnsCtrl",["$scope","$route","$location","DynamicDNS","DynamicDNSProvider","$window","securityTips","SystemSettings",function(a,b,d,c,e,f,g,h){a.sysSettings=h.get();a.pageToShow=0;a.toggleWarningPage=function(b){a.pageToShow=b;window.scrollTo(0,0)};a.tab=b.current.tab;a.section=b.current.section;a.showErrorPage=
!1;a.showAddEdit=!1;a.editing=-1;a.ddnsObjects=[];a.ddnsObject={};a.getTitle=function(a){return getStatusTitle(a)};a.show=function(a){g.showMessage(getStatusTitle(a.status),a.errorMessage)};a.init_DDNSObject=function(){a.ddnsObject={hostname:"",provider:"",username:"",password:"",useSsl:!0,status:"",lastUpdate:""}};a.loadProviders=function(){a.ddnsProviders=e.query(function(){0<a.ddnsProviders.length&&(a.ddnsObject.provider=a.ddnsProviders[0])})};a.refresh=function(){a.ddnsObjects=[];a.dynamicDNSObjects=
c.query(function(){for(var b,c=0;c<a.dynamicDNSObjects.length;c++)b={},b.id=a.dynamicDNSObjects[c].id,b.hostname=unescape(a.dynamicDNSObjects[c].hostname),b.lastUpdate=unescape(a.dynamicDNSObjects[c].updateTime),b.status=unescape(a.dynamicDNSObjects[c].status),b.errorMessage=unescape(a.dynamicDNSObjects[c].errorMessage),b.hyperLink=0===a.dynamicDNSObjects[c].status||1===a.dynamicDNSObjects[c].status?!1:!0,void 0==b&&b.hostname==b||a.ddnsObjects.push(b)});a.loadProviders()};a.refresh();a.togglePage=
function(b){a.showAddEdit=!1};a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.addDDNS=function(){a.loadProviders();a.showErrorPage=!1;a.showAddEdit=!0;a.editing=-1;a.init_DDNSObject()};a.openSub=function(){""!=a.ddnsObject.provider&&(a.DnsLink=a.ddnsObject.provider.url,f.open(a.DnsLink))};a.editDDNSObj=function(b){a.showAddEdit=!0;a.showErrorPage=!1;a.editing=b;a.ddnsObject=a.dynamicDNSObjects[b];for(b=0;b<a.ddnsProviders.length;b++)if(a.ddnsProviders[b].name==a.ddnsObject.provider){a.ddnsObject.provider=
a.ddnsProviders[b];break}};a.saveDynamicDnsObj=function(){a.errorMessages=[];if(0!==a.ddnsObject.hostname.length){for(var b=0;b<a.dynamicDNSObjects.length;b++)if(a.editing!=b&&a.dynamicDNSObjects[b].hostname===a.ddnsObject.hostname){a.errorMessages.push("Duplicate Hostname: An identical hostname already exists in the system.");break}validateLocalDomain(a.ddnsObject.hostname)||a.errorMessages.push("Host Name: Name may not contain spaces. Only letters, digits and the special characters dash (-), underscore (_) and dot (.) may be used. These special characters may not appear at the beginning or at the end of a name. The maximum length of a label (text between two dots) is 63.")}else a.errorMessages.push("Host Name: Name may not contain spaces. Only letters, digits and the special characters dash (-), underscore (_) and dot (.) may be used. These special characters may not appear at the beginning or at the end of a name. The maximum length of a label (text between two dots) is 63.");
0==a.ddnsObject.provider.length&&a.errorMessages.push("Please Select DNS provider");0==a.ddnsObject.username.length&&a.errorMessages.push("Please enter a User Name.");0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):a.ddnsObject.useSsl?a.save():g.showWarningMsgBeforeSaving("DDNS Unsecured Mode",'Disabling SSL will make your communications less secure. Without SSL your password will be sent over the Internet in plain text, which carries the risk of allowing your password to be exposed to a malicious user. To disable SSL, click "Apply".',
"Apply",[""]).then(function(b){"cancel"!=b&&a.save()})};a.save=function(){var b={},b=a.ddnsObject;b.provider=b.provider.name;-1==a.editing?c.save(b,function(){a.refresh()}):(delete b.updateTime,delete b.status,c.update({id:a.dynamicDNSObjects[a.editing].id},b,function(){a.refresh()}));a.togglePage(0);a.init_DDNSObject(a)};a.cancelDynamicDnsObj=function(){a.togglePage(0);a.refresh()};a.cfmDeleteControl=function(){c.remove({id:a.selectedIndex},function(){a.toggleWarningPage(0);a.refresh()})};a.removeDDNSEntry=
function(b){a.selectedIndex=b;!0==a.sysSettings.warnBeforeChanges?a.toggleWarningPage(1):a.cfmDeleteControl()};a.refreshDDNS=function(){a.refresh()}}]);angular.module("firewall.controllers",[]).controller("GeneralCtrl",["$scope","$route","$routeParams","$location","General","IPv6",function(a,b,d,c,e,f){a.tab=b.current.tab;a.section=b.current.section;a.general=e.get();a.ipv6=f.get();a.warning=!1;null!=d.warn&&(a.warning=!0);a.cancel=function(){null!=d.connectionEdit?c.url("/network/connections/"+d.connectionEdit+"/edit"):(location.reload(),c.replace())};a.save=function(){a.general.$update(function(){location.reload()})};a.acceptWarning=function(){c.search({});
c.replace()}}]).controller("AccessControlCtrl",["$scope","$route","AccessControl","NetworkObjects","DnsServer","PortForwardRules","Schedules","Devices","$routeParams","$location","DateTimeSettings","General","SystemSettings",function(a,b,d,c,e,f,g,h,k,l,q,y,x){a.tab=b.current.tab;a.section=b.current.section;var v=y.get(function(){a.showAllow=2==v.ipv4SecurityLevel});a.showAdd=!1;a.isSame=!1;a.pageToShow=0;a.netObj=-2;a.prot=-2;a.sched=-2;a.showNetObj=[];a.sysSettings=x.get();a.initVars=function(){init_networkObjs(a);
init_services(a);init_schedules(a);a.networkObjects=[];a.services=[];a.editing=-1};a.errorPageOk=function(){0!=a.pageToShow||a.showAdd||a.refresh();a.isSame=!1;a.showErrorPage=!1;window.scrollTo(0,0)};a.cancel=function(){window.scrollTo(0,0);null!=k.fromnetwork?l.url("/network"):l.url("/firewall")};a.setPrintArr=function(b){a.printAddArr=[];a.printProtArr=[];a.netObjShowArr=[];switch(b){case 0:printAccessControlAddresses(a.accessControl,a.devices,a.printAddArr);printProtocolWithName(a.accessControl,
a.printProtArr);break;case 1:printAddresses(1,a.networkObjects,a.printAddArr),printProtocol(1,a.services,a.printProtArr)}};a.save=function(){for(var b=0,c=0,e=0;e<a.accessControl.length;e++)a.active[e]!=a.accessControl[e].enabled&&(b++,d.update({id:a.accessControl[e].id},{active:a.active[e]},function(){c++;c==b&&a.refresh()}))};a.resolveNow=function(){};a.getDeviceName=function(b){for(var c=0;c<a.devices.length;c++)if(b==a.devices[c].ipAddress)return a.devices[c].name;return b};a.getDeviceIp=function(b,
c){for(var d=0;d<a.devices.length;d++)if(b==a.devices[d].name&&c===a.devices[d].ipAddress)return a.devices[d].ipAddress;return b};a.netObjsIPArr=[];a.showNetObj=[];a.netObjsArr=[];a.refresh=function(){a.active=[];a.dateTimeSettings=q.get(function(){a.localTimeMoment=findTimeNow(a.dateTimeSettings);a.devices=h.query(function(){a.accessControl=d.query(function(){a.netObjs=c.query(function(){a.netObjsIPArr=[];a.showNetObj=[];a.netObjsArr=[];for(var b=[],c=0;c<a.netObjs.length;c++){var d={type:1,name:a.netObjs[c].name,
index:c,ipAddress:a.netObjs[c].ipAddress};d.deviceDisplayName=void 0!=d.ipAddress&&""!=d.ipAddress?d.ipAddress+" - "+d.name:d.name;a.netObjsArr.push(d);a.showNetObj.push(!0);b=[];for(d=0;d<a.netObjs[c].rules.length;d++)b.push(a.netObjs[c].rules[d].ipAddress);a.netObjsIPArr.push(b)}for(c=0;c<a.devices.length;c++)a.devices[c].isStb||(d={type:2,name:a.devices[c].name,ipAddress:a.devices[c].ipAddress},d.deviceDisplayName=void 0!=d.ipAddress&&""!=d.ipAddress?d.ipAddress+" - "+d.name:d.name,a.netObjsArr.push(d),
a.showNetObj.push(!0),a.netObjsIPArr.push([]));for(c=0;c<a.accessControl.length;c++){a.active.push(a.accessControl[c].active);for(b=0;b<a.accessControl[c].hosts.length;b++)checkAndFindNetworkObject(a.accessControl[c].networkObjects,a.getDeviceName(a.accessControl[c].hosts[b]),a.accessControl[c].hosts[b]);a.accessControl[c].schedActive="Active";null!=a.accessControl[c].schedule&&(a.accessControl[c].schedActive=isScheduleActive(a.accessControl[c].schedule,a.localTimeMoment));for(var e=[],d=0;d<a.accessControl[c].networkObjects.length;d++)for(b=
0;b<a.accessControl[c].networkObjects[d].rules.length;b++)for(var f=0;f<a.netObjsArr.length;f++)if(0<a.netObjsIPArr[f].length)for(var g=0;g<a.netObjsIPArr[f].length&&(e=a.netObjsIPArr[f][g],e==a.accessControl[c].networkObjects[d].rules[b].ipAddress&&(a.showNetObj.splice(f,1),a.netObjsArr.splice(f,1),a.netObjsIPArr.splice(f,1),f--),null!=a.netObjsIPArr[f]);g++);else e=a.netObjsArr[f].name,e==a.accessControl[c].networkObjects[d].rules[b].name&&(a.showNetObj.splice(f,1),a.netObjsArr.splice(f,1),a.netObjsIPArr.splice(f,
1),f--)}a.setPrintArr(0);a.initVars()})})})});a.schedArrLen=1;a.schedArr=g.query(function(){for(var b=0;b<a.schedArr.length;b++)a.schedArr[b].name=unescape(a.schedArr[b].name);a.schedArrLen=a.schedArr.length-1});a.pfRulesLen=1;a.pfRules=f.query(function(){a.pfRulesLen=a.pfRules.length+1;a.pfRules=sortListItems(a.pfRules);a.pfRulesCopy=copyArrayFromSource(a.pfRules)})};a.refresh();a.toggleMain=function(b){a.showAdd=!a.showAdd;a.pageToShow=0;a.netObj=-2;a.prot=-2;a.sched=-2;a.editIndex=-1;if(a.showAdd){a.ruleType=
b;a.pageTitle="Add";for(b=0;b<a.showNetObj.length;b++)a.showNetObj[b]=!0;a.setPrintArr(1);a.calculateShowingNetObjects()}else a.refresh();window.scrollTo(0,0)};a.loadDeviceData=function(b){a.devices=h.query();a.macSelect=-1;a.togglePage(2)};a.togglePage=function(b){a.pageToShow=b;a.netObj=-2;a.prot=-2;0==b&&(a.showAdd=!0,a.setPrintArr(1));window.scrollTo(0,0)};a.checkSimilarAccessControl=function(b){if(-2==a.sched)b.schedule1={};else if(-1!=a.sched)for(var c=0;c<a.schedArr.length;c++){if(a.sched==
a.schedArr[c].name){b.schedule1={};copySchedule(b.schedule1,a.schedArr[c]);break}}else-1==a.sched&&(b.schedule1={},copySchedule(b.schedule1,a.schedule));var d=!0,e=!0,f=!0,g=!0,l=g=!1;if(0<a.accessControl.length)for(c=0;c<a.accessControl.length;c++)if(f=e=d=!0,g=!1,!0==a.accessControl[c].blockRule&&(g=!0),c!=a.editing&&g==a.ruleType&&(g=compareAllSchedules(b.schedule1,a.accessControl[c].schedule,a.sched),!0==g&&(f=compareServices(b.services,a.accessControl[c].services),!0==f&&(e=compareNetworkObjects(b.networkObjects,
a.accessControl[c].networkObjects),!0==e&&(d=compareHosts(b.hosts,a.accessControl[c].hosts)))),d&&e&&f&&g)){l=!0;break}return l};a.createAccessControl=function(b){if(null==b){b={networkObjects:[],services:[],schedule:[],hosts:[],enabled:!0,networkObjects:[]};copyNetworkObjs(b.networkObjects,a.networkObjects,!0);copyServices(b.services,a.services);-2!==a.sched&&copySchedule(b.schedule,a.schedule);for(var c=0;c<b.networkObjects.length;c++)0<b.networkObjects[c].rules.length&&4==b.networkObjects[c].rules[0].networkObjType&&
"DHCP"==b.networkObjects[c].name&&b.hosts.push(a.getDeviceIp(b.networkObjects[c].rules[0].hostname,b.networkObjects[c].rules[0].ipAddress))}for(c=0;c<b.networkObjects.length;c++)0<b.networkObjects[c].rules.length&&4==b.networkObjects[c].rules[0].networkObjType&&"DHCP"==b.networkObjects[c].name&&(b.networkObjects.splice(c,1),c--);-2==a.sched?b.schedule="":-1!=a.sched?b.schedule=escape(a.sched):-1==a.sched&&(b.schedule={},b.scheduleEditable=!0,a.schedule.name=escape(a.schedule.name).replace(/\+/g,"%2B"),
copySchedule(b.schedule,a.schedule));b.blockRule=a.ruleType;-1==a.editing?d.save(b,function(){a.accessControl=[];a.initVars();a.toggleMain()}):d.update({id:a.accessControl[a.editing].id},b,function(){a.accessControl=[];a.initVars();a.toggleMain()})};a.applyMain=function(){a.errorMessages=[];var b={networkObjects:[],services:[],schedule:[],hosts:[],enabled:!0,networkObjects:[]};copyNetworkObjs(b.networkObjects,a.networkObjects,!0);copyServices(b.services,a.services);-2!==a.sched&&copySchedule(b.schedule,
a.schedule);for(var c=0;c<b.networkObjects.length;c++)0<b.networkObjects[c].rules.length&&4==b.networkObjects[c].rules[0].networkObjType&&"DHCP"==b.networkObjects[c].name&&b.hosts.push(a.getDeviceIp(b.networkObjects[c].rules[0].hostname,b.networkObjects[c].rules[0].ipAddress));if(-2==a.sched)b.schedule1={};else if(-1!=a.sched)for(c=0;c<a.schedArr.length;c++){if(a.sched==a.schedArr[c].name){b.schedule1={};copySchedule(b.schedule1,a.schedArr[c]);break}}else-1==a.sched&&(b.schedule1={},copySchedule(b.schedule1,
a.schedule));a.sysSettings.warnBeforeChanges?!0==a.checkSimilarAccessControl(b)?a.togglePage(8):a.createAccessControl(b):a.createAccessControl(b)};a.cancelMain=function(){a.accessControl=[];a.initVars();a.toggleMain()};a.editAccessControl=function(b){a.toggleMain();a.pageTitle="Edit";a.editIndex=b;a.ruleType=a.accessControl[b].blockRule;copyNetworkObjs(a.networkObjects,a.accessControl[b].networkObjects);copyServices(a.services,a.accessControl[b].services);void 0!=a.accessControl[b].schedule&&""!==
a.accessControl[b]?a.accessControl[b].scheduleEditable?(a.sched=-1,copySchedule(a.schedule,a.accessControl[b].schedule),a.printSchedArr=[],printSchedule(1,[a.schedule],a.printSchedArr),a.schedule.name=unescape(a.schedule.name)):a.sched=unescape(a.accessControl[b].schedule.name):a.sched=-2;for(var c=0;c<a.services.length;c++){for(var d=0;d<a.pfRules.length;d++)a.services[c].name==a.pfRules[d].name&&a.pfRules.splice(d,1);a.services[c].name=unescape(a.services[c].name);a.services[c].description=unescape(a.services[c].description);
a.services[c].displayName=a.services[c].name;void 0!=a.services[c].description&&"undefined"!=a.services[c].description&&a.services[c].description&&0<a.services[c].description.length&&(a.services[c].displayName+=" - "+a.services[c].description)}a.editing=b;a.calculateShowingNetObjects();a.setPrintArr(1)};a.calculateShowingNetObjects=function(){a.devices=h.query(function(){a.netObjs=c.query(function(){a.netObjsIPArr=[];a.showNetObj=[];a.netObjsArr=[];for(var b=[],c=0;c<a.netObjs.length;c++){for(var b=
[],d=0;d<a.netObjs[c].rules.length;d++){b.push(a.netObjs[c].rules[d].ipAddress);var e={type:1,name:a.netObjs[c].name,index:c,ipAddress:a.netObjs[c].rules[d].ipAddress};e.deviceDisplayName=void 0!=e.ipAddress&&""!=e.ipAddress?e.ipAddress+" - "+e.name:e.name}a.netObjsIPArr.push(b);a.netObjsArr.push(e);a.showNetObj.push(!0)}for(c=0;c<a.devices.length;c++)a.devices[c].isStb||(e={type:2,name:a.devices[c].name,ipAddress:a.devices[c].ipAddress},e.deviceDisplayName=void 0!=e.ipAddress&&""!=e.ipAddress?e.ipAddress+
" - "+e.name:e.name,a.netObjsArr.push(e),a.showNetObj.push(!0),a.netObjsIPArr.push([]));for(c=0;c<a.netObjsArr.length;c++)if(b=!1,void 0!=a.netObjsArr[c]){if(0==a.netObjsArr[c].type)for(d=0;d<a.networkObjects.length;d++){if(e=a.networkObjects[d],6==e.rules[0].networkObjType&&e.rules[0].hostname==a.netObjsArr[c].name){b=!0;break}}else if(1==a.netObjsArr[c].type)for(d=0;d<a.networkObjects.length;d++){if(e=a.networkObjects[d],void 0===e.type&&0==e.rules[0].networkObjType&&e.name==a.netObjsArr[c].name){b=
!0;break}}else if(2==a.netObjsArr[c].type)for(d=0;d<a.networkObjects.length;d++){if(e=a.networkObjects[d],(void 0===e.type||4==e.type)&&7==e.rules[0].networkObjType&&e.rules[0].name==a.netObjsArr[c].name&&e.rules[0].ipAddress===a.netObjsArr[c].ipAddress){b=!0;break}}else if(void 0!==a.netObjsArr[c].id)for(d=0;d<a.networkObjects.length;d++)if(a.netObjsArr[c].id===a.networkObjects[d].id){b=!0;break}a.showNetObj[c]=!b}})})};a.removeAccessControl=function(b){d.remove({id:a.accessControl[b].id},function(){a.refresh()})};
a.netObjChanged=function(){-2!=a.netObj&&(-1==a.netObj?a.togglePage(1):a.addNetObj(a.netObj))};a.addNetObj=function(b){a.showNetObj[b]=!1;var c={rules:[]};0==a.netObjsArr[b].type?(c.name="DNS",c.type=2,b={hostname:a.netObjsArr[b].name,networkObjType:6,ipAddress:a.netObjsArr[b].ipAddress},c.rules.push(b)):2==a.netObjsArr[b].type?(c.name="DHCP",c.type=4,b={name:a.netObjsArr[b].name,networkObjType:7,ipAddress:a.netObjsArr[b].ipAddress},c.rules.push(b)):(c.name=a.netObjsArr[b].name,c.type=3,copyAddresses(c.rules,
a.netObjs[a.netObjsArr[b].index].rules));a.networkObjects.push(c);a.setPrintArr(1);a.netObj=-2};a.applyNetworkObj=function(){a.errorMessages=[];if(""===a.networkObj.name)a.errorMessages.push("Description: A string must be specified.");else for(var b=0;b<a.networkObjects.length;b++)a.editingNetworkObj!=b&&a.networkObj.name===a.networkObjects[b].name&&a.errorMessages.push("Description: This name is already used by another network object.");0==a.networkObj.rules.length&&a.errorMessages.push("Items: At least one item entry must be defined.");
0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):applyNetworkObj(a,a.networkObjects)};a.cancelNetworkObj=function(){cancelNetworkObj(a)};a.editNetworkObj=function(b){editNetworkObj(a,a.networkObjects,b)};a.removeNetworkObj=function(b){removeObject(a.networkObjects,b);a.removeNetObj(b);a.setPrintArr(1);a.calculateShowingNetObjects()};a.removeNetObj=function(b){a.showNetObj[b]=!0};a.copyMacAddress=function(){var b=macSelecter.value;a.rule.mac=-1!=b?splitMacArr(a.devices[b].mac):splitMacArr("00:00:00:00:00:00");
a.rule.macMask=splitMacArr("ff:ff:ff:ff:ff:ff")};a.applyAddress=function(){applyAddressCheck(a);0==a.errorMessages&&applyAddress(a)};a.cancelAddress=function(){cancelAddress(a)};a.editAddress=function(b){editAddress(a,b)};a.removeAddress=function(b){removeObject(a.networkObj.rules,b)};a.protocolChange=function(){-2!=a.prot&&(-1==a.prot?a.togglePage(3):a.addPfProt(a.findRuleIndex(a.prot)))};a.findRuleIndex=function(b){for(var c=0;c<a.pfRules.length;c++)if(a.pfRules[c].id==b)return c};a.filterFn=function(a){return/^PortForward\_.*$/.test(a.name)?
!1:!0};a.addPfProt=function(b){var c={name:"",type:2,protocols:[]};copyService(c,a.pfRules[b]);c.displayName=a.pfRules[b].name;c.id=a.pfRules[b].id;void 0!==a.pfRules[b].description&&0<a.pfRules[b].description.length&&(c.displayName+=" - "+a.pfRules[b].description);a.services.push(c);a.setPrintArr(1);a.prot=-2;b=[];for(var d=0;d<a.pfRules.length;d++)c.id!=a.pfRules[d].id&&b.push(a.pfRules[d]);a.pfRules=b};a.applyPortForwardRule=function(){a.errorMessages=[];""==a.service.name?a.errorMessages.push("Service Name: A name must be specified."):
/^[0-9A-Z\!\-\_]+$/i.test(a.service.name)||a.errorMessages.push('Service Name: Rule name should consist of standard characters only (ASCII 32-126) excluding the special character space and any of :@"|\\/=+<>()[]{}&%^$*?,;');for(var b=0;b<a.pfRules.length;b++)b!=a.editing&&a.pfRules[b].name==a.service.name&&a.errorMessages.push("Service Name: This name is already used by another protocol.");0==a.service.protocols.length&&a.errorMessages.push("Server Ports: At least one server ports entry must be defined.");
0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(applyService(a,a.services),b=a.services.length-1,a.services[b].displayName=a.services[b].name)};a.cancelPortForwardRule=function(){cancelService(a)};a.editService=function(b){editService(a,a.services,b)};a.removeService=function(b){for(var c=0;c<a.pfRulesCopy.length;c++)if(a.pfRulesCopy[c].id==a.services[b].id){a.pfRules.push(a.pfRulesCopy[c]);break}a.pfRules=sortListItems(a.pfRules);removeObject(a.services,b)};a.applyProtocol=function(){a.errorMessages=
[];a.protocols.protocol=parseInt(a.protocols.protocol);a.protocols.incomingPorts=parseInt(a.protocols.incomingPorts);a.protocols.outgoingPorts=parseInt(a.protocols.outgoingPorts);a.protocols.icmpMessage=parseInt(a.protocols.icmpMessage);a.protocols.protocolNumber=parseInt(a.protocols.protocolNumber);var b=a.protocols.incomingPortStart,c=a.protocols.incomingPortEnd,d=a.protocols.outgoingPortStart,e=a.protocols.outgoingPortEnd;switch(a.protocols.protocol){case 0:var f=a.protocols.protocolNumber;(null==
f||""===f||isNaN(f)||0>f||255<f)&&a.errorMessages.push("Protocol Number: Please enter a numeric value between 0 and 255.");break;case 1:case 2:switch(a.protocols.incomingPorts){case 1:(null==b||""===b||1>b||65535<b)&&a.errorMessages.push("Source Port: Please enter a numeric value between 1 and 65535.");break;case 2:(null==b||""===b||1>b||65535<b)&&a.errorMessages.push("Start Source Port: Please enter a numeric value between 1 and 65535."),(null==c||""===c||1>c||65535<c)&&a.errorMessages.push("End Source Port: Please enter a numeric value between 1 and 65535."),
0==a.errorMessages.length&&b>=c&&a.errorMessages.push("Source Ports: The From value must be lower than the To value in a range of ports (from="+b+", to="+c+").")}switch(a.protocols.outgoingPorts){case 1:(null==d||""===d||1>d||65535<d)&&a.errorMessages.push("Destination Port: Please enter a numeric value between 1 and 65535.");4567==d&&!1==a.protocols.outgoingExclude&&1==a.protocols.protocol&&a.errorMessages.push("Invalid rule: Port 4567 cannot be blocked");break;case 2:(null==d||""===d||1>d||65535<
d)&&a.errorMessages.push("Start Destination Port: Please enter a numeric value between 1 and 65535."),(null==e||""===e||1>e||65535<e)&&a.errorMessages.push("End Destination Port: Please enter a numeric value between 1 and 65535."),0==a.errorMessages.length&&d>=e&&a.errorMessages.push("Destination Ports: The From value must be lower than the To value in a range of ports (from="+d+", to="+e+").")}break;case 3:if(10==a.protocols.icmpMessage){var f=a.protocols.icmpType,g=a.protocols.icmpCode;(null==f||
""===f||0>f||255<f)&&a.errorMessages.push("ICMP Type:  Please enter a numeric value between 0 and 255.");(null==g||""===g||0>g||255<g)&&a.errorMessages.push("ICMP Code:  Please enter a numeric value between 0 and 255.")}}0!=a.errorMessages.length||1!=a.protocols.protocol&&2!=a.protocols.protocol||(g=f=!1,0==a.protocols.incomingPorts?f=!0:2==a.protocols.incomingPorts&&!1==a.protocols.incomingExclude&&1==b&&65535==c&&(f=!0),0==a.protocols.outgoingPorts?g=!0:2==a.protocols.outgoingPorts&&!1==a.protocols.outgoingExclude&&
1==d&&65535==e&&(g=!0),f&&g&&a.errorMessages.push('Port forwarding rules can not be Any-to-Any (or "source: 1-65535" with "destination: 1-65535").'));0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.protocols.icmpType=parseInt(a.protocols.icmpType),a.protocols.icmpCode=parseInt(a.protocols.icmpCode),applyProtocol(a,a.service.protocols))};a.cancelProtocol=function(){cancelProtocol(a)};a.editProtocol=function(b){editProtocol(a,b,a.service.protocols)};a.removeProtocol=function(b){removeObject(a.service.protocols,
b);a.setPrintArr(1)};a.scheduleChange=function(){-2!=a.sched&&-1==a.sched&&a.addSchedule()};a.addSchedule=function(){init_schedule(a);a.editingSchedule=!1;a.togglePage(5)};a.applyRuleScheduler=function(){a.errorMessages=[];""===a.schedule.name&&a.errorMessages.push("Description: A string must be specified.");for(var b=0;b<a.schedArr.length;b++)if(b!=a.editingRuleSchedule&&a.schedArr[b].name==a.schedule.name){a.errorMessages.push("Name: This name is already used by another scheduler rule.");break}0==
a.schedule.timeSegments.length&&a.errorMessages.push("Rule Schedule: At least one time segment should be defined.");if(0<a.errorMessages.length)a.showErrorPage=!0,window.scrollTo(0,0);else{var c={};copySchedule(c,a.schedule);for(b=0;b<c.timeSegments.length;b++)for(var d=0;d<c.timeSegments[b].hourRanges.length;d++)c.timeSegments[b].hourRanges[d].startTimeHour=parseInt(c.timeSegments[b].hourRanges[d].startTimeHour),c.timeSegments[b].hourRanges[d].startTimeMinute=parseInt(c.timeSegments[b].hourRanges[d].startTimeMinute),
c.timeSegments[b].hourRanges[d].endTimeHour=parseInt(c.timeSegments[b].hourRanges[d].endTimeHour),c.timeSegments[b].hourRanges[d].endTimeMinute=parseInt(c.timeSegments[b].hourRanges[d].endTimeMinute);a.schedule=c;a.schedule.name=unescape(a.schedule.name);a.togglePage(0);a.printSchedArr=[];printSchedule(1,[a.schedule],a.printSchedArr)}};a.cancelRuleScheduler=function(){cancelRuleScheduler(a);a.editingSchedule||(a.sched=-2)};a.editRuleScheduler=function(){a.editingSchedule=!0;var b={};copySchedule(b,
a.schedule);editRuleScheduler(a,[b],0)};a.removeRuleScheduler=function(b){a.sched=-2;a.printSchedArr=[]};a.applyTimeSegment=function(){a.errorMessages=[];for(var b=!1,c=0;c<a.daysOfTheWeek.length;c++)a.daysOfTheWeek[c]&&(b=!0);b||a.errorMessages.push("Days of Week: At least one day must be selected.");0==a.hourRanges.length&&a.errorMessages.push("Hours Range: At least one hour range must be set.");0<a.errorMessages.length?a.showErrorPage=!0:applyTimeSegment(a);window.scrollTo(0,0)};a.cancelTimeSegment=
function(){cancelTimeSegment(a)};a.editTimeSegment=function(b){editTimeSegment(a,b)};a.removeTimeSegment=function(b){removeObject(a.schedule.timeSegments,b)};a.applyHourRange=function(){a.errorMessages=[];var b=a.hourRange.startTimeHour,c=a.hourRange.endTimeHour,d=a.hourRange.startTimeMinute,e=a.hourRange.endTimeMinute;(""===b||isNaN(b)||0>b||23<b)&&a.errorMessages.push("Start Time Hour: Please enter a numeric value between 0 and 23.");(""===c||isNaN(c)||0>c||23<c)&&a.errorMessages.push("End Time Hour: Please enter a numeric value between 0 and 23.");
(""===d||isNaN(d)||0>d||59<d)&&a.errorMessages.push("Start Time Minutes: Please enter a numeric value between 0 and 59.");(""===e||isNaN(e)||0>e||59<e)&&a.errorMessages.push("End Time Minutes: Please enter a numeric value between 0 and 59.");0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.hourRange.startTimeHour=parseInt(a.hourRange.startTimeHour),a.hourRange.startTimeMinute=parseInt(a.hourRange.startTimeMinute),a.hourRange.endTimeHour=parseInt(a.hourRange.endTimeHour),a.hourRange.endTimeMinute=
parseInt(a.hourRange.endTimeMinute),applyHourRange(a))};a.cancelHourRange=function(){cancelHourRange(a)};a.editHourRange=function(b){editHourRange(a,b)};a.removeHourRange=function(b){removeObject(a.hourRanges,b)};a.formatTimeString=function(a,b){return(10>a?"0"+a:a)+":"+(10>b?"0"+b:b)}}]).controller("PortForwardCtrl",["$scope","$route","PortForward","Devices","PortForwardRules","Schedules","DateTimeSettings",function(a,b,d,c,e,f,g){a.tab=b.current.tab;a.section=b.current.section;a.sourcePortType=
0;a.destPortType=0;a.showAdvanced=!1;a.ipSelect=-2;a.appToForward=-2;a.showErrorPage=!1;a.portsUsed=[];a.hasPrevValue=null;a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.pf={specifiedIp:[0,0,0,0],servicePortType:0,servicePort:0,schedule:"Always",protocol:{protocol:1,incomingPorts:0,incomingPortStart:65535,incomingPortEnd:0,outgoingPorts:0,outgoingPortStart:65535,outgoingPortEnd:0}};a.removeBox=[];for(var h=0;h<a.numItems;h++)a.removeBox.push(!1);a.isScheduleActive=isScheduleActive;
a.appForward=function(){if(0<=a.appToForward){a.portsUsed=[];for(var b=null,c=0;c<a.pfRules.length;c++)if(a.pfRules[c].id==a.appToForward){b=a.pfRules[c];break}null!=b&&printProtocol(6,b.protocols,a.portsUsed)}};a.save=function(){for(var b=0,c=0,e=0;e<a.portForward.length;e++)a.active[e]!=a.portForward[e].enabled&&(b++,d.update({id:a.portForward[e].id},{enabled:a.active[e]},function(){c++;c==b&&a.refresh()}))};a.toggleShow=function(){a.showAdvanced=!a.showAdvanced};a.contains=function(a,b){for(var c=
0;c<a.length;c++)if(a[c]===b)return!0;return!1};a.refresh=function(){a.portForward=d.query(function(){a.numItems=a.portForward.length;a.printPortsArr=[];printProtocol(1,a.portForward,a.printPortsArr);a.active=[];for(var b=0;b<a.portForward.length;b++)if(a.active.push(a.portForward[b].enabled),/^PortForward\_.*$/.test(a.portForward[b].name)){a.portForward[b].displayName="Destination Ports ";for(var d=[],q=0;q<a.portForward[b].protocols.length;q++){var h=a.portForward[b].protocols[q];if(1==h.outgoingPorts){if(a.contains(d,
h.outgoingPortStart))continue}else if(2==h.outgoingPorts&&a.contains(d,h.outgoingPortStart+"-"+h.outgoingPortEnd))continue;0<q&&(a.portForward[b].displayName+=",");0==h.outgoingPorts?a.portForward[b].displayName+="Any":1==h.outgoingPorts?(a.portForward[b].displayName+=h.outgoingPortStart,d.push(h.outgoingPortStart)):(a.portForward[b].displayName+=h.outgoingPortStart+"-"+h.outgoingPortEnd,d.push(h.outgoingPortStart+"-"+h.outgoingPortEnd))}}else a.portForward[b].displayName=unescape(a.portForward[b].name);
a.dateTimeSettings=g.get(function(){a.localTimeMoment=findTimeNow(a.dateTimeSettings);a.schedules=f.query(function(){for(var b=0;b<a.portForward.length;b++){a.portForward[b].schedActive="Active";for(var c=0;c<a.schedules.length;c++)if(a.portForward[b].schedule==a.schedules[c].name){a.portForward[b].schedActive=isScheduleActive(a.schedules[c],a.localTimeMoment);break}}for(c=0;c<a.schedules.length;c++)a.schedules[c].name=unescape(a.schedules[c].name)})});null==a.hasPrevValue?a.devices=c.query(function(){for(var b=
0;b<a.devices.length;b++)a.devices[b].displayName=a.devices[b].ipAddress!=a.devices[b].name?a.devices[b].ipAddress+" - "+a.devices[b].name:a.devices[b].name;for(b=0;b<a.portForward.length;b++){for(var c=0;c<a.devices.length;c++)if(a.portForward[b].deviceIp==a.devices[c].ipAddress&&a.devices[c].name!==a.devices[c].ipAddress){a.portForward[b].hostname=a.devices[c].name;a.portForward[b].showIp=!0;break}if(null==a.portForward[b].hostname||""===a.portForward[b].hosname)a.portForward[b].showIp=!1,a.portForward[b].hostname=
a.portForward[b].deviceIp}a.devices=filterOutStb(a.devices);a.pfRules=e.query(function(){a.pfRules=sortListItems(a.pfRules);a.pfRulesCopy=copyArrayFromSource(a.pfRules)})}):!0==a.hasPrevValue&&(a.hasPrevValue=null)})};a.refresh();a.resolveNow=function(){};a.reset=function(){a.ipSelect=-2;a.appToForward=-2;a.showAdvanced=!1;a.pf={specifiedIp:[0,0,0,0],servicePortType:0,servicePort:0,schedule:"Always",protocol:{protocol:1,incomingPorts:0,incomingPortStart:65535,incomingPortEnd:0,outgoingPorts:0,outgoingPortStart:65535,
outgoingPortEnd:0}}};a.add=function(){a.errorMessages=[];-2==a.ipSelect?a.errorMessages.push("Error: Please select the IP Address you want to forward to, or select an already connected item from the list"):-1==a.ipSelect&&(validateIp(a.pf.specifiedIp)&&"0.0.0.0"!=getIpString(a.pf.specifiedIp)&&"255.255.255.255"!=getIpString(a.pf.specifiedIp)||a.errorMessages.push("Error: The IP address specified is invalid"));a.pf.protocol.protocol=parseInt(a.pf.protocol.protocol);var b=[],c=[],e=[],f=0,g=0,h=65535,
u=0,w=0,s=65535;if(-2==a.appToForward)a.errorMessages.push("Error: Please select a pre-configured application or choose the option Custom ports to create a new appliction for port forwarding");else if(-1==a.appToForward)if(!a.showAdvanced&&0==a.errorMessages.length)for(var p=(""+a.pf.protocol.outgoingPortStart).split(","),r=0;r<p.length;r++){var m=p[r].split("-");if(2<m.length)a.errorMessages.push("Error: The input of port has illegal characters. Source port should be 111 or 111-222; Destination port should be 111, or 111-222, or 111,222-333 and so on.");
else for(var n=0;n<m.length;n++)""===m[n]||isNaN(m[n])?a.errorMessages.push("Error: The input of port has illegal characters. Source port should be 111 or 111-222; Destination port should be 111, or 111-222, or 111,222-333 and so on."):(1>m[n]||65535<m[n])&&a.errorMessages.push("Error: Port range should be between [1-65535]");1==m.length?(u=1,w=s=parseInt(m[0])):2==m.length&&(u=2,w=parseInt(m[0]),s=parseInt(m[1]));b.push(u);c.push(w);e.push(s)}else if(0==a.errorMessages.length){if(1==a.sourcePortType){m=
(""+a.pf.incomingPortStart).split("-");if(2<m.length)a.errorMessages.push("Error: The input of port has illegal characters. Source port should be 111 or 111-222; Destination port should be 111, or 111-222, or 111,222-333 and so on.");else for(n=0;n<m.length;n++)""===m[n]||isNaN(m[n])?a.errorMessages.push("Error: The input of port has illegal characters. Source port should be 111 or 111-222; Destination port should be 111, or 111-222, or 111,222-333 and so on."):(1>m[n]||65535<m[n])&&a.errorMessages.push("Error: Port range should be between [1-65535]");
1==m.length?(f=1,g=h=parseInt(m[0])):2==m.length&&(f=2,g=parseInt(m[0]),h=parseInt(m[1]))}if(1==a.destPortType&&0==a.errorMessages.length)for(p=(""+a.pf.outgoingPortStart).split(","),r=0;r<p.length;r++){m=p[r].split("-");if(2<m.length)a.errorMessages.push("Error: The input of port has illegal characters. Destination port should be 111 or 111-222; Destination port should be 111, or 111-222, or 111,222-333 and so on.");else for(n=0;n<m.length;n++)""===m[n]||isNaN(m[n])?a.errorMessages.push("Error: The input of port has illegal characters. Destination port should be 111 or 111-222; Destination port should be 111, or 111-222, or 111,222-333 and so on."):
(1>m[n]||65535<m[n])&&a.errorMessages.push("Error: Port range should be between [1-65535]");1==m.length?(u=1,w=s=parseInt(m[0])):2==m.length&&(u=2,w=parseInt(m[0]),s=parseInt(m[1]));b.push(u);c.push(w);e.push(s)}}a.showAdvanced&&1==a.pf.servicePortType&&0==a.errorMessages.length&&(""===a.pf.servicePort||isNaN(a.pf.servicePort)||0>a.pf.servicePort||65535<a.pf.servicePort)&&a.errorMessages.push("Forward to Port: Please enter a numeric value between 0 and 65535.");0==b.length&&(b.push(u),c.push(w),e.push(s));
0==a.errorMessages.length&&-1==a.appToForward&&(r=p=!1,!0==a.showAdvanced?0==a.sourcePortType?p=!0:1==a.sourcePortType&&(n=(""+a.pf.incomingPortStart).split("-"),2==n.length&&1==n[0]&&65535==n[1]&&(p=!0)):p=!0,!0==a.showAdvanced?0==a.destPortType?r=!0:1==a.destPortType&&(n=(""+a.pf.outgoingPortStart).split("-"),2==n.length&&1==n[0]&&65535==n[1]&&(r=!0)):(n=(""+a.pf.protocol.outgoingPortStart).split("-"),2==n.length&&1==n[0]&&65535==n[1]&&(r=!0)),p&&r&&a.errorMessages.push('Port forwarding rules can not be Any-to-Any (or "source: 1-65535" with "destination: 1-65535").'));
if(0==a.errorMessages.length&&0<=a.appToForward){r=null;for(n=0;n<a.pfRules.length;n++)if(a.pfRules[n].id==a.appToForward){r=a.pfRules[n];break}if(null==r)return;for(n=0;n<r.protocols.length;n++)if(!r.protocols[n].protocolExclude&&!r.protocols[n].outgoingExclude){var u=r.protocols[n].outgoingPortStart,s=r.protocols[n].outgoingPortEnd,w=r.name,z=u,p=r.protocols[n].protocol,B=!1;void 0!==s&&u!=s&&(z+="-"+s);void 0===s&&(s=u);(1==p||7==p)&&4567>=u&&4567<=s&&a.errorMessages.push("Invalid rule: Port 4567 cannot be blocked");
for(z=0;z<a.portForward.length;z++)for(m=0;m<a.portForward[z].protocols.length;m++){var t=a.portForward[z].protocols[m];if(7!=p||!(1>t.protocol||2<t.protocol))if(7==p||p==t.protocol){void 0!=u||p!=t.protocol||0!=p&&3!=p&&4!=p&&5!=p&&6!=p||(B=!0);var A="";if(0==t.outgoingPorts)A="Any";else if(1==t.outgoingPorts&&u<=t.outgoingPortStart&&s>=t.outgoingPortStart)A=t.outgoingPortStart;else if(2==t.outgoingPorts&&u<=t.outgoingPortStart&&s>=t.outgoingPortStart||u<=t.outgoingPortEnd&&s>=t.outgoingPortEnd||
u>=t.outgoingPortStart&&s<=t.outgoingPortEnd)A=t.outgoingPortStart+" -> "+t.outgoingPortEnd;(""!=A||B)&&a.errorMessages.push("Conflicting Port Forwarding Rules: The "+w+" service conflict with an existing port forwarding rule offering "+w+" service.")}}}}if(0==a.errorMessages.length&&-1==a.appToForward)for(r=0;r<b.length;r++)if(u=b[r],w=c[r],s=e[r],p=parseInt(a.pf.protocol.protocol),1!=p&&7!=p||4567!=w||4567!=s||a.errorMessages.push("Invalid rule: Port 4567 cannot be blocked"),0==u)for(n=0;n<a.portForward.length;n++)for(m=
0;m<a.portForward[n].protocols.length;m++){if(t=a.portForward[n].protocols[m],7!=p||!(1>t.protocol||2<t.protocol))if(7==p||p==t.protocol)A="",A=0==t.outgoingPorts?"Any":1==t.outgoingPorts?t.outgoingPortStart:t.outgoingPortStart+" -> "+t.outgoingPortEnd,a.errorMessages.push("Conflicting Port Forwarding Rules: The Destination Ports Any service conflict with an existing port forwarding rule offering Destination Ports "+A+" service.")}else for(z=u=w,p=a.pf.protocol.protocol,u!=s&&(z+="-"+s),n=0;n<a.portForward.length;n++)for(m=
0;m<a.portForward[n].protocols.length;m++)if(t=a.portForward[n].protocols[m],w=a.portForward[n].name,7!=p||!(1>t.protocol||2<t.protocol))if(7==p||p==t.protocol){A="";if(0==t.outgoingPorts)A="Any";else if(1==t.outgoingPorts&&u<=t.outgoingPortStart&&s>=t.outgoingPortStart)A=t.outgoingPortStart;else if(2==t.outgoingPorts&&u<=t.outgoingPortStart&&s>=t.outgoingPortStart||u<=t.outgoingPortEnd&&s>=t.outgoingPortEnd||u>=t.outgoingPortStart&&s<=t.outgoingPortEnd)A=t.outgoingPortStart+" -> "+t.outgoingPortEnd;
""!=A&&(0<=w.indexOf("_")?a.errorMessages.push("Conflicting Port Forwarding Rules: The Destination Ports "+z+" service conflict with an existing port forwarding rule offering  Destination Ports "+A+" service."):a.errorMessages.push("Conflicting Port Forwarding Rules: The Destination Ports "+z+" service conflict with an existing port forwarding rule offering "+w+" service."))}if(0<a.errorMessages.length)a.showErrorPage=!0,window.scrollTo(0,0);else{w=s=u=r=!1;n=parseInt(a.pf.protocol.protocol);p={enabled:!0};
-1==a.ipSelect?p.deviceIp=getIpString(a.pf.specifiedIp):0<=a.ipSelect&&(p.deviceIp=a.devices[a.ipSelect].ipAddress);if(-1==a.appToForward)if(p.name="PortForward_"+(new Date).getTime(),p.protocols=[],7==n)for(n=0;n<b.length;n++)w=s=u=r=!1,m={protocol:1},m.incomingPorts=f,m.incomingPortStart=g,!1==s&&(m.incomingPortEnd=h),m.incomingExclude=r,m.outgoingPorts=b[n],m.outgoingPortStart=c[n],!1==w&&(m.outgoingPortEnd=e[n]),m.outgoingExclude=u,p.protocols.push(m),m={protocol:2},m.incomingPorts=f,m.incomingPortStart=
g,!1==s&&(m.incomingPortEnd=h),m.incomingExclude=r,m.outgoingPorts=b[n],m.outgoingPortStart=c[n],!1==w&&(m.outgoingPortEnd=e[n]),m.outgoingExclude=u,p.protocols.push(m);else for(n=0;n<b.length;n++)w=s=u=r=!1,m={},m.protocol=a.pf.protocol.protocol,m.incomingPorts=f,m.incomingPortStart=g,!1==s&&(m.incomingPortEnd=h),m.incomingExclude=r,m.outgoingPorts=b[n],m.outgoingPortStart=c[n],!1==w&&(m.outgoingPortEnd=e[n]),m.outgoingExclude=u,p.protocols.push(m);else if(0<=a.appToForward){b=null;for(n=0;n<a.pfRules.length;n++)if(a.pfRules[n].id==
a.appToForward){b=a.pfRules[n];break}null!=b&&(p.protocols=b.protocols,p.name=escape(b.name).replace(/\+/g,"%2B"))}a.showAdvanced?(p.schedule=a.pf.schedule,p.schedule=escape(p.schedule).replace(/\+/g,"%2B"),p.servicePort=0==a.pf.servicePortType?0:parseInt(a.pf.servicePort)):(p.servicePort=0,p.schedule="Always");d.save(p,function(){a.refresh()});a.reset()}};a.remove=function(){for(var b=[],c=0;c<a.portForward.length;c++)a.removeBox[c]&&b.push(a.portForward[c].id);if(0<b.length){for(c=0;c<b.length;c++)b[c]-=
c;a.removeListItems(b)}a.removeBox=[];for(c=0;c<a.portForward.length;c++)a.removeBox.push(!1)};a.removeListItems=function(b){0<b.length?d.remove({id:b[h]},function(){b.splice(0,1);a.removeListItems(b)}):(a.hasPrevValue=!0,a.refresh())};a.filterFn=function(a){return/^PortForward\_.*$/.test(a.name)?!1:!0}}]).controller("PortTriggerCtrl",["$scope","$route","PortTrigger",function(a,b,d){a.tab=b.current.tab;a.section=b.current.section;a.pageToShow=0;a.protNameArr="Other TCP UDP ICMP GRE ESP AH".split(" ");
a.prot=0;a.incoming=!1;a.initVars=function(){init_services(a);a.tempTrigger={enabled:!0,name:"Application",outgoing:[],incoming:[]};a.editing=-1};a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.setPrintArr=function(b){a.printOutArr=[];a.printInArr=[];switch(b){case 3:printProtocol(3,a.portTrigger,a.printOutArr,a.printInArr);break;case 2:printProtocol(2,a.tempTrigger.outgoing,a.printOutArr),printProtocol(2,a.tempTrigger.incoming,a.printInArr)}};a.refresh=function(){a.portTrigger=
d.query(function(){a.active=[];for(var b=0;b<a.portTrigger.length;b++)a.active.push(a.portTrigger[b].enabled);a.setPrintArr(3);a.initVars()})};a.refresh();a.save=function(){for(var b=0,e=0,f=0;f<a.portTrigger.length;f++)a.active[f]!=a.portTrigger[f].active&&(b++,d.update({id:a.portTrigger[f].id},{enabled:a.active[f]},function(){e++;e==b&&a.refresh()}))};a.togglePage=function(b){a.pageToShow=b;3==b?a.setPrintArr(2):4==b?a.incoming=!1:5==b&&(a.incoming=!0);a.prot=0;window.scrollTo(0,0)};a.applyTrigger=
function(){a.errorMessages=[];var b={outgoing:[],incoming:[]};copyTrigger(b,a.tempTrigger);""==b.name?a.errorMessages.push("Service Name: A name must be specified."):/^[0-9A-Z\!\-\_]+$/i.test(b.name)||a.errorMessages.push('Service Name: Rule name should consist of standard characters only (ASCII 32-126) excluding the special character space and any of :@"|\\/=+<>()[]{}&%^$*?,;');0==b.outgoing.length&&a.errorMessages.push("Server Ports: At least one server ports entry must be defined.");0<a.errorMessages.length?
(a.showErrorPage=!0,window.scrollTo(0,0)):(-1===a.editing?d.save(b,function(){a.refresh()}):d.update({id:a.portTrigger[a.editing].id},b,function(){a.refresh()}),a.initVars(),a.togglePage(0))};a.applyProtocol=function(){a.errorMessages=[];a.protocols.protocol=parseInt(a.protocols.protocol);a.protocols.incomingPorts=parseInt(a.protocols.incomingPorts);a.protocols.outgoingPorts=parseInt(a.protocols.outgoingPorts);a.protocols.icmpMessage=parseInt(a.protocols.icmpMessage);a.protocols.protocolNumber=parseInt(a.protocols.protocolNumber);
var b=a.protocols.incomingPortStart,d=a.protocols.incomingPortEnd,f=a.protocols.outgoingPortStart,g=a.protocols.outgoingPortEnd;switch(a.protocols.protocol){case 0:var h=a.protocols.protocolNumber;(null==h||""===h||isNaN(h)||0>h||255<h)&&a.errorMessages.push("Protocol Number: Please enter a numeric value between 0 and 255.");break;case 1:case 2:switch(a.protocols.incomingPorts){case 1:(null==b||""===b||1>b||65535<b)&&a.errorMessages.push("Source Port: Please enter a numeric value between 1 and 65535.");
break;case 2:(null==b||""===b||1>b||65535<b)&&a.errorMessages.push("Start Source Port: Please enter a numeric value between 1 and 65535."),(null==d||""===d||1>d||65535<d)&&a.errorMessages.push("End Source Port: Please enter a numeric value between 1 and 65535."),0==a.errorMessages.length&&b>=d&&a.errorMessages.push("Source Ports: The From value must be lower than the To value in a range of ports (from="+b+", to="+d+").")}switch(a.protocols.outgoingPorts){case 1:(null==f||""===f||1>f||65535<f)&&a.errorMessages.push("Destination Port: Please enter a numeric value between 1 and 65535.");
4567==f&&!1==a.protocols.outgoingExclude&&1==a.protocols.protocol&&a.errorMessages.push("Invalid rule: Port 4567 cannot be blocked");break;case 2:(null==f||""===f||1>f||65535<f)&&a.errorMessages.push("Start Destination Port: Please enter a numeric value between 1 and 65535."),(null==g||""===g||1>g||65535<g)&&a.errorMessages.push("End Destination Port: Please enter a numeric value between 1 and 65535."),0==a.errorMessages.length&&f>=g&&a.errorMessages.push("Destination Ports: The From value must be lower than the To value in a range of ports (from="+
f+", to="+g+").")}break;case 3:if(10==a.protocols.icmpMessage){var h=a.protocols.icmpType,k=a.protocols.icmpCode;(null==h||""===h||0>h||255<h)&&a.errorMessages.push("ICMP Type:  Please enter a numeric value between 0 and 255.");(null==k||""===k||0>k||255<k)&&a.errorMessages.push("ICMP Code:  Please enter a numeric value between 0 and 255.")}}0!=a.errorMessages.length||1!=a.protocols.protocol&&2!=a.protocols.protocol||(k=h=!1,0==a.protocols.incomingPorts?h=!0:2==a.protocols.incomingPorts&&!1==a.protocols.incomingExclude&&
1==b&&65535==d&&(h=!0),0==a.protocols.outgoingPorts?k=!0:2==a.protocols.outgoingPorts&&!1==a.protocols.outgoingExclude&&1==f&&65535==g&&(k=!0),h&&k&&a.errorMessages.push('Port forwarding rules can not be Any-to-Any (or "source: 1-65535" with "destination: 1-65535").'));var l={outgoing:[],incoming:[]};copyTrigger(l,a.tempTrigger);var q=k=h="",y=!1,b=!1,x,v,d=!1;v=x="";var u=!1,w=!1,s,p,r=!1;if(1==a.protocols.protocol||2==a.protocols.protocol){1==a.protocols.protocol?h="TCP":2==a.protocols.protocol&&
(h="UDP");for(var d=a.protocols.incomingPortEnd,b=a.protocols.incomingPortStart,g=a.protocols.outgoingPortEnd,f=a.protocols.outgoingPortStart,u=2==a.protocols.incomingPorts?!0:!1,y=2==a.protocols.outgoingPorts?!0:!1,l=!1==a.incoming?l.outgoing:l.incoming,m=0;m<l.length;m++)if(a.protocols.protocol==l[m].protocol&&a.tempIndex!=m&&(s=l[m].incomingPortEnd,p=l[m].incomingPortStart,w=null==s||""===s?!1:!0,r=!1,u?w?Number(b)>=Number(p)&&Number(b)<=Number(s)?(x=p+"-"+s,v=b+"-"+d,r=!0):Number(d)>=Number(p)&&
Number(d)<=Number(s)?(x=p+"-"+s,v=b+"-"+d,r=!0):Number(p)>=Number(b)&&Number(p)<=Number(d)?(x=p+"-"+s,v=b+"-"+d,r=!0):Number(s)>=Number(b)&&Number(s)<=Number(d)&&(x=p+"-"+s,v=b+"-"+d,r=!0):Number(p)>=Number(b)&&Number(p)<=Number(d)&&(x=p,v=b+"-"+d,r=!0):w?Number(b)>=Number(p)&&Number(b)<=Number(s)&&(x=p+"-"+s,v=f,r=!0):Number(b)==Number(p)&&(x=p,v=b,r=!0),r)){a.errorMessages.push("Overlapping Port Ranges: The "+h+" source ports ("+v+") is overlapping with already defined "+h+" source ports ("+x+").");
break}for(m=0;m<l.length;m++)if(a.protocols.protocol==l[m].protocol&&a.tempIndex!=m&&(x=l[m].outgoingPortEnd,v=l[m].outgoingPortStart,b=null==x||""===x?!1:!0,d=!1,y?b?Number(f)>=Number(v)&&Number(f)<=Number(x)?(k=v+"-"+x,q=f+"-"+g,d=!0):Number(g)>=Number(v)&&Number(g)<=Number(x)?(k=v+"-"+x,q=f+"-"+g,d=!0):Number(v)>=Number(f)&&Number(v)<=Number(g)?(k=v+"-"+x,q=f+"-"+g,d=!0):Number(x)>=Number(f)&&Number(x)<=Number(g)&&(k=v+"-"+x,q=f+"-"+g,d=!0):Number(v)>=Number(f)&&Number(v)<=Number(g)&&(k=v,q=f+
"-"+g,d=!0):b?Number(f)>=Number(v)&&Number(f)<=Number(x)&&(k=v+"-"+x,q=f,d=!0):Number(f)==Number(v)&&(k=v,q=f,d=!0),d)){a.errorMessages.push("Overlapping Port Ranges: The "+h+" destination ports ("+q+") is overlapping with already defined "+h+" destination ports ("+k+").");break}}0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.protocols.icmpType=parseInt(a.protocols.icmpType),a.protocols.icmpCode=parseInt(a.protocols.icmpCode),a.incoming?applyProtocol(a,a.tempTrigger.incoming):
applyProtocol(a,a.tempTrigger.outgoing))};a.cancelTrigger=function(){a.refresh();a.togglePage(0)};a.cancelProtocol=function(){cancelProtocol(a)};a.editTrigger=function(b){a.editing=b;a.tempTrigger={enabled:a.portTrigger[b].enabled,name:a.portTrigger[b].name,outgoing:[],incoming:[]};copyTrigger(a.tempTrigger,a.portTrigger[b]);a.togglePage(3)};a.editOutgoingProtocol=function(b){editProtocol(a,b,a.tempTrigger.outgoing);a.incoming=!1;a.tempIndex=b};a.editIncomingProtocol=function(b){editProtocol(a,b,
a.tempTrigger.incoming,5);a.incoming=!0;a.tempIndex=b};a.removeTrigger=function(b){d.remove({id:a.portTrigger[b].id},function(){a.refresh()})};a.removeOutgoingProtocol=function(b){removeObject(a.tempTrigger.outgoing,b)};a.removeIncomingProtocol=function(b){removeObject(a.tempTrigger.incoming,b)}}]).controller("RemoteAdminCtrl",["$scope","$route","$routeParams","$location","RemoteAdmin","SystemSettings",function(a,b,d,c,e,f){a.tab=b.current.tab;a.section=b.current.section;a.sysSettings=f.get();a.remAdmin=
e.get();a.fromString="?from=fw";a.prev="";a.oldFrom="";a.back="/firewall";if(null!=d.from){a.fromString="?from="+d.from+"-fw";a.back="/advanced/settings";b=d.from.split("-");d="";for(e=0;e<b.length-1;e++)0!=e&&(d+="-"),d+=b[e];""!==d&&(a.prev="?from="+d)}else a.back="/firewall";a.save=function(){a.remAdmin.$update(function(){""==a.oldFrom?location.reload():c.path(a.back).search({from:a.oldFrom})})}}]).controller("StaticNATCtrl",["$scope","$route","StaticNAT","Devices","PortForwardRules",function(a,
b,d,c,e){a.tab=b.current.tab;a.section=b.current.section;a.showErrorPage=!1;a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.pageToShow=0;a.prot=-2;a.initVars=function(){init_services(a);a.statNat={localHost:-1,host:"192.168.1.0",publicIp:splitIpArr("0.0.0.0"),portForwarding:!1,services:[]};a.editing=-1;a.checkEdit=-1};a.initVars();a.setPrintArr=function(b){a.printProtArr=[];switch(b){case 1:printProtocol(1,a.statNat.services,a.printProtArr)}};a.devices=c.query(function(){a.devices=
filterOutStb(a.devices)});a.save=function(){for(var b=0,c=0,e=0;e<a.staticNAT.length;e++)a.enabled[e]!=a.staticNAT[e].active&&(b++,d.update({id:a.staticNAT[e].id},{active:a.enabled[e]},function(){c++;c==b&&a.refresh()}))};a.togglePage=function(b){a.pageName="Add";a.pageToShow=b;1==b&&(a.prot=-2,a.setPrintArr(1));window.scrollTo(0,0)};a.saveRule=function(){a.errorMessages=[];var b=a.statNat.host.split(".");-1==a.statNat.localHost&&(validateIpDomain(a.statNat.host)&&validateIp(b)||a.errorMessages.push("Local Host: The value must be a valid IP address."));
if(validateIp(a.statNat.publicIp))if(240<=a.statNat.publicIp[0])a.errorMessages.push("Public IP Address: IP Address must be within the range of 0.0.0.0 to 239.255.255.255.");else{var c=getIpString(a.statNat.publicIp);if("0.0.0.0"===c)a.errorMessages.push("NAT/NAPT configuration: IP conflicts between this rule and previous NAT/NAPT rules");else for(b=0;b<a.staticNAT.length;b++)if(a.checkEdit!=b&&a.staticNAT[b].publicIp===c){a.errorMessages.push("NAT/NAPT configuration: IP conflicts between this rule and previous NAT/NAPT rules");
break}}else a.errorMessages.push("Public IP Address: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces.");if(0<a.errorMessages.length)a.showErrorPage=!0,window.scrollTo(0,0);else{-1!=a.statNat.localHost&&(a.statNat.host=a.statNat.localHost);c={host:a.statNat.host,publicIp:getIpString(a.statNat.publicIp),portForwarding:a.statNat.portForwarding,services:[],active:!0};if(-1==a.statNat.localHost)c.host=a.statNat.host;else for(b=0;b<a.devices.length;b++)a.statNat.localHost==
a.devices[b].id&&(c.host=a.devices[b].ipAddress);copyServices(c.services,a.statNat.services);c.portForwarding||(c.services=[]);for(b=0;b<c.services.length;b++)c.services[b].name=escape(c.services[b].name).replace(/\+/g,"%2B");-1!=a.checkEdit?d.update({id:a.staticNAT[a.checkEdit].id},c,function(){a.refresh()}):d.save(c,function(){a.refresh()});a.initVars();a.togglePage(0)}};a.refresh=function(){a.staticNAT=d.query(function(){a.enabled=[];for(var b=0;b<a.staticNAT.length;b++){a.enabled.push(a.staticNAT[b].active);
for(var c=0;c<a.staticNAT[b].services.length;c++)a.staticNAT[b].services[c].name=unescape(a.staticNAT[b].services[c].name),a.staticNAT[b].services[c].description=unescape(a.staticNAT[b].services[c].description)}});a.pfRules=e.query(function(){a.pfRules=sortListItems(a.pfRules);a.pfRulesCopy=copyArrayFromSource(a.pfRules)})};a.cancelRule=function(){a.refresh();a.initVars();a.togglePage(0)};a.editRule=function(b){a.statNat={localHost:-1,host:a.staticNAT[b].host,publicIp:splitIpArr(a.staticNAT[b].publicIp),
portForwarding:a.staticNAT[b].portForwarding,services:[]};copyServices(a.statNat.services,a.staticNAT[b].services);for(var c=0;c<a.statNat.services.length;c++){a.statNat.services[c].displayName=a.statNat.services[c].name;a.statNat.services[c].description&&0<a.statNat.services[c].description.length&&(a.statNat.services[c].displayName+=" - "+a.statNat.services[c].description);for(var d=0;d<a.pfRules.length;d++)a.statNat.services[c].name==a.pfRules[d].name&&(a.statNat.services[c].id=a.pfRules[d].id,
a.pfRules.splice(d,1))}a.editing=b;a.checkEdit=b;a.togglePage(1);a.pageName="Edit"};a.removeRule=function(b){d.remove({id:a.staticNAT[b].id},function(){a.refresh()})};a.ruleChanged=function(){-2!=a.prot&&(-1==a.prot?a.addService():a.addPfProt(a.findRuleIndex(a.prot)))};a.findRuleIndex=function(b){for(var c=0;c<a.pfRules.length;c++)if(a.pfRules[c].id==b)return c};a.filterFn=function(a){return/^PortForward\_.*$/.test(a.name)?!1:!0};a.addPfProt=function(b){var c={name:"",type:2,protocols:[]};copyService(c,
a.pfRules[b]);c.displayName=a.pfRules[b].name;c.id=a.pfRules[b].id;a.pfRules[b].description&&0<a.pfRules[b].description.length&&(c.displayName+=" - "+a.pfRules[b].description);a.statNat.services.push(c);a.setPrintArr(1);a.prot=-2;b=[];for(var d=0;d<a.pfRules.length;d++)c.id!=a.pfRules[d].id&&b.push(a.pfRules[d]);a.pfRules=b};a.applyPortForwardRule=function(){a.errorMessages=[];""==a.service.name?a.errorMessages.push("Service Name: A name must be specified."):/^[0-9A-Z\!\-\_]+$/i.test(a.service.name)||
a.errorMessages.push('Service Name: Rule name should consist of standard characters only (ASCII 32-126) excluding the special character space and any of :@"|\\/=+<>()[]{}&%^$*?,;');for(var b=0;b<a.pfRules.length;b++)b!=a.editing&&a.pfRules[b].name==a.service.name&&a.errorMessages.push("Service Name: This name is already used by another protocol.");0==a.service.protocols.length&&a.errorMessages.push("Server Ports: At least one server ports entry must be defined.");if(0<a.errorMessages.length)a.showErrorPage=
!0,window.scrollTo(0,0);else{applyService(a,a.statNat.services);for(b=0;b<a.statNat.services.length;b++)a.statNat.services[b].displayName=a.statNat.services[b].name,a.statNat.services[b].description&&0<a.statNat.services[b].description.length&&(a.statNat.services[b].displayName+=" - "+a.statNat.services[b].description);a.setPrintArr(1);a.togglePage(1)}};a.cancelPortForwardRule=function(){cancelService(a);a.togglePage(1)};a.addService=function(){a.editing=-1;a.togglePage(3)};a.editService=function(b){a.editing=
b;editService(a,a.statNat.services,b)};a.removeService=function(b){for(var c=0;c<a.pfRulesCopy.length;c++)if(a.pfRulesCopy[c].id==a.statNat.services[b].id){a.pfRules.push(a.pfRulesCopy[c]);break}a.pfRules=sortListItems(a.pfRules);removeObject(a.statNat.services,b)};a.applyProtocol=function(){a.errorMessages=[];a.protocols.protocol=parseInt(a.protocols.protocol);a.protocols.incomingPorts=parseInt(a.protocols.incomingPorts);a.protocols.outgoingPorts=parseInt(a.protocols.outgoingPorts);a.protocols.icmpMessage=
parseInt(a.protocols.icmpMessage);a.protocols.protocolNumber=parseInt(a.protocols.protocolNumber);var b=a.protocols.incomingPortStart,c=a.protocols.incomingPortEnd,d=a.protocols.outgoingPortStart,e=a.protocols.outgoingPortEnd;switch(a.protocols.protocol){case 0:var l=a.protocols.protocolNumber;(null==l||""===l||isNaN(l)||0>l||255<l)&&a.errorMessages.push("Protocol Number: Please enter a numeric value between 0 and 255.");break;case 1:case 2:switch(a.protocols.incomingPorts){case 1:(null==b||""===
b||1>b||65535<b)&&a.errorMessages.push("Source Port: Please enter a numeric value between 1 and 65535.");break;case 2:(null==b||""===b||1>b||65535<b)&&a.errorMessages.push("Start Source Port: Please enter a numeric value between 1 and 65535."),(null==c||""===c||1>c||65535<c)&&a.errorMessages.push("End Source Port: Please enter a numeric value between 1 and 65535."),0==a.errorMessages.length&&b>=c&&a.errorMessages.push("Source Ports: The From value must be lower than the To value in a range of ports (from="+
b+", to="+c+").")}switch(a.protocols.outgoingPorts){case 1:(null==d||""===d||1>d||65535<d)&&a.errorMessages.push("Destination Port: Please enter a numeric value between 1 and 65535.");4567==d&&!1==a.protocols.outgoingExclude&&1==a.protocols.protocol&&a.errorMessages.push("Invalid rule: Port 4567 cannot be blocked");break;case 2:(null==d||""===d||1>d||65535<d)&&a.errorMessages.push("Start Destination Port: Please enter a numeric value between 1 and 65535."),(null==e||""===e||1>e||65535<e)&&a.errorMessages.push("End Destination Port: Please enter a numeric value between 1 and 65535."),
0==a.errorMessages.length&&d>=e&&a.errorMessages.push("Destination Ports: The From value must be lower than the To value in a range of ports (from="+d+", to="+e+").")}break;case 3:if(10==a.protocols.icmpMessage){var l=a.protocols.icmpType,q=a.protocols.icmpCode;(null==l||""===l||0>l||255<l)&&a.errorMessages.push("ICMP Type:  Please enter a numeric value between 0 and 255.");(null==q||""===q||0>q||255<q)&&a.errorMessages.push("ICMP Code:  Please enter a numeric value between 0 and 255.")}}0!=a.errorMessages.length||
1!=a.protocols.protocol&&2!=a.protocols.protocol||(q=l=!1,0==a.protocols.incomingPorts?l=!0:2==a.protocols.incomingPorts&&!1==a.protocols.incomingExclude&&1==b&&65535==c&&(l=!0),0==a.protocols.outgoingPorts?q=!0:2==a.protocols.outgoingPorts&&!1==a.protocols.outgoingExclude&&1==d&&65535==e&&(q=!0),l&&q&&a.errorMessages.push('Port forwarding rules can not be Any-to-Any (or "source: 1-65535" with "destination: 1-65535").'));0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):applyProtocol(a,
a.service.protocols)};a.cancelProtocol=function(){cancelProtocol(a);a.togglePage(3)};a.editProtocol=function(b){editProtocol(a,b,a.service.protocols)};a.removeProtocol=function(b){removeObject(a.service.protocols,b,2,a)};a.refresh()}]).controller("FirewallSecurityLogCtrl",["$scope","$route","$http","SecuritySettings","SecurityCsv","SecurityHazard","Log",function(a,b,d,c,e,f,g){a.tab=b.current.tab;a.section=b.current.section;a.showSettings=0;a.securitySettings=c.get();a.enableLogging=systemSettings.enableLogging;
setupLoggingCtrl(a,1,d,g);a.clearSecLog=function(){a.clearLog();a.showSettings=0};a.clearLogScreen=function(){systemSettings.warnBeforeChanges?a.showSettings=3:a.clearLog()};a.getTime=function(a){return moment.unix(a).format("MMM DD HH:mm:ss YYYY")};a.save=function(){a.securitySettings.$update(function(){a.showSettings=0;a.securitySettings=c.get()})};a.togglePage=function(b){0==b&&(a.securitySettings=c.get());a.showSettings=b;window.scrollTo(0,0)};a.markViewed=function(){f.update(function(){location.reload()})}}]);function init_networkObjs(a){init_networkObj(a);init_address(a)}function init_networkObj(a){a.networkObj={name:"Global Object",type:1,rules:[]};a.editingNetworkObj=-1}function init_address(a){a.rule={networkObjType:0,dhcpType:0,ip:splitIpArr("0.0.0.0"),ipTwo:splitIpArr("0.0.0.0"),mac:splitMacArr("00:00:00:00:00:00"),macMask:splitMacArr("ff:ff:ff:ff:ff:ff"),hostname:"Name"};a.editingAddress=-1}
function applyNetworkObj(a,b){if(-1==a.editingNetworkObj){var d={};copyNetworkObj(d,a.networkObj);b.push(d)}else copyNetworkObj(b[a.editingNetworkObj],a.networkObj);init_networkObj(a);a.togglePage(0)}function applyAddress(a){if(-1==a.editingAddress){var b={};copyAddress(b,a.rule,0);a.networkObj.rules.push(b)}else copyAddress(a.networkObj.rules[a.editingAddress],a.rule,0);init_address(a);a.togglePage(1)}function cancelNetworkObj(a){init_networkObj(a);a.togglePage(0)}
function cancelAddress(a){init_address(a);a.togglePage(1)}function editNetworkObj(a,b,d){copyNetworkObj(a.networkObj,b[d]);a.editingNetworkObj=d;a.togglePage(1)}function editAddress(a,b){copyAddress(a.rule,a.networkObj.rules[b],2);a.editingAddress=b;a.togglePage(2)}function copyNetworkObjs(a,b,d){for(var c=0;c<b.length;c++){var e={};copyNetworkObj(e,b[c],d);a.push(e)}}
function copyNetworkObj(a,b,d){a.name=b.name;a.type=b.type;a.rules=[];if(0!=b.type)if(2==b.type)copyDnsEntry(a.rules,b.rules);else if(4==b.type)for(var c=0;c<b.rules.length;c++){var e={};d?(e.hostname=b.rules[c].name,e.networkObjType=4):(e.name=b.rules[c].name,e.networkObjType=7);e.ipAddress=b.rules[c].ipAddress;a.rules.push(e)}else copyAddresses(a.rules,b.rules)}function copyAddresses(a,b){for(var d=0;d<b.length;d++){var c={};copyAddress(c,b[d],1);a.push(c)}}
function copyAddress(a,b,d){a.networkObjType=parseInt(b.networkObjType);if(0==d)switch(a.networkObjType){case 0:a.ipAddress=getIpString(b.ip);break;case 1:a.ipSubnet=getIpString(b.ip);a.subnetMask=getIpString(b.ipTwo);break;case 2:a.ipStart=getIpString(b.ip);a.ipEnd=getIpString(b.ipTwo);break;case 3:a.mac=getMacString(b.mac);a.macMask=getMacString(b.macMask);break;case 4:a.hostname=b.hostname;break;case 5:a.option=b.hostname;a.dhcpType=b.dhcpType;break;case 7:a.name=b.name}else if(1==d)switch(a.networkObjType){case 0:a.ipAddress=
b.ipAddress;break;case 1:a.ipSubnet=b.ipSubnet;a.subnetMask=b.subnetMask;break;case 2:a.ipStart=b.ipStart;a.ipEnd=b.ipEnd;break;case 3:a.mac=b.mac;a.macMask=b.macMask;break;case 4:a.hostname=b.hostname;break;case 5:a.option=b.option;a.dhcpType=b.dhcpType;break;case 7:a.name=b.name}else if(2==d)switch(a.networkObjType){case 0:a.ip=splitIpArr(b.ipAddress);break;case 1:a.ip=splitIpArr(b.ipSubnet);a.ipTwo=splitIpArr(b.subnetMask);break;case 2:a.ip=splitIpArr(b.ipStart);a.ipTwo=splitIpArr(b.ipEnd);break;
case 3:a.mac=splitMacArr(b.mac);a.macMask=splitMacArr(b.macMask);break;case 4:a.hostname=b.hostname;break;case 5:a.hostname=b.option;a.dhcpType=b.dhcpType;break;case 7:a.name=b.name}}function copyDnsEntry(a,b){for(var d=0;d<b.length;d++){var c={};c.hostname=b[d].hostname;c.networkObjType=6;a.push(c)}}
function printAddressObject(a,b){switch(a.networkObjType){case 0:b.push(a.ipAddress);break;case 1:b.push(a.ipSubnet+" / "+a.subnetMask);break;case 2:b.push(a.ipStart+" - "+a.ipEnd);break;case 3:b.push(a.mac+" / "+a.macMask);break;case 4:b.push(a.hostname);break;case 5:switch(a.dhcpType){case 0:b.push("DHCP Option: Vendor Class ID = "+a.option);break;case 1:b.push("DHCP Option: Client ID = "+a.option);break;case 2:b.push("DHCP Option: User Class ID = "+a.option)}break;case 6:b.push(a.hostname);break;
case 7:b.push(a.name)}}function getPrintArrayForAddresses(a,b){for(var d in a)printAddressObject(a[d],b)}
function printAccessControlAddresses(a,b,d){for(var c in a)if(0<=c){var e=[];if(void 0===a[c].networkObjects||null===a[c].networkObjects||0==a[c].networkObjects.length)a[c].displayText=["Any"],e.push("Any");else{a[c].displayText=[];for(var f in a[c].networkObjects)if(0<=f)for(var g in a[c].networkObjects[f].rules)if(0<=g){var h=a[c].networkObjects[f].rules[g];switch(h.networkObjType){case 0:a[c].displayText.push(h.ipAddress);e.push(h.ipAddress);break;case 1:a[c].displayText.push(h.ipSubnet+" / "+
h.subnetMask);e.push(h.ipSubnet+" / "+h.subnetMask);break;case 2:a[c].displayText.push(h.ipStart+" - "+h.ipEnd);e.push(h.ipStart+" - "+h.ipEnd);break;case 3:a[c].displayText.push(h.mac);e.push(h.mac);break;case 4:a[c].displayText.push(h.hostname);for(var k=!1,l=0;l<b.length;l++)if(b[l].name==h.hostname){e.push(b[l].ipAddress);k=!0;break}k||e.push("");break;case 5:switch(h.dhcpType){case 0:e.push("DHCP Option: Vendor Class ID = "+h.option);a[c].displayText.push("DHCP Option: Vendor Class ID = "+h.option);
break;case 1:e.push("DHCP Option: Client ID = "+h.option);a[c].displayText.push("DHCP Option: Client ID = "+h.option);break;case 2:e.push("DHCP Option: User Class ID = "+h.option),a[c].displayText.push("DHCP Option: User Class ID = "+h.option)}break;case 6:e.push(h.hostname);a[c].displayText.push(h.hostname);break;case 7:a[c].displayText.push(h.name);k=!1;for(l=0;l<b.length;l++)if(b[l].name==h.name&&b[l].ipAddress===h.ipAddress){e.push(b[l].ipAddress);k=!0;break}k||e.push("")}}}d.push(e)}}
function printAddresses(a,b,d){if(0==a)for(var c in b){if(0<=c){a=[];if(0==b[c].networkObjects.length)a.push("Any");else for(var e in b[c].networkObjects)getPrintArrayForAddresses(b[c].networkObjects[e].rules,a);d.push(a)}}else if(1==a)for(c in 0==b.length&&(e=[],e.push("Any"),d.push(e)),b)0<=c&&(a=[],getPrintArrayForAddresses(b[c].rules,a),d.push(a));else if(4==a)for(c=0;8>c;c++)for(var f in b[c].filters)printAddresses(1,b[c].filters[f].source,d[c].sourceArr),printAddresses(1,b[c].filters[f].dest,
d[c].destArr);else if(5==a)for(c=0;8>c;c++)for(f in b[c].priorities)printAddresses(1,b[c].priorities[f].source,d[c].sourceArr),printAddresses(1,b[c].priorities[f].dest,d[c].destArr)}function init_services(a){a.protNames="Other TCP UDP ICMP GRE ESP AH".split(" ");a.service={name:"Name",type:1,protocols:[]};a.editingService=-1;init_protocols(a);a.printPortsArr=[]}
function init_protocols(a){a.protocols={protocol:0,protocolExclude:!1,incomingPorts:0,incomingPortStart:1,incomingPortEnd:65535,incomingExclude:!1,outgoingPorts:0,outgoingPortStart:1,outgoingPortEnd:65535,outgoingExclude:!1,icmpMessage:0,icmpType:0,icmpCode:0,protocolNumber:0};a.editingProtocol=-1}function applyService(a,b){if(-1==a.editingService){var d={};copyService(d,a.service);b.push(d)}else copyService(b[a.editingService],a.service);init_services(a);a.togglePage(0)}
function applyProtocol(a,b){if(0==a.protocols.protocol)switch(a.protocols.protocolNumber){case 1:a.protocols.protocol=3;a.protocols.icmpMessage=0;break;case 6:a.protocols.protocol=1;a.protocols.incomingPorts=0;a.protocols.incomingPortStart=0;a.protocols.incomingPortEnd=65535;a.protocols.incomingExclude=!1;a.protocols.outgoingPorts=0;a.protocols.outgoingPortStart=0;a.protocols.outgoingPortEnd=65535;a.protocols.outgoingExclude=!1;break;case 17:a.protocols.protocol=2;a.protocols.incomingPorts=0;a.protocols.incomingPortStart=
0;a.protocols.incomingPortEnd=65535;a.protocols.incomingExclude=!1;a.protocols.outgoingPorts=0;a.protocols.outgoingPortStart=0;a.protocols.outgoingPortEnd=65535;a.protocols.outgoingExclude=!1;break;case 47:a.protocols.protocol=4;break;case 50:a.protocols.protocol=5;break;case 51:a.protocols.protocol=6}if(-1==a.editingProtocol){var d={};copyProtocol(d,a.protocols);b.push(d)}else copyProtocol(b[a.editingProtocol],a.protocols);a.printPortsArr=[];printProtocol(2,a.service.protocols,a.printPortsArr);init_protocols(a);
a.togglePage(3)}function cancelService(a){init_services(a);a.togglePage(0)}function cancelProtocol(a){init_protocols(a);a.togglePage(3)}function editService(a,b,d){copyService(a.service,b[d]);a.printPortsArr=[];printProtocol(2,a.service.protocols,a.printPortsArr);a.editingService=d;a.togglePage(3)}function editProtocol(a,b,d,c){copyProtocol(a.protocols,d[b]);a.editingProtocol=b;void 0!=c?a.togglePage(c):a.togglePage(4)}
function copyServices(a,b){for(var d=0;d<b.length;d++){var c={};copyService(c,b[d]);a.push(c)}}function copyService(a,b){a.name=b.name;a.type=b.type;b.description&&(a.description=b.description);a.protocols=[];for(var d=0;d<b.protocols.length;d++){var c={};copyProtocol(c,b.protocols[d]);a.protocols.push(c)}}
function copyProtocol(a,b){a.protocol=parseInt(b.protocol);a.protocolExclude=b.protocolExclude;switch(b.protocol){case 1:case 2:a.incomingPorts=b.incomingPorts;a.outgoingPorts=b.outgoingPorts;0<b.incomingPorts&&(a.incomingPortStart=b.incomingPortStart,2==b.incomingPorts&&(a.incomingPortEnd=b.incomingPortEnd));0<b.outgoingPorts&&(a.outgoingPortStart=b.outgoingPortStart,2==b.outgoingPorts?a.outgoingPortEnd=b.outgoingPortEnd:3==b.outgoingPorts&&(a.outgoingPortStart=0,a.outgoingPortEnd=0));a.incomingExclude=
b.incomingExclude;a.outgoingExclude=b.outgoingExclude;break;case 3:a.icmpMessage=parseInt(b.icmpMessage);10==b.icmpMessage&&(a.icmpType=b.icmpType,a.icmpCode=b.icmpCode);break;case 0:a.protocolNumber=b.protocolNumber}}
function printProtocolObject(a,b,d){var c="",e=a.protocol;switch(e){case 1:case 2:1==d&&(a.protocolExclude&&(c+="~"),c+=1==e?"TCP ":"UDP ");a.incomingExclude&&(c+="~");0==a.incomingPorts?c+="Any -> ":1==a.incomingPorts?c+=a.incomingPortStart+" -> ":2==a.incomingPorts&&(c+=a.incomingPortStart+" - "+a.incomingPortEnd+" -> ");a.outgoingExclude&&(c+="~");0==a.outgoingPorts?(c+="Any",1==e&&(c+=" ~4567")):1==a.outgoingPorts?c+=a.outgoingPortStart:2==a.outgoingPorts?(c=c+a.outgoingPortStart+" - "+a.outgoingPortEnd,
4567>=a.outgoingPortStart&&4567<=a.outgoingPortEnd&&1==e&&(c+=" ~4567")):3==a.outgoingPorts&&(c+="Same as Initiating Ports");break;case 0:1==d&&(a.protocolExclude&&(c+="~"),c=0==a.protocolNumber?c+"Protocol Any":c+("Protocol "+a.protocolNumber));break;case 3:c="";1==d&&(a.protocolExclude&&(c+="~"),c+="ICMP ");switch(a.icmpMessage){case 0:c+="Echo Reply";break;case 1:c+="Network Unreachable";break;case 2:c+="Host Unreachable";break;case 3:c+="Protocol Unreachable";break;case 4:c+="Port Unreachable";
break;case 5:c+="Destination Network Unknown";break;case 6:c+="Destination Host Unknown";break;case 7:c+="Redirect for Network";break;case 8:c+="Redirect for Host";break;case 9:c+="Echo Request";break;case 10:c+="Type "+a.icmpType+" Code "+a.icmpCode}break;case 4:1==d&&(a.protocolExclude&&(c+="~"),c+="GRE");break;case 5:1==d&&(c="",a.protocolExclude&&(c+="~"),c+="ESP");break;case 6:1==d&&(a.protocolExclude&&(c+="~"),c+="AH")}b.push(c)}
function getPrintArrayForProtocols(a,b,d){for(var c in a)printProtocolObject(a[c],b,d)}function printProtocolWithName(a,b){for(var d in a)if(0<=d){var c=[];if(void 0===a[d].services||null===a[d].services||0==a[d].services.length)c.push("Any");else{var e=0,f;for(f in a[d].services)getPrintArrayForProtocols(a[d].services[f].protocols,c,1),c[e]=a[d].services[f].name+"-"+c[e],e=c.length}b.push(c)}}
function printProtocol(a,b,d,c){if(0==a)for(var e in b){if(0<=e){a=[];if(void 0===b[e].services||null===b[e].services||0==b[e].services.length)a.push("Any");else for(var f in b[e].services)getPrintArrayForProtocols(b[e].services[f].protocols,a,1);d.push(a)}}else if(1==a)for(e in b)0<=e&&(a=[],getPrintArrayForProtocols(b[e].protocols,a,1),d.push(a));else if(2==a)getPrintArrayForProtocols(b,d,0);else if(6==a)getPrintArrayForProtocols(b,d,1);else if(3==a)for(e in b)void 0!==b[e].id&&null!==b[e].id&&
(a=[],getPrintArrayForProtocols(b[e].outgoing,a,1),d.push(a),a=[],getPrintArrayForProtocols(b[e].incoming,a,1),c.push(a));else if(4==a)for(e=0;8>e;e++)for(var g in b[e].filters)printProtocol(1,b[e].filters[g].services,d[e].protArr);else if(5==a)for(e=0;8>e;e++)for(g in b[e].priorities)printProtocol(1,b[e].priorities[g].services,d[e].protArr)}function init_schedules(a){init_schedule(a);init_timeSegment(a);init_hourRange(a);a.printTimeSegArr=[]}
function init_schedule(a){a.schedule={name:"Scheduler Rule",activeDuring:!0,timeSegments:[]};a.editingRuleSchedule=-1}function init_timeSegment(a){a.hourRanges=[];a.daysOfTheWeek=[!1,!1,!1,!1,!1,!1,!1];a.editingTimeSegment=-1}function init_hourRange(a){a.hourRange={startTimeHour:"00",startTimeMinute:"00",endTimeHour:"00",endTimeMinute:"00"};a.editingHourRange=-1}
function applyRuleScheduler(a,b){if(-1==a.editingRuleSchedule){var d={};copySchedule(d,a.schedule);b.push(d)}else copySchedule(b[a.editingRuleSchedule],a.schedule);init_schedule(a);a.togglePage(0)}
function applyTimeSegment(a){if(-1==a.editingTimeSegment){for(var b={daysOfTheWeek:[],hourRanges:[]},d=0;7>d;d++)a.daysOfTheWeek[d]&&b.daysOfTheWeek.push(d);for(d=0;d<a.hourRanges.length;d++){var c={startTimeMinute:a.hourRanges[d].startTimeMinute,startTimeHour:a.hourRanges[d].startTimeHour,endTimeHour:a.hourRanges[d].endTimeHour,endTimeMinute:a.hourRanges[d].endTimeMinute};b.hourRanges.push(c)}a.schedule.timeSegments.push(b)}else{a.schedule.timeSegments[a.editingTimeSegment].daysOfTheWeek=[];a.schedule.timeSegments[a.editingTimeSegment].hourRanges=
[];for(d=0;7>d;d++)a.daysOfTheWeek[d]&&a.schedule.timeSegments[a.editingTimeSegment].daysOfTheWeek.push(d);for(d=0;d<a.hourRanges.length;d++)c={startTimeHour:a.hourRanges[d].startTimeHour,startTimeMinute:a.hourRanges[d].startTimeMinute,endTimeHour:a.hourRanges[d].endTimeHour,endTimeMinute:a.hourRanges[d].endTimeMinute},a.schedule.timeSegments[a.editingTimeSegment].hourRanges.push(c)}a.printTimeSegArr=[];printSchedule(2,a.schedule.timeSegments,a.printTimeSegArr);init_timeSegment(a);a.togglePage(5)}
function applyHourRange(a){-1==a.editingHourRange?a.hourRanges.push({startTimeHour:a.hourRange.startTimeHour,startTimeMinute:a.hourRange.startTimeMinute,endTimeHour:a.hourRange.endTimeHour,endTimeMinute:a.hourRange.endTimeMinute}):(a.hourRanges[a.editingHourRange].startTimeHour=a.hourRange.startTimeHour,a.hourRanges[a.editingHourRange].startTimeMinute=a.hourRange.startTimeMinute,a.hourRanges[a.editingHourRange].endTimeHour=a.hourRange.endTimeHour,a.hourRanges[a.editingHourRange].endTimeMinute=a.hourRange.endTimeMinute);
init_hourRange(a);a.togglePage(6)}function cancelRuleScheduler(a){init_schedule(a);a.togglePage(0)}function cancelTimeSegment(a){init_timeSegment(a);a.togglePage(5)}function cancelHourRange(a){init_hourRange(a);a.togglePage(6)}function editRuleScheduler(a,b,d){copySchedule(a.schedule,b[d]);a.printTimeSegArr=[];printSchedule(2,a.schedule.timeSegments,a.printTimeSegArr);a.editingRuleSchedule=d;a.togglePage(5)}
function editTimeSegment(a,b){for(var d=0;d<a.schedule.timeSegments[b].daysOfTheWeek.length;d++)a.daysOfTheWeek[a.schedule.timeSegments[b].daysOfTheWeek[d]]=!0;for(d=0;d<a.schedule.timeSegments[b].hourRanges.length;d++)a.hourRanges.push({startTimeHour:a.schedule.timeSegments[b].hourRanges[d].startTimeHour,startTimeMinute:a.schedule.timeSegments[b].hourRanges[d].startTimeMinute,endTimeHour:a.schedule.timeSegments[b].hourRanges[d].endTimeHour,endTimeMinute:a.schedule.timeSegments[b].hourRanges[d].endTimeMinute});
a.editingTimeSegment=b;a.togglePage(6)}function formatTimeValue(a){return 10>a?"0"+a:a}function editHourRange(a,b){a.hourRange.startTimeHour=formatTimeValue(a.hourRanges[b].startTimeHour);a.hourRange.startTimeMinute=formatTimeValue(a.hourRanges[b].startTimeMinute);a.hourRange.endTimeHour=formatTimeValue(a.hourRanges[b].endTimeHour);a.hourRange.endTimeMinute=formatTimeValue(a.hourRanges[b].endTimeMinute);a.editingHourRange=b;a.togglePage(7)}
function copySchedules(a,b){for(var d=0;d<b.length;d++){var c={};copySchedule(c,b[d]);a.push(c)}}function copySchedule(a,b){a.name=b.name;a.activeDuring=b.activeDuring;a.timeSegments=[];copyTimeSegments(a.timeSegments,b.timeSegments)}
function copyTimeSegments(a,b){for(var d=0;d<b.length;d++){for(var c={daysOfTheWeek:[],hourRanges:[]},e=0;e<b[d].daysOfTheWeek.length;e++)c.daysOfTheWeek.push(b[d].daysOfTheWeek[e]);for(e=0;e<b[d].hourRanges.length;e++)c.hourRanges.push({startTimeHour:b[d].hourRanges[e].startTimeHour,startTimeMinute:b[d].hourRanges[e].startTimeMinute,endTimeHour:b[d].hourRanges[e].endTimeHour,endTimeMinute:b[d].hourRanges[e].endTimeMinute});a.push(c)}}
function printTimeSegObject(a,b){for(var d="Mon Tues Wed Thurs Fri Sat Sun".split(" "),c="",e=0;e<a.daysOfTheWeek.length-1;e++)c+=d[a.daysOfTheWeek[e]]+", ";0!=a.daysOfTheWeek.length&&(1<a.daysOfTheWeek.length&&(c+="and "),c+=d[a.daysOfTheWeek[a.daysOfTheWeek.length-1]],c+=" between ",7===a.daysOfTheWeek.length&&(c=" All week between "));for(e=0;e<a.hourRanges.length-1;e++){10>a.hourRanges[e].startTimeHour&&(c+="0");c+=a.hourRanges[e].startTimeHour+":";10>a.hourRanges[e].startTimeMinute&&(c+="0");
c+=a.hourRanges[e].startTimeMinute+"-";10>a.hourRanges[e].endTimeHour&&(c+="0");c+=a.hourRanges[e].endTimeHour+":";10>a.hourRanges[e].endTimeMinute&&(c+="0");c+=a.hourRanges[e].endTimeMinute;if(a.hourRanges[e].startTimeHour>a.hourRanges[e].endTimeHour||a.hourRanges[e].startTimeHour==a.hourRanges[e].endTimeHour&&a.hourRanges[e].startTimeMinute>=a.hourRanges[e].endTimeMinute)c+=" on the next day";c+=", "}0!=a.hourRanges.length&&(1<a.hourRanges.length&&(c+="and "),10>a.hourRanges[a.hourRanges.length-
1].startTimeHour&&(c+="0"),c+=a.hourRanges[a.hourRanges.length-1].startTimeHour+":",10>a.hourRanges[a.hourRanges.length-1].startTimeMinute&&(c+="0"),c+=a.hourRanges[a.hourRanges.length-1].startTimeMinute+"-",10>a.hourRanges[a.hourRanges.length-1].endTimeHour&&(c+="0"),c+=a.hourRanges[a.hourRanges.length-1].endTimeHour+":",10>a.hourRanges[a.hourRanges.length-1].endTimeMinute&&(c+="0"),c+=a.hourRanges[a.hourRanges.length-1].endTimeMinute,a.hourRanges[a.hourRanges.length-1].startTimeHour>a.hourRanges[a.hourRanges.length-
1].endTimeHour||a.hourRanges[a.hourRanges.length-1].startTimeHour==a.hourRanges[a.hourRanges.length-1].endTimeHour&&a.hourRanges[a.hourRanges.length-1].startTimeMinute>=a.hourRanges[a.hourRanges.length-1].endTimeMinute)&&(c+=" on the next day");c=c.replace(", and"," and");b.push(c)}function getPrintArrForTimeSegs(a,b){for(var d=0;d<a.length;d++)printTimeSegObject(a[d],b)}
function printSchedule(a,b,d){var c="Mon Tues Wed Thurs Fri Sat Sun".split(" ");if(0==a)for(var e in b){if(0<=e&&void 0!==b[e].timeSegments){a=[];for(var f=0;f<b[e].timeSegments.length;f++){for(var g="",h=0;h<b[e].timeSegments[f].daysOfTheWeek.length-1;h++)g+=c[b[e].timeSegments[f].daysOfTheWeek[h]]+", ";0!=b[e].timeSegments[f].daysOfTheWeek.length&&(1<b[e].timeSegments[f].daysOfTheWeek.length&&(g+="and "),g+=c[b[e].timeSegments[f].daysOfTheWeek[b[e].timeSegments[f].daysOfTheWeek.length-1]],g+=" between ");
for(h=0;h<b[e].timeSegments[f].hourRanges.length-1;h++){10>b[e].timeSegments[f].hourRanges[h].startTimeHour&&(g+="0");g+=b[e].timeSegments[f].hourRanges[h].startTimeHour+":";10>b[e].timeSegments[f].hourRanges[h].startTimeMinute&&(g+="0");g+=b[e].timeSegments[f].hourRanges[h].startTimeMinute+"-";10>b[e].timeSegments[f].hourRanges[h].endTimeHour&&(g+="0");g+=b[e].timeSegments[f].hourRanges[h].endTimeHour+":";10>b[e].timeSegments[f].hourRanges[h].endTimeMinute&&(g+="0");g+=b[e].timeSegments[f].hourRanges[h].endTimeMinute;
if(b[e].timeSegments[f].hourRanges[h].startTimeHour>b[e].timeSegments[f].hourRanges[h].endTimeHour||b[e].timeSegments[f].hourRanges[h].startTimeHour==b[e].timeSegments[f].hourRanges[h].endTimeHour&&b[e].timeSegments[f].hourRanges[h].startTimeMinute>=b[e].timeSegments[f].hourRanges[h].endTimeMinute)g+=" on the next day";g+=", "}0!=b[e].timeSegments[f].hourRanges.length&&(1<b[e].timeSegments[f].hourRanges.length&&(g+="and "),10>b[e].timeSegments[f].hourRanges[b[e].timeSegments[f].hourRanges.length-
1].startTimeHour&&(g+="0"),g+=b[e].timeSegments[f].hourRanges[b[e].timeSegments[f].hourRanges.length-1].startTimeHour+":",10>b[e].timeSegments[f].hourRanges[b[e].timeSegments[f].hourRanges.length-1].startTimeMinute&&(g+="0"),g+=b[e].timeSegments[f].hourRanges[b[e].timeSegments[f].hourRanges.length-1].startTimeMinute+"-",10>b[e].timeSegments[f].hourRanges[b[e].timeSegments[f].hourRanges.length-1].endTimeHour&&(g+="0"),g+=b[e].timeSegments[f].hourRanges[b[e].timeSegments[f].hourRanges.length-1].endTimeHour+
":",10>b[e].timeSegments[f].hourRanges[b[e].timeSegments[f].hourRanges.length-1].endTimeMinute&&(g+="0"),g+=b[e].timeSegments[f].hourRanges[b[e].timeSegments[f].hourRanges.length-1].endTimeMinute,b[e].timeSegments[f].hourRanges[b[e].timeSegments[f].hourRanges.length-1].startTimeHour>b[e].timeSegments[f].hourRanges[b[e].timeSegments[f].hourRanges.length-1].endTimeHour||b[e].timeSegments[f].hourRanges[b[e].timeSegments[f].hourRanges.length-1].startTimeHour==b[e].timeSegments[f].hourRanges[b[e].timeSegments[f].hourRanges.length-
1].endTimeHour&&b[e].timeSegments[f].hourRanges[b[e].timeSegments[f].hourRanges.length-1].startTimeMinute>=b[e].timeSegments[f].hourRanges[b[e].timeSegments[f].hourRanges.length-1].endTimeMinute)&&(g+=" on the next day");a.push(g)}d.push(a)}}else if(1==a)for(f=0;f<b[0].timeSegments.length;f++){g="";for(h=0;h<b[0].timeSegments[f].daysOfTheWeek.length-1;h++)g+=c[b[0].timeSegments[f].daysOfTheWeek[h]]+", ";0!=b[0].timeSegments[f].daysOfTheWeek.length&&(1<b[0].timeSegments[f].daysOfTheWeek.length&&(g+=
"and "),g+=c[b[0].timeSegments[f].daysOfTheWeek[b[0].timeSegments[f].daysOfTheWeek.length-1]],g+=" between ",7===b[0].timeSegments[f].daysOfTheWeek.length&&(g=" ",g+="All week between "));for(h=0;h<b[0].timeSegments[f].hourRanges.length-1;h++)10>b[0].timeSegments[f].hourRanges[h].startTimeHour&&(g+="0"),g+=b[0].timeSegments[f].hourRanges[h].startTimeHour+":",10>b[0].timeSegments[f].hourRanges[h].startTimeMinute&&(g+="0"),g+=b[0].timeSegments[f].hourRanges[h].startTimeMinute+"-",10>b[0].timeSegments[f].hourRanges[h].endTimeHour&&
(g+="0"),g+=b[0].timeSegments[f].hourRanges[h].endTimeHour+":",10>b[0].timeSegments[f].hourRanges[h].endTimeMinute&&(g+="0"),g+=b[0].timeSegments[f].hourRanges[h].endTimeMinute+", ";0!=b[0].timeSegments[f].hourRanges.length&&(1<b[0].timeSegments[f].hourRanges.length&&(g+="and "),10>b[0].timeSegments[f].hourRanges[b[0].timeSegments[f].hourRanges.length-1].startTimeHour&&(g+="0"),g+=b[0].timeSegments[f].hourRanges[b[0].timeSegments[f].hourRanges.length-1].startTimeHour+":",10>b[0].timeSegments[f].hourRanges[b[0].timeSegments[f].hourRanges.length-
1].startTimeMinute&&(g+="0"),g+=b[0].timeSegments[f].hourRanges[b[0].timeSegments[f].hourRanges.length-1].startTimeMinute+"-",10>b[0].timeSegments[f].hourRanges[b[0].timeSegments[f].hourRanges.length-1].endTimeHour&&(g+="0"),g+=b[0].timeSegments[f].hourRanges[b[0].timeSegments[f].hourRanges.length-1].endTimeHour+":",10>b[0].timeSegments[f].hourRanges[b[0].timeSegments[f].hourRanges.length-1].endTimeMinute&&(g+="0"),g+=b[0].timeSegments[f].hourRanges[b[0].timeSegments[f].hourRanges.length-1].endTimeMinute);
g=g.replace(", and"," and");d.push(g)}else 2==a&&getPrintArrForTimeSegs(b,d)}function removeObject(a,b,d,c){a.splice(b,1);2==d&&(c.printPortsArr=[],printProtocol(2,c.service.protocols,c.printPortsArr))}function copyArrayFromSource(a){for(var b=[],d=0;d<a.length;d++)b.push(a[d]);return b}
function copyTrigger(a,b){a.name=b.name;a.enabled=b.enabled;for(var d=0;d<b.outgoing.length;d++){var c={};copyProtocol(c,b.outgoing[d]);a.outgoing.push(c)}for(d=0;d<b.incoming.length;d++)c={},copyProtocol(c,b.incoming[d]),a.incoming.push(c)}
function applyAddressCheck(a){a.rule.networkObjType=parseInt(a.rule.networkObjType);a.rule.dhcpType=parseInt(a.rule.dhcpType);a.errorMessages=[];switch(a.rule.networkObjType){case 0:validateIp(a.rule.ip)||a.errorMessages.push("IP Address: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces.");break;case 1:validateIp(a.rule.ip)&&validateIp(a.rule.ipTwo)?"0.0.0.0"===getIpString(a.rule.ipTwo)?a.errorMessages.push("IP Address and Subnet Mask combination: Subnet mask may not be 0.0.0.0. Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0."):
validateSubnetMask(a.rule.ipTwo)||a.errorMessages.push("IP Address and Subnet Mask combination:  Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0."):a.errorMessages.push("IP Address and Subnet Mask combination: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces.");break;case 2:if(validateIp(a.rule.ip)&&validateIp(a.rule.ipTwo))for(var b=
0;4>b&&!(a.rule.ip[b]<a.rule.ipTwo[b]);b++){if(a.rule.ip[b]!=a.rule.ipTwo[b]){a.errorMessages.push("IP Range: Start IP address is greater than End IP address.");break}}else a.errorMessages.push("IP Range: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces.");0==a.errorMessages.length&&getIpString(a.rule.ip)===getIpString(a.rule.ipTwo)&&(a.rule.networkObjType=0);break;case 3:checkMacAddress(a,a.rule.mac);getMacString(a.rule.macMask)&&!/^[0\:]{17}$/.test(getMacString(a.rule.macMask))&&
validateMac(getMacString(a.rule.macMask))||a.errorMessages.push("MAC Mask: MAC address mask must consist of 6 fields. Each field's value must be between 00 and FF (in hexadecimal representation).");break;case 4:validateHostname(a.rule.hostname)||a.errorMessages.push("Host Name: Name may not contain spaces. Only letters, digits and the special characters dash (-), underscore (_) and dot (.) may be used. These special characters may not appear at the beginning or at the end of a name. The maximum length of a label (text between two dots) is 63.");
break;case 5:""===a.rule.hostname&&a.errorMessages.push("DHCP Option: A string must be specified.")}0<a.errorMessages.length&&(a.showErrorPage=!0,window.scrollTo(0,0))}
function checkMacAddress(a,b){if(!validateMac(getMacString(b)))a.errorMessages=["MAC Address: MAC address must consist of 6 fields. Each field's value must be between 00 and FF (in hexadecimal representation), without any spaces. The LSB of the first byte must be zero."];else if(/[f\:]{17}$/i.test(getMacString(b)))a.errorMessages.push("MAC Address: MAC FF:FF:FF:FF:FF:FF is reserved for broadcast.");else if(!validateMac(getMacString(b))||/[0\:]{17}$/i.test(b)||1==(parseInt(b[0],16)&1))a.errorMessages=
["MAC Address: MAC address must consist of 6 fields. Each field's value must be between 00 and FF (in hexadecimal representation), without any spaces. The LSB of the first byte must be zero."]}function checkAndFindNetworkObject(a,b,d){var c=!0;if(0<a.length)for(var e=0;e<a.length;e++)"DHCP"==a[e].name&&4==a[e].type&&a[e].rules[0].name==b&&7==a[e].rules[0].networkObjType&&(c=!1);c&&a.push({name:"DHCP",type:4,rules:[{name:b,networkObjType:7,ipAddress:d}]})}
function compareHosts(a,b){var d=!0,c=!1;if(a.length==b.length&&0==a.length)d=!0;else if(0<a.length&&0<b.length)for(var e=0;e<a.length;e++){for(var c=!1,f=0;f<b.length;f++)if(a[e]==b[e]){c=!0;break}if(!1==c){d=!1;break}}else d=0==a.length?!0:!1;return d}
function compareNetworkObjects(a,b){var d=!0,c=!1;if(a.length==b.length&&0==a.length)d=!0;else if(0<a.length&&0<b.length)for(var e=0;e<a.length;e++){for(var c=!1,f=0;f<b.length;f++)if(compareNetObjects(a[e],b[f])){c=!0;break}if(!1==c){d=!1;break}}else d=!1;return d}function compareNetObjects(a,b){var d=!0;a.name!=b.name&&(d=!1);a.rules.length==b.rules.length?a.rules[0].ipAddress!=b.rules[0].ipAddress&&(d=!1):d=!1;return d}
function compareServices(a,b){var d=!0,c=!1;if(a.length==b.length&&0==a.length)d=!0;else if(0<a.length&&0<b.length)for(var e=0;e<a.length;e++){for(var c=!1,f=0;f<b.length;f++)if(compareService(a[e],b[f])){c=!0;break}if(!1==c){d=!1;break}}else d=!1;return d}function compareService(a,b){var d=!0;a.name!=b.name&&(d=!1);a.description!=b.description&&(d=!1);!0==d&&(d=compareProtocols(a.protocols,b.protocols));return d}
function compareProtocols(a,b){var d=!0,c=!1;if(0==a.length&&0==b.length)d=!0;else if(0<a.length&&0<b.length)for(var e=0;e<a.length;e++){for(var c=!1,f=0;f<b.length;f++)compareProtocol(a[e],b[f])&&(c=!0);if(!1==c){d=!1;break}}else d=!1;return d}
function compareProtocol(a,b){var d=!0;a.incomingExclude!=b.incomingExclude&&(d=!1);a.incomingPorts!=b.incomingPorts&&(d=!1);a.outgoingExclude!=b.outgoingExclude&&(d=!1);a.outgoingPortStart!=b.outgoingPortStart&&(d=!1);a.outgoingPorts!=b.outgoingPorts&&(d=!1);a.protocol!=b.protocol&&(d=!1);a.protocolExclude!=b.protocolExclude&&(d=!1);return d}
function compareAllSchedules(a,b,d){var c=!0;return c=void 0!=a&&(void 0==a||a.hasOwnProperty("name"))||void 0!=b&&(void 0==b||b.hasOwnProperty("name"))?void 0==a||void 0!=a&&!a.hasOwnProperty("name")||void 0==b||void 0!=b&&!b.hasOwnProperty("name")?!1:compareSchedules(a,b,d):!0}
function compareSchedules(a,b,d){var c=!0;-2==d?a.name!=b.name&&(c=!1):-1!=d?escape(a.name)!=b.name&&(c=!1):-1==d&&escape(a.name).replace(/\+/g,"%2B")!=b.name&&(c=!1);a.activeDuring!=b.activeDuring&&(c=!1);!0==c&&(c=compareSchedule(a.timeSegments,b.timeSegments));return c}
function compareSchedule(a,b){var d=!0,c=!1;if(0==a.length&&0==b.length)d=!0;else if(0<a.length&&0<b.length)for(var e=0;e<a.length;e++){for(var c=!1,f=0;f<b.length;f++)compareTimeSegments(a[e],b[f])&&(c=!0);if(!1==c){d=!1;break}}else d=!1;return d}function compareTimeSegments(a,b){var d=!0,d=compareDates(a.daysOfTheWeek,b.daysOfTheWeek);!0==d&&(d=compareHourRanges(a.hourRanges,b.hourRanges));return d}
function compareHourRanges(a,b){var d=!0,c=!1;if(0!=a.length||0!=b.length)if(0<a.length&&0<b.length)for(var e=0;e<a.length;e++){for(var c=!1,f=0;f<b.length;f++)compareHourRange(a[e],b[f])&&(c=!0);if(!1==c){d=!1;break}}else d=!1;return d}function compareHourRange(a,b){var d=!0;a.endTimeHour!=b.endTimeHour&&(d=!1);a.endTimeMinute!=b.endTimeMinute&&(d=!1);a.startTimeHour!=b.startTimeHour&&(d=!1);a.startTimeMinute!=b.startTimeMinute&&(d=!1);return d}
function compareDates(a,b){for(var d=!0,c=!1,e=0;e<a.length;e++){for(var c=!1,f=0;f<b.length;f++)compareDate(a[e],b[f])&&(c=!0);if(!1==c){d=!1;break}}return d}function compareDate(a,b){var d=!0;a!=b&&(d=!1);return d};angular.module("igmp.controllers",[]).controller("IgmpProxyCtrl",["$scope","$route","$location","IGMPProxy",function(a,b,d,c){a.tab=b.current.tab;a.section=b.current.section;a.showErrorPage=!1;a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.igmp=c.get();a.save=function(){a.errorMessages=[];a.igmp.enabled="true"===""+a.igmp.enabled;a.igmp.fastLeave="true"===""+a.igmp.fastLeave;(null==a.igmp.robustness||isNaN(a.igmp.robustness)||1>a.igmp.robustness)&&a.errorMessages.push("IGMP Proxy: Invalid IGMP Robustness (>=1)");
isNaN(a.igmp.queryInterval)||1>a.igmp.queryInterval?a.errorMessages.push("IGMP Proxy: Invalid IGMP Query Interval (>=1)"):(isNaN(a.igmp.queryResponseInterval)||1>a.igmp.queryResponseInterval||parseInt(a.igmp.queryResponseInterval)>=parseInt(a.igmp.queryInterval))&&a.errorMessages.push("IGMP Proxy: Invalid IGMP Query Response Interval (>=1 and <"+a.igmp.queryInterval+")");(isNaN(a.igmp.reportInterval)||1>a.igmp.reportInterval||25<a.igmp.reportInterval)&&a.errorMessages.push("IGMP Proxy: Invalid IGMP Client Unsolicited Report Interval (>=1 and <=25)");
0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.igmp.version=parseInt(a.igmp.version),a.igmp.robustness=parseInt(a.igmp.robustness),a.igmp.queryInterval=parseInt(a.igmp.queryInterval),a.igmp.queryResponseInterval=parseInt(a.igmp.queryResponseInterval),a.igmp.reportInterval=parseInt(a.igmp.reportInterval),a.igmp.$update(function(){d.path("/advanced")}))}}]).controller("IgmpAclCtrl",["$scope","$route","$location","IGMPAcl",function(a,b,d,c){a.tab=b.current.tab;a.section=b.current.section;
a.showErrorPage=!1;a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.acl=c.get();a.whiteListClicked=function(){a.acl.whiteListEnabled||(a.acl.blackListEnabled=!1)};a.blackListClicked=function(){a.acl.blackListEnabled||(a.acl.whiteListEnabled=!1)};a.save=function(){a.acl.$update();c.update({whiteListEnabled:a.acl.whiteListEnabled,blackListEnabled:a.acl.blackListEnabled},function(){location.reload()})};a.saveAddress=function(){a.errorMessages=[];validateMulticastAddr(a.multicast)||
a.errorMessages.push("Multicast Address: The multicast address you input is not valid! It should be from 224.0.0.0 to 239.255.255.255");validateSubnetMask(a.netmask)||a.errorMessages.push("Multicast Address: Subnet mask may not be 0.0.0.0. Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0.");if(0<a.errorMessages.length)a.showErrorPage=!0,window.scrollTo(0,0);else if(a.editing=
!1,-1==a.editObj){var b={ip:getIpString(a.multicast),netmask:getIpString(a.netmask)};0==a.editList?(a.acl.whiteList.push(b),c.update({whiteList:a.acl.whiteList})):(a.acl.blackList.push(b),c.update({blackList:a.acl.blackList}))}else 0==a.editList?(a.acl.whiteList[a.editObj].ip=getIpString(a.multicast),a.acl.whiteList[a.editObj].netmask=getIpString(a.netmask),c.update({whiteList:a.acl.whiteList})):(a.acl.blackList[a.editObj].ip=getIpString(a.multicast),a.acl.blackList[a.editObj].netmask=getIpString(a.netmask),
c.update({blackList:a.acl.blackList}))};a.addWhitelist=function(){a.editObj=-1;a.editing=!0;a.editList=0;a.netmask=[0,0,0,0];a.multicast=[0,0,0,0]};a.addBlacklist=function(){a.editObj=-1;a.editing=!0;a.editList=1;a.netmask=[0,0,0,0];a.multicast=[0,0,0,0]};a.editWhiteList=function(b){a.editing=!0;a.editList=0;a.editObj=b;a.netmask=splitIpArr(a.acl.whiteList[b].netmask);a.multicast=splitIpArr(a.acl.whiteList[b].ip)};a.editBlackList=function(b){a.editing=!0;a.editList=1;a.editObj=b;a.netmask=splitIpArr(a.acl.blackList[b].netmask);
a.multicast=splitIpArr(a.acl.blackList[b].ip)};a.removeWhiteList=function(b){a.acl.whiteList.splice(b,1);c.update({whiteList:a.acl.whiteList})};a.removeBlackList=function(b){a.acl.blackList.splice(b,1);c.update({blackList:a.acl.blackList})};a.cancel=function(){a.editing=!1}}]).controller("IgmpHostsCtrl",["$scope","$route","$location","IGMPHosts",function(a,b,d,c){a.tab=b.current.tab;a.section=b.current.section;a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.hosts=c.query();a.editHost=
function(b){a.editing=!0;a.editDev={};for(var c in a.hosts[b])a.hosts[b].hasOwnProperty(c)&&(a.editDev[c]=a.hosts[b][c]);-1==a.editDev.maxConn&&(a.editDev.maxConn=8);a.editingIndex=b};a.applyEdit=function(){a.errorMessages=[];(isNaN(a.editDev.maxConn)||""===a.editDev.maxConn||0>a.editDev.maxConn||256<a.editDev.maxConn)&&a.errorMessages.push("Max Channels: Maximum channel allowed should be in the range of 0 - 256");0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.editDev.maxConn=
parseInt(a.editDev.maxConn),a.editing=!1,c.update({id:a.editDev.id},a.editDev,function(){a.hosts=c.query()}))};a.cancel=function(){a.editing=!1}}]).controller("IgmpIntfCtrl",["$scope","$route","$location","IGMPInterfaces",function(a,b,d,c){a.tab=b.current.tab;a.section=b.current.section;a.igmpintf=c.get(function(){for(var b=0;b<a.igmpintf.interfaces.length;b++)a.igmpintf.interfaces[b].name=unescape(a.igmpintf.interfaces[b].name)});a.save=function(){a.igmpintf.$update(function(){location.reload()})};
a.cancel=function(){}}]).controller("IgmpServCtrl",["$scope","$route","$location","IgmpServices",function(a,b,d,c){a.tab=b.current.tab;a.section=b.current.section;a.page=0;a.showErrorPage=!1;a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.refresh=function(){a.services=c.query(function(){for(var b=0;b<a.services.length;b++)a.services[b].service=unescape(a.services[b].service)})};a.refresh();a.editService=function(b){a.editing=b;b=a.services[b];a.temp={service:b.service,maxStbs:b.maxStbs,
maxNonStbs:b.maxNonStbs,ranges:[]};for(var c=0;c<b.ranges.length;c++)a.temp.ranges.push({address:b.ranges[c].address,netmask:b.ranges[c].netmask});a.page=1;window.scrollTo(0,0)};a.deleteService=function(b){c.remove({id:b},function(){a.refresh()});window.scrollTo(0,0)};a.addService=function(){a.editing=-1;a.page=1;window.scrollTo(0,0);a.temp={service:"",maxStbs:0,maxNonStbs:0,ranges:[]}};a.save=function(){a.errorMessages=[];""==a.temp.service&&a.errorMessages.push("Service: A string must be specified.");
(""===a.temp.maxStbs||isNaN(a.temp.maxStbs)||0>a.temp.maxStbs||256<a.temp.maxStbs)&&a.errorMessages.push("Max STBs: Maximum STBs allowed should be in the range of 0 - 256");(""===a.temp.maxStbs||isNaN(a.temp.maxNonStbs)||0>a.temp.maxNonStbs||256<a.temp.maxNonStbs)&&a.errorMessages.push("Max non-STBs: Maximum non-STBs allowed should be in the range of 0 - 256");0==a.temp.ranges.length&&a.errorMessages.push("Multicast Address Range:  At least one item entry must be defined.");0<a.errorMessages.length?
a.showErrorPage=!0:(a.temp.maxStbs=Number(a.temp.maxStbs),a.temp.maxNonStbs=Number(a.temp.maxNonStbs),a.temp.service=escape(a.temp.service),-1!=a.editing?c.update({id:a.editing},a.temp,function(){a.refresh()}):c.save(a.temp,function(){a.refresh()}),a.page=0);window.scrollTo(0,0)};a.addMulticast=function(){a.multicastIndex=-1;a.page=2;a.multicast=[0,0,0,0];a.netmask=[0,0,0,0];window.scrollTo(0,0)};a.editMulticast=function(b){a.multicastIndex=b;a.multicast=splitIpArr(a.temp.ranges[b].address);a.netmask=
splitIpArr(a.temp.ranges[b].netmask);a.page=2;window.scrollTo(0,0)};a.saveRange=function(){a.errorMessages=[];validateMulticastAddr(a.multicast)||a.errorMessages.push("Multicast Address: The multicast address you input is not valid! It should be from 224.0.0.0 to 239.255.255.255");validateSubnetMask(a.netmask)||a.errorMessages.push("Multicast Address: Subnet mask may not be 0.0.0.0. Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0.");
0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.page=1,window.scrollTo(0,0),-1==a.multicastIndex?a.temp.ranges.push({address:getIpString(a.multicast),netmask:getIpString(a.netmask)}):(a.temp.ranges[a.multicastIndex].address=getIpString(a.multicast),a.temp.ranges[a.multicastIndex].netmask=getIpString(a.netmask)))};a.cancelRange=function(){a.page=1;window.scrollTo(0,0)};a.cancelAdd=function(){a.page=0;window.scrollTo(0,0)}}]);var systemSettings=null;
angular.module("main.controllers",[]).controller("MainCtrl",["$scope","$route","Devices","NetworkConnections","FirmwareUpgrade","Logout","$location","SystemSettings","securityTips",function(a,b,d,c,e,f,g,h,k){a.tab=b.current.tab;a.hasFailedLogin=!1;a.failedLogin=0;a.devices=d.query(function(){for(var b=0;b<a.devices.length;b++)setDeviceStyle(a.devices[b]),a.devices[b]=checkDeviceIP(a.devices[b])});a.fwInfo=e.get();var l="";a.ipString2="";a.ArrStr=[];a.broadband=null;var q=c.query(function(){for(var b=
0;b<q.length;b++)if(1==q[b].type){a.broadband=q[b];for(var b=a.broadband.ipv6Address.split(":"),c=0;c<b.length;c++)l=l+b[c]+":",4>c&&a.ArrStr.push(l);for(c=4;c<b.length;c++)a.ipString2=a.ipString2+b[c]+":";a.ipString2=a.ipString2.substring(0,a.ipString2.length-1);break}});a.systemSettings=h.get(function(){a.hasFailedLogin=!1;a.failedLogin=a.systemSettings.previousFailedLogins;0<a.failedLogin&&(a.hasFailedLogin=!0)});a.noConnection=function(){k.showCustomMessage3("Warning",["You need to be connected to the internet to view the User Guide"])}}]).controller("empty",
["$scope","$route","Login",function(a,b,d){a.tab=b.current.tab;a.section=b.current.section;d.get()}]).controller("LoginCtrl",["$scope","$rootScope","$location","$routeParams","Login","SystemSettings","$timeout",function(a,b,d,c,e,f,g){function h(){var a=window.navigator.userAgent,b=a.indexOf("MSIE "),c=a.indexOf("Trident/");return 0<b?parseInt(a.substring(b+5,a.indexOf(".",b)),10):0<c?(b=a.indexOf("rv:"),parseInt(a.substring(b+3,a.indexOf(".",b)),10)):!1}a.cookiesEnabled="cookie"in document&&(0<document.cookie.length||
-1<(document.cookie="test").indexOf.call(document.cookie,"test"));if(!a.cookiesEnabled&&h()){var k;k=-1!=d.$$host.indexOf("_")?!0:!1;k?a.isUrlError=!0:a.isUrlError=!1}a.cookiesEnabled?(a.username="admin",a.password="",a.showError=!1,a.showTimeout=!1,a.loggingIn=!1,a.showPassword=!1,a.setupRedirect=!0,a.requirePassword=!0,a.isWireless=!1,a.showPasswordForm=!0,c.setup&&(a.setupRedirect=c.setup),null!=c.fromlogout&&(a.showError=!0,a.errorMessage="User has logged out, please login again."),e.get(function(){null==
systemSettings?systemSettings=f.get(function(){b.loggedIn=!0;b.nextLocation&&"/login"!=b.nextLocation?d.path(b.nextLocation):d.path("/main");d.replace()}):(b.loggedIn=!0,b.nextLocation&&"/login"!=b.nextLocation?d.path(b.nextLocation):d.path("/main"),d.replace())},function(b){a.loggingIn=!0;a.timeout1=!1;a.timeout24=!1;switch(b.data.error){case 1:a.showError=!0,a.errorMessage=null!=c.rebooting?"Wireless Broadband Router is up again, please login:":"Connection has expired, please login again:";default:a.passwordSalt=
b.data.passwordSalt;if(!0==b.data.requirePassword||!1==b.data.requirePassword)a.requirePassword=b.data.requirePassword;if(!0==b.data.isWireless||!1==b.data.isWireless)a.isWireless=b.data.isWireless;a.showPasswordForm=a.isWireless||a.requirePassword?!0:!1;if(b.data.doSetupWizard&&"false"!==a.setupRedirect)d.path("/setup");else switch(b.data.denyState){case 1:a.timeout1=!0;g(function(){a.timeout1=!1;a.showError=!1},6E4*Number(b.data.denyTimeout));a.showError=!0;a.errorMessage="Login has been disabled for 1 minute. If you have not changed your password, you can find it on the router\u2019s sticker.";
a.password="";break;case 2:a.timeout24=!0,g(function(){a.timeout24=!1;a.showError=!1},6E4*Number(b.data.denyTimeout)),a.showError=!0,a.errorMessage="Login has been disabled for 24 hours. Please wait 24 hours before trying again, or call Verizon for a password reset",a.password=""}}}),a.handleKeyPress=function(b){13==b&&a.login()},a.login=function(){var c={};c.password=CryptoJS.SHA512(a.password+a.passwordSalt).toString();e.save({},c,function(){systemSettings=f.get(function(){b.loggedIn=!0;b.nextLocation&&
"/login"!=b.nextLocation?d.path(b.nextLocation):d.path("/main");d.search({});d.replace()})},function(b){a.showError=!0;a.timeout24=!1;a.timeout1=!1;switch(b.data.denyState){case 1:a.timeout1=!0;g(function(){a.timeout1=!1;a.showError=!1},6E4*Number(b.data.denyTimeout));a.errorMessage="Login has been disabled for 1 minute. If you have not changed your password, you can find it on the router\u2019s sticker.";a.password="";break;case 2:a.timeout24=!0;g(function(){a.timeout24=!1;a.showError=!1},6E4*Number(b.data.denyTimeout));
a.errorMessage="Login has been disabled for 24 hours. Please wait 24 hours before trying again, or call Verizon for a password reset";a.password="";break;default:a.errorMessage=2==b.data.error?"Sessions Number: No more than "+b.data.maxUsers+" sessions at a time are allowed. Please wait until open sessions expire.":"Login failed, please try again:",a.password=""}})}):a.retry=function(){location.reload()}}]).controller("LogoutCtrl",["$scope","$location","Logout",function(a,b,d){d.get(function(){b.path("/login").search({fromlogout:"true"});
b.replace()})}]).controller("SetupCtrl",["$scope","$location","Login","Logout","Users","Wireless","SetupWizard","SystemSettings","$timeout",function(a,b,d,c,e,f,g,h,k){a.page=0;a.dontShowAgain=!1;c.get(function(){d.get(function(){},function(b){a.passwordSalt=b.data.passwordSalt;a.isWireless=b.data.isWireless;a.timeout1=!1;a.timeout24=!1;switch(b.data.denyState){case 1:a.timeout1=!0;k(function(){a.timeout1=!1;a.errorMessage=""},6E4*Number(b.data.denyTimeout));break;case 2:a.timeout24=!0,k(function(){a.timeout24=
!1;a.errorMessage=""},6E4*Number(b.data.denyTimeout))}})});a.print=function(){window.print()};a.handlePassKeyUp=function(b){13==b&&a.login()};a.doLater=function(){a.dontShowAgain?d.update({doSetupWizard:!1},function(){b.path("/login")}):b.path("/login").search({setup:"false"})};a.getStarted=function(){a.setLoginSection()};a.loginCancelSetup=function(){b.path("/login").search({setup:"false"})};a.setLoginSection=function(){a.page=1;a.password="";a.showPassword=!1;a.errorMessage="";a.timeout24&&(a.errorMessage=
"Login has been disabled for 24 hours. Please wait 24 hours before trying again, or call Verizon for a password reset");a.timeout1&&(a.errorMessage="Login has been disabled for 1 minute. If you have not changed your password, you can find it on the router\u2019s sticker.")};a.login=function(){var b={};b.password=CryptoJS.SHA512(a.password+a.passwordSalt).toString();d.save({},b,function(){systemSettings=h.get(function(){a.setEditSection()})},function(b){a.timeout1=!1;a.timeout24=!1;switch(b.data.denyState){case 1:a.timeout1=
!0;k(function(){a.timeout1=!1;a.errorMessage=""},6E4*Number(b.data.denyTimeout));a.errorMessage="Login has been disabled for 1 minute. If you have not changed your password, you can find it on the router\u2019s sticker.";a.password="";break;case 2:a.timeout24=!0;k(function(){a.timeout24=!1;a.errorMessage=""},6E4*Number(b.data.denyTimeout));a.errorMessage="Login has been disabled for 24 hours. Please wait 24 hours before trying again, or call Verizon for a password reset";a.password="";break;default:a.errorMessage=
2==b.data.error?"Sessions Number: No more than "+b.data.maxUsers+" sessions at a time are allowed. Please wait until open sessions expire.":"Login failed, please try again:",a.password=""}})};a.setEditSection=function(){a.showErrorPage=!1;a.page=2;a.isNewPassword=!1;a.isNewSsid=!1;a.isNewWifiPw=!1;a.newPassword=a.password;a.rePassword="";a.wireless=f.get({id:0},function(){a.wireless.ssid=unescape(a.wireless.ssid);a.oldSsid=a.wireless.ssid;a.dispSecurity="WPA2 Key";a.secKey=a.wireless.security.wpa.key;
a.oldKey=a.secKey});a.modifyWifi=!1;a.secType=3};a.setMaxlength=function(a){return 1===Number(a)?13:63};a.secChanged=function(){0==a.secType?(a.dispSecurity="WPA2 Key",a.secKey=a.wireless.security.wpa.key):1==a.secType?(a.dispSecurity="WEP Key",a.secKey=a.wireless.security.wep.settings[0].key):3==a.secType?(a.dispSecurity="WPA2 Key",a.secKey=a.wireless.security.wpa.key):(a.dispSecurity="None",a.secKey="");a.oldKey=a.secKey;a.isNewWifiPw=!1};a.handleKeyPress=function(){a.isNewPassword=a.password!==
a.newPassword};a.handleSsidChange=function(){a.isNewSsid=a.oldSsid!==a.wireless.ssid};a.handleWifiPwChange=function(){a.isNewWifiPw=a.oldKey!==a.secKey};a.editWifi=function(){a.modifyWifi=!0};a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.acceptSettings=function(){a.errorMessages=[];var b={security:{}};a.isNewSsid&&(b.ssid=escape(a.wireless.ssid),(1>a.wireless.ssid.length||64<a.wireless.ssid.length||!/^[0-9a-zA-Z\!\"\#\$\%\&\u2019\'\(\)\*\+\,\-\.\/\:\;\<\=\>\?\@\[\\\]\^\_\`\{\|\}\~\ ]+$/i.test(a.wireless.ssid))&&
a.errorMessages.push("Service Set Identifier must consist of 1 to 64 characters and must not contain any special character."));b.security.enabled=2!=a.secType;b.security.enabled&&(1==a.secType?b.security.type=0:0==a.secType?b.security.type=1:3==a.secType&&(b.security.type=2),0==a.secType||3==a.secType?(b.security.wpa={key:a.secKey},8>a.secKey.length&&a.errorMessages.push("Pre-Shared Key: Pass-Phrase has to be at least 8 characters long.")):(b.security.wep={activeSetting:0,settings:[{key:a.secKey,
keyLength:1,entryMethod:1}]},13!=a.secKey.length?a.errorMessages.push("The WEP key must be a string of 13 characters."):/[\x21-\x7E]{13}$/i.test(a.secKey)||a.errorMessages.push("Invalid WEP Key. Only ASCII characters are allowed.")));a.isNewPassword&&(a.newPassword!=a.rePassword?a.errorMessages.push("Passwords do not match."):0==a.newPassword.length&&a.errorMessages.push("A password must be specified."));if(0<a.errorMessages.length)a.showErrorPage=!0;else{if(a.isNewPassword){var c=uuid(),d=CryptoJS.SHA512(a.newPassword+
c).toString();g.update({},{wifi:b,password:d,salt:c})}else g.update({},{wifi:b});a.page=4}};a.confirmSettings=function(){a.isWireless?!1===a.isNewSsid&&!1===a.isNewWifiPw?b.path("/main"):a.page=5:b.path("/main")}}]);function Route(a){var b={};b.type=a;b.destination="0.0.0.0";b.netmask="0.0.0.0";b.gateway="0.0.0.0";b.metric=3;return b}function setDeviceStyle(a){var b;switch(a.icon){case 0:b="computer";break;case 1:b="tablet";break;case 2:b="camera";break;case 3:b="printer";break;case 4:b="ip-stb";break;case 5:b="phone";break;case 6:b="nas";break;default:b="unknown"}b+="-image";a.status||(b+=" inact");a.styleName=b}
angular.module("network.controllers",[]).controller("NetworkCtrl",["$scope","$route","Devices","$location","IPv6",function(a,b,d,c,e){a.tab=b.current.tab;a.section=b.current.section;a.devices=d.query();a.ipv6=e.get();a.deviceTypes=function(b){var c=0;angular.forEach(a.devices,function(a){a.connectionType==b&&(c+=1);setDeviceStyle(a);checkDeviceIP(a)});return c};a.checkNetworkConnections=function(){c.path("/network/connections")}}]).controller("NetworkConnectionsCtrl",["$scope","$route","$location",
"NetworkConnections","$routeParams","SystemSettings","$templateCache","Devices",function(a,b,d,c,e,f,g,h){a.tab=b.current.tab;a.section=b.current.section;a.detectBroadband=!1;a.restarting=!1;a.rebootingPage=!1;a.getStyleName=function(a){switch(a){case 0:return"Network";case 1:return"Network";case 2:return"Wireless";case 3:return"Wireless";case 4:return"Ethernet";case 5:return"Coax";default:return"Network"}};null!=e.fromdevicenetwork&&d.path("/network/connections/0");a.checkForDevicesNow=function(a,
b){var c=!1,d="";switch(String(b)){case "2":d="4";break;case "3":d="5";break;case "4":d="0";break;default:return!1}if(0<a.length){for(var e=0;e<a.length;e++)if(String(a[e].connectionType)==String(d)&&!0==a[e].status){c=!0;break}return c}return!1};var k,l=h.query(function(){k=c.query(function(){a.names=[];for(var b=[],c=0;c<k.length;c++)if(!k[c].done&&(k[c].done=!0,k[c].isChild=!1,k[c].styleName=a.getStyleName(k[c].connectionId),k[c].hasConnectedDeviceNow=a.checkForDevicesNow(l,k[c].connectionId),
b.push(k[c]),a.names.push(unescape(k[c].name)),k[c].availableBridges))for(var d=0;d<k[c].availableBridges.length;d++){var e=k[c].availableBridges[d];1!=e&&(k[e].isChild=!0,k[e].done||(k[e].styleName="BridgedItem "+a.getStyleName(k[e].connectionId),b.push(k[e]),a.names.push(unescape(k[e].name)),k[e].done=!0,k[e].hasConnectedDeviceNow=a.checkForDevicesNow(l,k[e].connectionId)))}a.connections=b})});a.showChildren=!1;a.detectConfirm=function(){systemSettings.warnBeforeChanges?a.detectBroadband=!0:a.doDetectBroadband()};
a.detectCancel=function(){a.detectBroadband=!1};a.doDetectBroadband=function(){c.update({id:1},{detectBroadband:!0},function(){a.rebootingPage=!0;window.setTimeout(a.testConnection,0)})};a.testConnection=function(){f.get(function(){window.setTimeout(a.testConnection,3E3)},function(b){401==b.status?(a.restarting=!0,g.removeAll(),d.path("/login").search({rebooting:"true"})):window.setTimeout(a.testConnection,3E3)})};a.toggleChildren=function(){a.showChildren=!a.showChildren};a.checkNetworkConnections=
function(){d.path("/network/connections")}}]).controller("NetworkConnectionCtrl",["$scope","$route","$routeParams","$location","NetworkConnections","Devices",function(a,b,d,c,e,f){a.tab=b.current.tab;a.section=b.current.section;a.fromString="";a.oldFrom="";a.prev="";if(null!=d.from){a.fromString="?from="+d.from;b=d.from.split("-");"arptable"==b[b.length-1]?a.back="/advanced/arptable":"connlist"==b[b.length-1]?a.back="/advanced/dhcp/connections":"edit"==b[b.length-1]?a.back="/network/connections/0/edit":
-1!=b[b.length-1].indexOf("dev_")?a.back="/network/device/details/"+b[b.length-1].substr(4):""===b[b.length-1]||isNaN(b[b.length-1])||(a.back="/network/connections/"+b[b.length-1]);for(var g=0;g<b.length-1;g++)0!=g&&(a.oldFrom+="-"),a.oldFrom+=b[g];""!==a.oldFrom&&(a.prev="?from="+a.oldFrom)}else a.back="/network/connections";a.deviceNames=[];a.checkForDevicesNow=function(a,b){var c=!1,d="";switch(String(b)){case "2":d="4";break;case "3":d="5";break;case "4":d="0";break;default:return!1}if(0<a.length){for(var e=
0;e<a.length;e++)if(String(a[e].connectionType)==String(d)&&!0==a[e].status){c=!0;break}return c}return!1};var h,k=f.query(function(){h=e.get({id:d.id},function(){a.name=unescape(h.name);h.hasConnectedDeviceNow=a.checkForDevicesNow(k,h.connectionId);a.connections=e.query(function(){for(var b=0;b<a.connections.length;b++);h.underlyingDevices&&angular.forEach(h.underlyingDevices,function(b){angular.forEach(a.connections,function(c){c.connectionId==b&&a.deviceNames.push(unescape(c.name))})});a.connection=
h;a.connFromString=""===a.fromString?"?from="+a.connection.connectionId:a.fromString+"-"+a.connection.connectionId;a.showIpv6=!1;void 0!==h.ipv6Address&&"::"!==h.ipv6Address&&""!==h.ipv6Address&&(a.showIpv6=!0)})})});a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.toggleEnabled=function(){e.update({id:h.connectionId},{enabled:!h.enabled},function(){location.reload()})};a.toggleCoaxEnabled=function(){e.update({id:h.connectionId},{coaxEnabled:!h.coaxEnabled},function(){location.reload()})};
a.cancelBtn=function(){window.scrollTo(0,0);null!=d.fromsystemtraffic?c.url("/monitoring/traffic"):null!=d.fromsystemfullstatus?c.url("/monitoring/fullstatus"):null!=d.fromdevicenetwork?c.url("/network/device/details/"+d.devicenum+"?fromdevicenetwork=true&devicenum="+d.devicenum):c.url(a.back+a.prev)};a.saveName=function(b){a.errorMessages=[];a.connection.name=escape(a.name.replace(/^\s+|\s+$/g,"")).replace(/\+/g,"%2B");if(0==a.connection.name.length)a.errorMessages.push("Connection Name: Connection Name cannot be empty.");
else for(var f=0;f<a.connections.length;f++)f!=a.connection.connectionId&&a.connection.name==a.connections[f].name&&a.errorMessages.push("Connection Name:  Connection Name already in use.");0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):e.update({id:b.connectionId},{name:a.connection.name},function(){null!=d.fromdevicenetwork?c.url("/network/device/details/"+d.devicenum+"?fromdevicenetwork=true&devicenum="+d.devicenum):""==a.oldFrom?c.path(a.back).search({}):c.path(a.back).search({from:a.oldFrom})})};
a.checkNetworkConnections=function(){c.path("/network/connections")}}]).controller("NetworkConnectionEditCtrl",["$scope","$route","$routeParams","$location","DhcpOptions","NetworkConnections","DhcpConnections","Routes","Devices",function(a,b,d,c,e,f,g,h,k){a.tab=b.current.tab;a.section=b.current.section;a.confirm=!1;a.messages=[];a.staticConnections=[];a.routesConnections=[];a.oldCoaxPassword="";a.fromString=d.from?"?from="+d.from+"&connectionEdit="+d.id:"?connectionEdit="+d.id;a.getStyleName=function(a){switch(a){case 0:return"Network";
case 1:return"Network";case 2:return"Wireless";case 3:return"Wireless";case 4:return"Ethernet";case 5:return"Coax";default:return"Network"}};a.checkForDevicesNow=function(a,b){var c=!1,d="";switch(String(b)){case "2":d="4";break;case "3":d="5";break;case "4":d="0";break;default:return!1}if(0<a.length){for(var e=0;e<a.length;e++)if(String(a[e].connectionType)==String(d)&&!0==a[e].status){c=!0;break}return c}return!1};var l=k.query(function(){a.connection=f.get({id:d.id},function(){a.connection.styleName=
a.getStyleName(d.id);if(a.connection.dhcpExpires){var b=a.connection.dhcpExpires;a.connection.dhcpExpireTime=0!=b?Math.ceil(b/60)+" minutes":"Expired"}a.name=unescape(a.connection.name);a.connection.name=unescape(a.connection.name);a.connection.hasConnectedDeviceNow=a.checkForDevicesNow(l,a.connection.connectionId);a.oldsubnet=a.connection.subnetMask;a.oldProtocolUsed=a.connection.protocolUsed;switch(a.connection.type){case 3:a.connectionType="Ethernet";break;case 5:a.connectionType="Coax";break;
case 4:a.connectionType="AP";break;default:a.connectionType="Basic"}a.connection.ipAddress&&(a.initialIpAddress=a.connection.ipAddress,a.ipAddress=splitIpArr(a.connection.ipAddress),a.subnetMask=splitIpArr(a.connection.subnetMask),null!=a.connection.defaultGateway&&(a.defaultGateway=splitIpArr(a.connection.defaultGateway)),a.connection.primaryDnsServer&&(a.primaryDnsServer=splitIpArr(a.connection.primaryDnsServer),a.secondaryDnsServer=splitIpArr(a.connection.secondaryDnsServer)));1==a.connection.connectionId&&
(a.oldCoaxPassword=a.connection.coaxPassword);a.bridges=null;a.connection.availableBridges&&(a.bridges=[],a.allConnections=f.query(function(){for(var b=0;b<a.connection.availableBridges.length;b++)for(var c=0;c<a.allConnections.length;c++)if(a.allConnections[c].connectionId==a.connection.availableBridges[b]){a.bridges.push(a.allConnections[c]);a.bridges[b].fromString=""===a.fromString?"?from=edit":a.fromString+"-edit";a.bridges[b].styleName=a.getStyleName(a.bridges[b].connectionId);a.bridges[b].bridged=
a.connection.bridged[b];a.bridges[b].name=unescape(a.bridges[b].name);a.bridges[b].hasConnectedDeviceNow=a.checkForDevicesNow(l,a.bridges[b].connectionId);break}}));a.connections=f.query(function(){for(var b=0,c=0;c<a.connections.length;c++){if(null!=a.connections[c].bridged)for(var f=0;f<a.connections[c].bridged.length;f++)a.connections[c].bridged[f]&&(a.connections[a.connections[c].availableBridges[f]].name=2==a.connections[c].availableBridges[f]?unescape(a.connections[c].name)+" Wireless 802.11 2.4GHz Access Point":
3==a.connections[c].availableBridges[f]?unescape(a.connections[c].name)+" Wireless 802.11 5.0GHz Access Point":unescape(a.connections[c].name+" "+a.connections[a.connections[c].availableBridges[f]].name));a.connections[c].name=unescape(a.connections[c].name);a.connections[c].hasOwnProperty("connectionUsed")||(a.routesConnections[b]=a.connections[c],b++)}if(a.connection.dhcpSettings){a.dhcpOptions=e.query();a.dhcpStartIpAddress=splitIpArr(a.connection.dhcpSettings.startIpAddress);a.dhcpEndIpAddress=
splitIpArr(a.connection.dhcpSettings.endIpAddress);a.initialDhcpEndAddress=a.connection.dhcpSettings.endIpAddress;b=a.connection.dhcpSettings.winsServer;0==b.length&&(b="0.0.0.0");a.dhcpWinsServer=splitIpArr(b);var l=g.query({id:d.id},function(){for(var b=0;b<l.length;b++)1==l[b].ipAddressSource&&a.staticConnections.push(l[b].ipAddress)})}})})});a.enableCoax=function(){f.update({id:d.id},{coaxEnabled:!0},function(){a.connection=f.get({id:d.id})})};a.disableCoax=function(){f.update({id:d.id},{coaxEnabled:!1},
function(){a.connection=f.get({id:d.id})})};a.dhcpRelease=function(){f.save({id:d.id},{dhcpRelease:!0},function(){a.connection=f.get({id:d.id})})};a.dhcpRenew=function(){f.save({id:d.id},{dhcpRenew:!0},function(){a.connection=f.get({id:d.id})})};a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.isInt=function(a){return 0===a%1};a.checkMsg=function(a,b){for(var c=!1,d=0;d<a.length;d++)if(a[d]==b){c=!0;break}return c};a.save=function(){a.errorMessages=[];a.messages=[];0==a.connection.connectionId&&
(!a.isInt(a.connection.dhcpSettings.leaseTime)||43200<a.connection.dhcpSettings.leaseTime)&&a.errorMessages.push("Lease Time in Minutes: Please enter a numeric value between 1 and 43200");2==a.connection.mtuType&&(validRange(a.connection.mtu,68,1500)||a.errorMessages.push("MTU: The maximum transfer unit of "+a.connection.name+" should be between 68 and 1500. "));if(a.connection.ipAddress){2==a.connection.protocolUsed&&(validateIp(a.ipAddress)||a.errorMessages.push("IP Address: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces."),
"0.0.0.0"==getIpString(a.ipAddress)?(a.errorMessages.push("IP address may not be 0.0.0.0. IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces. At least one of the values must be greater than 0."),a.errorMessages.push("IP Address already in use: IP address item is already in use by Port Forwarding.")):(223<a.ipAddress[0]||0==a.ipAddress[0])&&a.errorMessages.push("IP Address: Device IP address should start with a value between 1-223."));var b=!1;validateIp(a.subnetMask)&&
!checkFullListOfSubnetMaskRange(a.subnetMask)||2!=a.connection.protocolUsed&&1!=a.connection.protocolUsed||("0.0.0.0"!=getIpString(a.subnetMask)&&a.errorMessages.push("Subnet Mask: Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0."),b=!0);0==a.connection.connectionId&&(checkForValidSubnetMaskRange(a.subnetMask)||b)&&(a.errorMessages.push("Subnet Mask: Subnet mask must be between 255.0.0.0 and 255.255.255.252."),
b=!0);!1==b&&2==a.connection.protocolUsed&&checkHostVsSubmask(a.ipAddress,a.subnetMask)&&a.errorMessages.push("IP Address and Subnet Mask combination: The combination of IP address and subnet mask is invalid. All of the bits in the host address portion of the IP address are set to 0.");a.defaultGateway&&!validateIp(a.defaultGateway)&&2==a.connection.protocolUsed&&a.errorMessages.push("Default Gateway: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces.");
a.connection.primaryDnsServer&&1==a.connection.dnsMode&&(validateIp(a.primaryDnsServer)||1!=a.connection.connectionId||a.errorMessages.push("Primary DNS Server: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces."),validateIp(a.secondaryDnsServer)||1!=a.connection.connectionId||a.errorMessages.push("Secondary DNS Server: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces."));(null==a.connection.deviceMetric||
""===a.connection.deviceMetric||isNaN(a.connection.deviceMetric)||0>a.connection.deviceMetric||255<a.connection.deviceMetric)&&a.errorMessages.push("Device Metric: Please enter a numeric value between 0 and 255.");var e=getIpString(a.ipAddress);a.connection.dnsMode=parseInt(a.connection.dnsMode);var f="",g="";a.connection.primaryDnsServer&&(f=getIpString(a.primaryDnsServer),g=getIpString(a.secondaryDnsServer));var l=parseInt(a.connection.protocolUsed),h=a.connection.subnetMask;if(2==l||1==l)h=getIpString(a.subnetMask);
var k=a.connection.defaultGateway;a.defaultGateway&&(k=getIpString(a.defaultGateway));1==a.connection.dnsMode&&1==a.connection.connectionId&&a.connection.primaryDnsServer&&(e==f&&a.errorMessages.push("Primary DNS Server: DNS Server cannot have the IP address of Wireless Broadband Router "+a.connection.name),e==g&&a.errorMessages.push("Secondary DNS Server: DNS Server cannot have the IP address of Wireless Broadband Router "+a.connection.name),"0.0.0.0"!=f&&f==g&&a.errorMessages.push("Redundant DNS Entries: 'Primary' and 'Secondary' values may not point to the same DNS server."),
"255.255.255.255"==f&&a.errorMessages.push("Primary DNS Server: "+f+" is invalid."),"255.255.255.255"==g&&a.errorMessages.push("Secondary DNS Server: "+g+" is invalid."));1==a.connection.type&&(a.connection.coaxPrivacy?a.connection.coaxAutoDetection?a.connection.coaxPasswordManual=a.oldCoaxPassword:((12>a.connection.coaxPasswordManual.length||17<a.connection.coaxPasswordManual.length)&&a.errorMessages.push("Coax Link Password: Password length should be between 12 and 17 characters."),0==a.connection.coaxPasswordManual.length?
a.errorMessages.push("Coax Link Password: A number must be specified."):/^[0-9]+$/i.test(a.connection.coaxPasswordManual)||a.errorMessages.push("Coax Link Password:  Only digits can be used for the number.")):a.connection.coaxPasswordManual=a.oldCoaxPassword);if(0==a.connection.type)"0.0.0.0"==h&&a.errorMessages.push((1==l&&a.connection.overrideSubnetMask?"Override ":"")+"Subnet mask may not be 0.0.0.0. Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0.");
else if(1==a.connection.type){var p=a.subnetMask;a.connection.overrideSubnetMask||1!=l||(p=splitIpArr(h));if((2==l||1==l&&a.connection.overrideSubnetMask)&&validateIp(p)){for(var r=!0,m=!1,b=0;4>b;b++){for(var n=7;-1<n;n--){var z=1==(p[b]>>n&1);if(z&&m){r=!1;break}z||(m=!0)}if(!r)break}if(!r)a.checkMsg(a.errorMessages,"Subnet Mask: Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0.")||
a.errorMessages.push("Subnet Mask: Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0.");else if(2==l&&a.connection.defaultRoute&&"0.0.0.0"==k)a.errorMessages.push("Default Gateway: The Default Gateway must not be 0.0.0.0 while the Default Route is set.");else if(2==l&&"0.0.0.0"!=k)for(b=0;4>b;b++)if((p[b]&a.defaultGateway[b])!=(a.subnetMask[b]&a.ipAddress[b])){a.errorMessages.push("Wireless Broadband Router and Default Gateway Are Not on the Same Subnet: Under the given Netmask, the IP Address does not belong to the same Subnet as the Default Gateway.");
break}"0.0.0.0"==h&&a.errorMessages.push("Subnet mask may not be 0.0.0.0. Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0.")}}if(0!=a.errorMessages.length){a.showErrorPage=!0;window.scrollTo(0,0);return}2==a.connection.protocolUsed?(a.connection.ipAddress=e,a.defaultGateway&&(a.connection.defaultGateway=k)):a.defaultGateway&&(a.connection.defaultGateway=null);void 0!==a.connection.routingMode&&
(a.connection.routingMode=parseInt(a.connection.routingMode));a.connection.primaryDnsServer=f;a.connection.secondaryDnsServer=g;a.connection.protocolUsed=l;a.connection.subnetMask=h;0==d.id&&1==a.connection.protocolUsed&&2==a.oldProtocolUsed&&(a.messages.push({type:"DHCP Client:",data:"Configuring an internal connection to obtain an IP address automatically might make the connection inaccessible in case no IP address is obtained."}),2==a.connection.dhcpSettings.mode&&a.messages.push({type:"IP Address Distribution:",
data:"IP addresses cannot be distributed until the connection obtains its IP address."}));a.connection.ipAddress!=a.initialIpAddress&&(a.waitOnConfirm=!0,0==a.connection.connectionId&&a.messages.push({type:"Bridge IP Changed:",data:"  Please open a new browser with new address("+a.connection.ipAddress+") to access GUI"}),a.connection.dhcpSettings&&0!=a.connection.dhcpSettings.mode&&a.messages.push({type:"DHCP Leases:",data:"There are dynamic DHCP leases outside the DHCP IP address range. All connected DHCP clients will need to request new IP addresses."}));
1==a.connection.connectionId&&1==a.connection.dnsMode&&"0.0.0.0"==a.connection.primaryDnsServer&&"0.0.0.0"==a.connection.secondaryDnsServer&&a.messages.push({type:"DNS Servers:",data:"No DNS Servers entered for this connection. This might cause name resolution problems."})}3!=a.connection.type&&5!=a.connection.type||!a.connection.coaxPrivacy||((12>a.connection.coaxPassword.length||17<a.connection.coaxPassword.length)&&a.errorMessages.push("Coax Link Password: Password length should be between 12 and 17 characters."),
0==a.connection.coaxPassword.length?a.errorMessages.push("Coax Link Password: A number must be specified."):/^[0-9]+$/i.test(a.connection.coaxPassword)||a.errorMessages.push("Coax Link Password: Only digits can be used for the number."));2!=a.connection.protocolUsed&&(a.connection.ipAddress=null);1!=a.connection.dnsMode&&(a.connection.primaryDnsServer=null,a.connection.secondaryDnsServer=null);if(0!=a.errorMessages.length)a.showErrorPage=!0,window.scrollTo(0,0);else{if(a.connection.dhcpSettings){e=
splitIpArr(a.connection.ipAddress);f=splitIpArr(a.connection.subnetMask);a.connection.dhcpSettings.mode=parseInt(a.connection.dhcpSettings.mode);if(2==a.connection.dhcpSettings.mode){if(a.connection.ipAddress!=a.initialIpAddress&&getIpString(a.dhcpEndIpAddress)==a.initialDhcpEndAddress)for(b=0;4>b;b++)a.dhcpStartIpAddress[b]=e[b]&f[b]|a.dhcpStartIpAddress[b]&~f[b],a.dhcpEndIpAddress[b]=e[b]&f[b]|a.dhcpEndIpAddress[b]&~f[b];for(b=0;b<a.staticConnections.length;b++)if(!isInRange(a.dhcpStartIpAddress,
a.dhcpEndIpAddress,splitIpArr(a.staticConnections[b]))){a.messages.push({type:"Static Leases:",data:"The Static lease configured IP's are no longer valid and requires manual UI updating to reflect the new IP configuration."});break}a.errorMessages=validateIPv4DhcpSettings(e,a.dhcpStartIpAddress,a.dhcpEndIpAddress,f,a.dhcpWinsServer,a.connection.dhcpSettings.leaseTime,a.connection.connectionId,a.connection.protocolUsed);if(0!=a.errorMessages.length){a.showErrorPage=!0;window.scrollTo(0,0);return}}a.connection.dhcpSettings.mode=
parseInt(a.connection.dhcpSettings.mode);a.connection.dhcpSettings.startIpAddress=getIpString(a.dhcpStartIpAddress);a.connection.dhcpSettings.endIpAddress=getIpString(a.dhcpEndIpAddress);validateIp(a.dhcpWinsServer)?(b=getIpString(a.dhcpWinsServer),a.connection.dhcpSettings.winsServer="0.0.0.0"!=b?b:""):a.connection.dhcpSettings.winsServer=""}if(a.bridges)for(!a.connection.bridged[0]&&a.bridges[0].bridged&&a.messages.push({type:"Warning:",data:"Changing this configuration setting will impact router performance, and negatively impact video services and features.When in the 'bridge mode', the router and broadband service cannot be supported by the Service provider. Proceed with caution."}),
b=0;b<a.bridges.length;b++)a.connection.bridged[b]=a.bridges[b].bridged;a.connection.mtuType=parseInt(a.connection.mtuType);if(0!=a.messages.length&&systemSettings.warnBeforeChanges)a.confirm=!0,window.scrollTo(0,0);else{var B=a.connection.connectionId;a.connection.$update(function(){c.path("/network/connections/"+B)})}}};a.changePrivacy=function(b){a.connection.coaxAutoDetection=!0};a.confirmChanges=function(){var b=a.connection.connectionId;a.connection.$update(function(){c.path("/network/connections/"+
b)})};a.toggleEnabled=function(){};a.mtuTypeChanged=function(){a.connection.mtu=1500};a.protocolChanged=function(){1==a.connection.protocolUsed?a.connection.dnsMode=0:0==a.connection.dnsMode&&(a.connection.dnsMode=1)};if(0==d.id||1==d.id)a.connections=f.query(function(){for(var b=0;b<a.connections.length;b++){if(null!=a.connections[b].bridged)for(var c=0;c<a.connections[b].bridged.length;c++)a.connections[a.connections[b].availableBridges[c]].name=unescape(a.connections[b].name+a.connections[a.connections[b].availableBridges[c]].name);
a.connections[b].name=unescape(a.connections[b].name)}}),a.editingRoute=!1,a.refreshRoutes=function(){var b=h.get(function(){a.routes=[];for(var c=0;c<b.routes.length;c++)b.routes[c].type==a.connection.connectionId&&a.routes.push(b.routes[c])})},a.addNewRoute=function(){a.routeIndex=-1;a.routeEditing={type:a.connection.connectionId,destination:[0,0,0,0],netmask:[255,255,255,255],gateway:[0,0,0,0],metric:0};a.editingRoute=!0},a.editRoute=function(b){a.editingRoute=!0;var c=a.routes[b];a.routeIndex=
b;a.routeEditing={type:c.type,destination:splitIpArr(c.destination),netmask:splitIpArr(c.netmask),gateway:splitIpArr(c.gateway),metric:c.metric}},a.deleteRoute=function(b){h.remove({id:a.routes[b].id},function(){a.refreshRoutes()})},a.cancelRouteEdit=function(){a.editingRoute=!1},a.saveRoute=function(){a.errorMessages=[];validateIp(a.routeEditing.destination)||a.errorMessages.push("Destination: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces.");
validateIp(a.routeEditing.netmask)||a.errorMessages.push("Netmask: Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0.");"0.0.0.0"==getIpString(a.routeEditing.netmask)&&a.errorMessages.push("Netmask: Subnet mask may not be 0.0.0.0. Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0.");
"0.0.0.0"==getIpString(a.routeEditing.gateway)&&a.errorMessages.push("Gateway: IP Address may not be 0.0.0.0.");validateIp(a.routeEditing.gateway)||a.errorMessages.push("Gateway: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces.");(null==a.routeEditing.metric||""===a.routeEditing.metric||isNaN(a.routeEditing.metric)||0>a.routeEditing.metric||255<a.routeEditing.metric)&&a.errorMessages.push("Metric: Please enter a numeric value between 0 and 255.");
0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.editingRoute=!1,a.routeEditing.type=parseInt(a.routeEditing.type),a.routeEditing.destination=getIpString(a.routeEditing.destination),a.routeEditing.netmask=getIpString(a.routeEditing.netmask),a.routeEditing.gateway=getIpString(a.routeEditing.gateway),a.routeEditing.metric=parseInt(a.routeEditing.metric),-1!=a.routeIndex?h.update({id:a.routes[a.routeIndex].id},a.routeEditing,function(){a.refreshRoutes()}):h.save(a.routeEditing,function(){a.refreshRoutes()}))},
a.refreshRoutes();a.checkNetworkConnections=function(){c.path("/network/connections")}}]).controller("DeviceDetailsCtrl",["$scope","$route","$routeParams","$location","Devices","NetworkConnections","Diagnostics","PortForward",function(a,b,d,c,e,f,g,h){a.tab=b.current.tab;a.section=b.current.section;a.close="#/network";a.forwards=["None"];a.showErrorPage=!1;a.devices=e.query();null!=d.from&&(a.close="#/"+from);var k=f.get({id:0},function(){a.subnetMask=k.subnetMask});a.device=e.get({id:d.id},function(){setDeviceStyle(a.device);
a.device=checkDeviceIP(a.device);a.oldName=a.device.name;a.connection=f.get({id:a.device.networkConnection},function(){a.connection.name=unescape(a.connection.name)});var b=h.query(function(){for(var c=[],d=0;d<b.length;d++)if(b[d].deviceIp==a.device.ipAddress){if(/^PortForward\_.*$/.test(b[d].name)){b[d].displayName="Destination Ports ";for(var e=[],f=0;f<b[d].protocols.length;f++){var g=b[d].protocols[f];if(1==g.outgoingPorts){if(a.contains(e,g.outgoingPortStart))continue}else if(2==g.outgoingPorts&&
a.contains(e,g.outgoingPortStart+"-"+g.outgoingPortEnd))continue;0<f&&(b[d].displayName+=",");b[d].displayName=0==g.outgoingPorts?b[d].displayName+"Any":1==g.outgoingPorts?b[d].displayName+g.outgoingPortStart:b[d].displayName+(g.outgoingPortStart+"-"+g.outgoingPortEnd)}}else b[d].displayName=b[d].name;c.push(b[d].displayName)}0!=c.length&&(a.forwards=c)})});a.contains=function(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return!0;return!1};a.pingTest=function(){g.save({destination:a.device.ipAddress,
count:4},function(){c.path("/advanced/diagnostics")})};a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.iconChanged=function(){a.device.icon=parseInt(a.device.icon);setDeviceStyle(a.device)};a.save=function(){a.errorMessages=[];for(var b=0;b<a.devices.length;b++)if(a.device.id!=b&&a.device.name==a.devices[b].name){a.errorMessages.push("Duplicate Device name: An identical name already exists in the system.");break}63<a.device.name.length?a.errorMessages.push("New Name: Name may not contain spaces. Only letters, digits and the special characters dash (-), underscore (_) and dot (.) may be used. These special characters may not appear at the beginning or at the end of a name. The maximum length of a label (text between two dots) is 63."):
validateHostname(a.device.name)||/^\d+$/.test(a.device.name)||a.errorMessages.push("New Name: Name may not contain spaces. Only letters, digits and the special characters dash (-), underscore (_) and dot (.) may be used. These special characters may not appear at the beginning or at the end of a name. The maximum length of a label (text between two dots) is 63.");0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):a.device.$update(function(){c.path("/network")})};a.checkNetworkConnections=
function(){c.path("/network/connections")}}]).controller("WanCoaxStatsCtrl",["$scope","$route","$routeParams","$location","NetworkConnections",function(a,b,d,c,e){a.tab=b.current.tab;a.section=b.current.section;a.checkNetworkConnections=function(){c.path("/network/connections")};a.coax=e.get({id:1})}]).controller("LanCoaxStatsCtrl",["$scope","$route","$routeParams","$location","NetworkConnections",function(a,b,d,c,e){a.tab=b.current.tab;a.section=b.current.section;a.checkNetworkConnections=function(){c.path("/network/connections")};
a.coax=e.get({id:5})}]);angular.module("parental.controllers",[]).controller("ParentalAddCtrl",["$scope","$route","$routeParams","$location","Parental","Devices","SystemSettings",function(a,b,d,c,e,f,g){a.tab=b.current.tab;a.section=b.current.section;a.showErrorPage=!1;a.days=[!1,!1,!1,!1,!1,!1,!1];a.activeType=0;a.startHour=1;a.startMinute=0;a.startTime=0;a.endHour=1;a.endMinute=0;a.endTime=0;a.selectedAvailable=[];a.selectedUsed=[];a.availableDevices=[];a.usedDevices=[];a.embeddedKeyword="";a.website="";a.blocks=[];a.blockedItems=
[];a.pageToShow=0;a.hasParentalRules=!1;a.sysSettings=g.get();a.togglePage=function(b){a.pageToShow=b;window.scrollTo(0,0)};a.changeDisplayNum=function(a){return 1<String(a).length?a:"0"+a};a.$watch("parentalControl.accessType",function(){a.checkAccessValue()});a.checkAccessValue=function(){if("Block_Selected"==a.parentalControl.name||"Allow_Only_Selected"==a.parentalControl.name||"Block_All"==a.parentalControl.name||""==a.parentalControl.name)0==a.parentalControl.accessType?a.parentalControl.name=
"Block_Selected":1==a.parentalControl.accessType?a.parentalControl.name="Allow_Only_Selected":2==a.parentalControl.accessType&&(a.parentalControl.name="Block_All");if("Block only websites with any of the listed words in their URLs."==a.parentalControl.description||"Allow only websites with any of the listed words in their URLs."==a.parentalControl.description||"Block access to all Internet services and websites."==a.parentalControl.description||""==a.parentalControl.description)0==a.parentalControl.accessType?
a.parentalControl.description="Block only websites with any of the listed words in their URLs.":1==a.parentalControl.accessType?a.parentalControl.description="Allow only websites with any of the listed words in their URLs.":2==a.parentalControl.accessType&&(a.parentalControl.description="Block access to all Internet services and websites.")};a.parentalControl={name:"Block_Selected",description:"Block only websites with any of the listed words in their URLs.",schedule:{name:"",activeDuring:!0,timeSegments:[{daysOfTheWeek:[],
hourRanges:[{startTimeHour:0,startTimeMinute:0,endTimeHour:0,endTimeMinute:0}]}]},accessType:0,restrictions:[],hosts:[],status:!0};var h=[],k=e.query(function(){h=f.query(function(){a.hasParentalRules=0<k.length?!0:!1;for(var b=0;b<h.length;b++){for(var c=!1,e=0;e<k.length;e++)for(var f=k[e],g=0;g<f.hosts.length;g++)if(f.hosts[g]==h[b].mac){c=!0;break}c||h[b].isStb||a.availableDevices.push(h[b].name)}if(void 0!==d.id&&k.length>d.id){f=k[d.id];a.parentalControl.accessType=f.accessType;a.parentalControl.name=
f.name;a.parentalControl.description=f.description;a.parentalControl.schedule.activeDuring=f.schedule.activeDuring;for(g=0;g<f.schedule.timeSegments[0].daysOfTheWeek.length;g++)a.days[f.schedule.timeSegments[0].daysOfTheWeek[g]]=!0;b=f.schedule.timeSegments[0].hourRanges[0].startTimeHour;c=f.schedule.timeSegments[0].hourRanges[0].startTimeMinute;e=f.schedule.timeSegments[0].hourRanges[0].endTimeHour;g=f.schedule.timeSegments[0].hourRanges[0].endTimeMinute;a.startHour=0==b?12:12<b?b-12:b;a.startHour=
1<String(a.startHour).length?a.startHour:"0"+a.startHour;a.startTime=12<=b?1:0;a.startMinute=45==c?3:30==c?2:15==c?1:0;a.endHour=0==e?12:12<e?e-12:e;a.endHour=1<String(a.endHour).length?a.endHour:"0"+a.endHour;a.endTime=12<=e?1:0;a.endMinute=45==g?3:30==g?2:15==g?1:0;for(g=0;g<f.hosts.length;g++)for(b=0;b<h.length;b++)f.hosts[g]==h[b].mac&&a.usedDevices.push(h[b].name);a.addDevices();for(g=0;g<f.restrictions.length;g++)a.parentalControl.restrictions.push(f.restrictions[g]),0==f.restrictions[g].type?
a.blockedItems.push("Website: "+f.restrictions[g].value):a.blockedItems.push("Keyword: "+f.restrictions[g].value)}})});a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.addDevices=function(){for(var b=0;b<a.selectedAvailable.length;b++)for(var c=0;c<a.availableDevices.length;c++)if(a.selectedAvailable[b]==a.availableDevices[c]){a.availableDevices.splice(c,1);a.usedDevices.push(a.selectedAvailable[b]);break}a.selectedAvailable=[]};a.removeDevices=function(){for(var b=0;b<a.selectedUsed.length;b++)for(var c=
0;c<a.usedDevices.length;c++)if(a.selectedUsed[b]==a.usedDevices[c]){a.usedDevices.splice(c,1);a.availableDevices.push(a.selectedUsed[b]);break}};a.addControls=function(){a.errorMessages=[];a.blockedWebsites=[];a.blockedKeywords=[];for(var b=0;b<a.blockedItems.length;b++){var c=a.blockedItems[b];"website"==c.toString().split(":",1)[0].toLowerCase()?a.blockedWebsites.push(c):a.blockedKeywords.push(c)}if(50<=a.blockedWebsites.length&&""!=a.website)a.errorMessages.push("Blacklist Websites must not exceed 50 entries.");
else if(50<=a.blockedKeywords.length&&""!=a.embeddedKeyword)a.errorMessages.push("Blacklist Keywords must not exceed 50 entries.");else{if(""!=a.embeddedKeyword)if(/^[0-9A-Z]+$/i.test(a.embeddedKeyword)){b=!0;for(c=0;c<a.parentalControl.restrictions.length;c++)if(1==a.parentalControl.restrictions[c].type&&a.embeddedKeyword==a.parentalControl.restrictions[c].value){b=!1;break}b&&(a.parentalControl.restrictions.push({type:1,value:a.embeddedKeyword}),a.blockedItems.push("Keyword: "+a.embeddedKeyword))}else a.errorMessages.push("Keyword cannot contain special characters");
if(""!=a.website)if(/^[0-9A-Z\*][0-9A-Z\.\-\*]+[0-9A-Z\*]$/i.test(a.website)){b=!0;for(c=0;c<a.parentalControl.restrictions.length;c++)if(0==a.parentalControl.restrictions[c].type&&a.website==a.parentalControl.restrictions[c].value){b=!1;break}b&&(a.parentalControl.restrictions.push({type:0,value:a.website}),a.blockedItems.push("Website: "+a.website))}else a.errorMessages.push("Please input website only, not webpage address")}0<a.errorMessages.length&&(a.showErrorPage=!0,window.scrollTo(0,0))};a.removeControls=
function(){for(var b=0;b<a.blocks.length;b++)for(var c=0;c<a.blockedItems.length;c++)if(a.blocks[b]==a.blockedItems[c]){a.blockedItems.splice(c,1);a.parentalControl.restrictions.splice(c,1);break}};a.cfmApplySettings=function(){e.save(a.parentalControl,function(){c.path("/parental/summary");window.scrollTo(0,0)})};a.applySettings=function(){a.errorMessages=[];a.checkAccessValue();var b=0;""==a.parentalControl.name&&a.errorMessages.push("Policy: Rule name must be specified.");angular.forEach(k,function(c){c.name===
a.parentalControl.name&&b!=d.id&&a.errorMessages.push("Policy: This name is already used by another rule.");b++});/^[0-9A-Z\!\-\_\.#']+$/i.test(a.parentalControl.name)||""===a.parentalControl.name||a.errorMessages.push("Policy: Rule name should consist of standard characters only (ASCII 32-126) excluding the special character space and any of :@\"|/=+<>()[]{}&%^$*?,;.#'");0==a.usedDevices.length&&a.errorMessages.push("Selected Devices: List cannot be empty.");2!=a.parentalControl.accessType&&0==a.parentalControl.restrictions.length&&
a.errorMessages.push("Filter Websites or Keywords: List cannot be empty.");for(var f=!1,g=0;g<a.days.length;g++)a.days[g]&&(f=!0);f||a.errorMessages.push("Days of Week: At least one day must be selected.");if(0<a.errorMessages.length)a.showErrorPage=!0,window.scrollTo(0,0);else{for(g=0;g<a.usedDevices.length;g++)for(f=0;f<h.length;f++)if(h[f].name==a.usedDevices[g]){a.parentalControl.hosts.push(h[f].mac);break}for(g=0;g<a.days.length;g++)a.days[g]&&a.parentalControl.schedule.timeSegments[0].daysOfTheWeek.push(g);
g=parseInt(a.startHour)+12*a.startTime;0==g%12&&(g-=12);a.parentalControl.schedule.timeSegments[0].hourRanges[0].startTimeHour=g;g=parseInt(a.endHour)+12*a.endTime;0==g%12&&(g-=12);a.parentalControl.schedule.timeSegments[0].hourRanges[0].endTimeHour=g;a.parentalControl.schedule.timeSegments[0].hourRanges[0].startTimeMinute=15*a.startMinute;a.parentalControl.schedule.timeSegments[0].hourRanges[0].endTimeMinute=15*a.endMinute;void 0!==d.id?e.update({id:d.id},a.parentalControl,function(){c.search({});
c.path("/parental/summary");window.scrollTo(0,0)}):a.hasParentalRules?a.cfmApplySettings():!0==a.sysSettings.warnBeforeChanges?a.togglePage(1):a.cfmApplySettings()}}}]).controller("ParentalSummaryCtrl",["$scope","$route","$location","Devices","Parental","SystemSettings",function(a,b,d,c,e,f){a.tab=b.current.tab;a.section=b.current.section;a.viewingRule=-1;a.pageToShow=0;a.selectedIndex=-1;a.sysSettings=f.get();a.togglePage=function(b){a.pageToShow=b;window.scrollTo(0,0)};a.refresh=function(){a.devices=
c.query(function(){a.rules=e.query(function(){for(var b=0;b<a.rules.length;b++){for(var c=0;c<a.rules[b].hosts.length;c++)for(var d=a.rules[b].hosts[c],e=0;e<a.devices.length;e++)if(d==a.devices[e].mac){a.rules[b].hosts[c]=a.devices[e].name;break}a.rules[b].selected=a.rules[b].hosts[0]}})})};a.refresh();a.editRule=function(a){d.path("/parental").search({id:a})};a.viewRule=function(b){a.viewingRule=b;a.selected=a.rules[b];a.selectedRestrictions=[];for(b=0;b<a.selected.restrictions.length;b++){var c=
a.selected.restrictions[b];switch(c.type){case 0:a.selectedRestrictions.push("Website:"+c.value);break;default:a.selectedRestrictions.push("Keyword:"+c.value)}}b=[];printSchedule(0,[a.selected.schedule],b);a.scheduleString=b[0][0]};a.cfmDeleteControl=function(){e.remove({id:a.selectedIndex},function(){a.togglePage(0);a.refresh()})};a.deleteRule=function(b){a.selectedIndex=b;!0==a.sysSettings.warnBeforeChanges?a.togglePage(1):a.cfmDeleteControl()};a.close=function(){a.viewingRule=-1}}]);angular.module("system.controllers",[]).controller("MonitoringCtrl",["$scope","$route","NetworkConnections","FirmwareUpgrade","SystemSettings","$timeout",function(a,b,d,c,e,f){a.tab=b.current.tab;a.section=b.current.section;a.valid=!0;a.autoRefresh=systemSettings.autoRefreshSystemMonitoring;a.$on("$destroy",function(){a.valid=!1});a.initialLoad=!0;a.refresh=function(){if(a.initialLoad||a.autoRefresh){a.initialLoad=!1;var b=e.get(function(){a.stats=b;var c=a.stats.uptime.split(":");2==c.length&&(a.stats.uptime=
parseInt(c[0])+" hours, "+parseInt(c[1])+" minutes")}),h=d.get({id:1},function(){a.bb=h}),k=c.get(function(){a.fw=k});a.autoRefresh&&a.valid&&f(function(){a.refresh()},1E4)}};a.toggleAutoRefresh=function(){a.systmSetngs=e.get();a.autoRefresh=!a.autoRefresh;a.systmSetngs.autoRefreshSystemMonitoring=a.autoRefresh;a.systmSetngs.$update(function(){systemSettings=a.systmSetngs;a.autoRefresh&&a.refresh()})};a.refresh()}]).controller("MonitoringAdvCtrl",["$scope","$route","$routeParams",function(a,b,d){a.tab=
b.current.tab;a.section=b.current.section;a.warning=!1;null!=d.warn&&(a.warning=!0)}]).controller("FullStatusCtrl",["$scope","$route","NetworkConnections","$location","$timeout","$routeParams","SystemSettings","Login","Devices",function(a,b,d,c,e,f,g,h,k){a.tab=b.current.tab;a.section=b.current.section;a.valid=!0;var l;a.autoRefresh=systemSettings.autoRefreshSystemMonitoring;a.$on("$destroy",function(){a.valid=!1;e.cancel(l)});a.refreshData=function(){a.initialLoad=!0;a.refresh()};a.checkForDevicesNow=
function(a,b){var c=!1,d="";switch(String(b)){case "2":d="4";break;case "3":d="5";break;case "4":d="0";break;default:return!1}if(0<a.length){for(var e=0;e<a.length;e++)if(String(a[e].connectionType)==String(d)&&!0==a[e].status){c=!0;break}return c}return!1};a.initialLoad=!0;a.refresh=function(){if(a.initialLoad||a.autoRefresh){a.initialLoad=!1;var b,c=k.query(function(){b=d.query(function(){a.connections=b;for(var d=0;d<a.connections.length;d++)void 0!==a.connections[d].ipv6Address&&"::"!==a.connections[d].ipv6Address&&
""!==a.connections[d].ipv6Address&&(a.showIpv6=!0),a.connections[d].displayName=unescape(a.connections[d].name),a.connections[d].hasConnectedDeviceNow=a.checkForDevicesNow(c,a.connections[d].connectionId);a.autoRefresh&&a.valid&&(l=e(function(){h.get()},6E4))})})}};a.toggleAutoRefresh=function(){a.systmSetngs=g.get();a.autoRefresh=!a.autoRefresh;a.systmSetngs.autoRefreshSystemMonitoring=a.autoRefresh;a.systmSetngs.$update(function(){systemSettings=a.systmSetngs;a.autoRefresh&&a.refresh()})};a.close=
function(){null!=f.frommain?c.url(c.path("/main")):(c.path("/monitoring/advanced"),window.scrollTo(0,0))};a.refresh()}]).controller("BandwidthCtrl",["$scope","$route","NetworkConnections","SystemSettings",function(a,b,d,c){a.tab=b.current.tab;a.section=b.current.section;a.valid=!0;a.autoRefresh=systemSettings.autoRefreshSystemMonitoring;a.$on("$destroy",function(){a.valid=!1});a.initialLoad=!0;a.refresh=function(){if(a.initialLoad||a.autoRefresh){a.initialLoad=!1;var b=d.get({id:1},function(){a.bb=
b;a.autoRefresh&&a.valid&&window.setTimeout(a.refresh,6E4)})}};a.toggleAutoRefresh=function(){a.systmSetngs=c.get();a.autoRefresh=!a.autoRefresh;a.systmSetngs.autoRefreshSystemMonitoring=a.autoRefresh;a.systmSetngs.$update(function(){systemSettings=a.systmSetngs;a.autoRefresh&&a.refresh()})};a.refresh()}]).controller("SystemLogCtrl",["$scope","$route","$http","Log","SystemSettings",function(a,b,d,c,e){a.sysSettings=e.get();a.tab=b.current.tab;a.section=b.current.section;a.canClearLog=!0;a.logType=
"System";a.enableLogging=systemSettings.enableLogging;setupLoggingCtrl(a,0,d,c)}]).controller("SecurityLogCtrl",["$scope","$route","$http","Log","SystemSettings",function(a,b,d,c,e){a.sysSettings=e.get();a.tab=b.current.tab;a.section=b.current.section;a.logType="Security";a.canClearLog=!0;a.enableLogging=systemSettings.enableLogging;setupLoggingCtrl(a,1,d,c)}]).controller("AdvancedLogCtrl",["$scope","$route","$http","Log","SystemSettings",function(a,b,d,c,e){a.sysSettings=e.get();a.tab=b.current.tab;
a.section=b.current.section;a.logType="Advanced";a.canClearLog=!0;a.enableLogging=systemSettings.enableLogging;setupLoggingCtrl(a,2,d,c)}]).controller("FirewallLogCtrl",["$scope","$route","$http","Log","SystemSettings",function(a,b,d,c,e){a.tab=b.current.tab;a.section=b.current.section;a.logType="Firewall";a.enableLogging=systemSettings.enableLogging;setupLoggingCtrl(a,3,d,c)}]).controller("WandhcpLogCtrl",["$scope","$route","$http","Log","SystemSettings",function(a,b,d,c,e){a.tab=b.current.tab;a.section=
b.current.section;a.logType="WAN DHCP";a.enableLogging=systemSettings.enableLogging;setupLoggingCtrl(a,4,d,c)}]).controller("LandhcpLogCtrl",["$scope","$route","$http","Log","SystemSettings",function(a,b,d,c,e){a.tab=b.current.tab;a.section=b.current.section;a.logType="LAN DHCP";a.enableLogging=systemSettings.enableLogging;setupLoggingCtrl(a,5,d,c)}]);function getIpString(a){return a[0]+"."+a[1]+"."+a[2]+"."+a[3]}function getTimeString(a){return a[0]+":"+a[1]}function getMacString(a){return a[0]+":"+a[1]+":"+a[2]+":"+a[3]+":"+a[4]+":"+a[5]}function splitIpArr(a){a=a.split(".");for(var b=0;b<a.length;b++)a[b]=parseInt(a[b],10);return a}function splitDateArr(a){return a.split(":")}function splitMacArr(a){return a.split(":")}
function validateIp(a){if(4!=a.length)return!1;for(var b=0;b<a.length;b++)if(""==String(a[b])||null==a[b]||isNaN(a[b])||0>a[b]||255<a[b])return!1;return!0}function validateMulticastAddr(a){return validateIp(a)?224<=a[0]&&239>=a[0]:!1}function validateSubnetMask(a){if(!validateIp(a)||0==a[0])return!1;for(var b=!0,d=!1,c=0;4>c;c++){for(var e=7;-1<e;e--){var f=1==(a[c]>>e&1);if(f&&d){b=!1;break}f||(d=!0)}if(!b)break}return b}
function validateMac(a){return/^[0-9A-F]{12}$/i.test(a.replace(RegExp(":","g"),""))}
function validateWepSettings(a,b,d,c){if(b||""!==a.key)switch(a.keyLength){case 0:switch(a.entryMethod){case 0:10==a.key.length?/[0-9A-F]{10}$/i.test(a.key)||c.push(d+": Invalid WEP Key. Allowable values are 0-9 and a-f."):c.push(d+": The WEP key must be a hexadecimal number of 10 digits.");break;case 1:5!=a.key.length?c.push(d+": The WEP key must be a string of 5 characters."):/[\x21-\x7E]{5}$/i.test(a.key)||c.push(d+": Invalid WEP Key. Only ASCII characters are allowed.")}break;case 1:switch(a.entryMethod){case 0:26==
a.key.length?/[0-9A-F]{26}$/i.test(a.key)||c.push(d+": Invalid WEP Key. Allowable values are 0-9 and a-f."):c.push(d+": The WEP key must be a hexadecimal number of 26 digits.");break;case 1:13!=a.key.length?c.push(d+": The WEP key must be a string of 13 characters."):/[\x21-\x7E]{13}$/i.test(a.key)||c.push(d+": Invalid WEP Key. Only ASCII characters are allowed.")}}}function validRange(a,b,d){return!(isNaN(a)||a<b||a>d)}
function validateTransmissionSettings(a,b,d){20>a.beaconInterval||1E3<a.beaconInterval?d.push(b+" Beacon Interval:  Beacon interval out of range (from=20, to=1000)"):isNaN(a.beaconInterval)&&d.push(b+" Beacon Interval: Please enter a numeric value.");1>a.dtimInterval||255<a.dtimInterval?d.push(b+" DTIM Interval:  DTIM interval out of range (from=1, to=255)"):isNaN(a.dtimInterval)&&d.push(b+" DTIM Interval: Please enter a numeric value.");256>a.fragmentationThreshold||2346<a.fragmentationThreshold?
d.push(b+" Fragmentation Threshold:  Fragmentation threshold out of range (from=256, to=2346)"):isNaN(a.fragmentationThreshold)&&d.push(b+" Fragmentation Threshold: Please enter a numeric value.");0>a.rtsThreshold||2347<a.rtsThreshold?d.push(b+" RTS Threshold:  RTS Threshold out of range (from=0, to=2347)"):(null==a.rtsThreshold||""===a.rtsThreshold||isNaN(a.rtsThreshold))&&d.push(b+" RTS Threshold: Please enter a numeric value.");2>a.frameBurstMax||255<a.frameBurstMax?d.push(b+" Frame Burst - Max Number: Max number of frames in a burst is out of range (from=2, to=255)"):
isNaN(a.frameBurstMax)&&d.push(b+" Frame Burst - Max Number: Please enter a numeric value.");0>a.frameBurstTime||1023<a.frameBurstTime?d.push(b+" Frame Burst - Burst Time: Burst time out of range (from=0, to=1023)"):(null==a.frameBurstTime||""===a.frameBurstTime||isNaN(a.frameBurstTime))&&d.push(b+" Frame Burst - Burst Time: Please enter a numeric value.");1>a.power||100<a.power?d.push(b+" Transmit Power: Please enter a numeric value between 1 and 100."):isNaN(a.power)&&d.push(b+" Transmit Power: Please enter a numeric value.")}
function isInRange(a,b,d){for(var c=0;4>c;c++)if(a[c]>d[c]||b[c]<d[c])return!1;return!0}
function validateIPv4DhcpSettings(a,b,d,c,e,f,g,h){var k=[],l=getSubnetID(a,c),q=angular.copy(l);q[3]=100;l=angular.copy(l);l[3]=150;validateIp(a)||k.push("Invalid IP Address provided. Values must be between 0 and 255");validateIp(b)||k.push("Start IP Address: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces.");validateIp(d)||k.push("End IP Address: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces.");var y=
!1;validateIp(c)&&!checkFullListOfSubnetMaskRange(c)||1!=h&&2!=h||("0.0.0.0"!=getIpString(c)&&k.push("Subnet Mask: Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0."),y=!0);isIPWithinRange(b,q,l)&&isIPWithinRange(d,q,l)&&k.push("Start IP Address, End IP Address: IP addresses between "+getIpString(q)+" and "+getIpString(l)+" are used for FiOS TV. Please select a start and/or end IP address outside of this reserved range.");
0!=g||!checkForValidSubnetMaskRange(c)&&!0!=y||(k.push("Subnet Mask: Subnet mask must be between 255.0.0.0 and 255.255.255.252."),y=!0);!1==y&&2==h&&checkHostVsSubmask(a,c)&&k.push("IP Address and Subnet Mask combination: The combination of IP address and subnet mask is invalid. All of the bits in the host address portion of the IP address are set to 0.");(!validateIp(e)||255<e[0]||255<e[1]||255<e[2]||255<e[3])&&k.push("WINS Server: IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces.");
(isNaN(f)||1>f||43200<f)&&k.push("Lease Time in Minutes: Please enter a numeric value between 1 and 43200.");"0.0.0.0"==getIpString(b)?k.push("Start IP Address: IP address may not be 0.0.0.0. IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces. At least one of the values must be greater than 0."):checkHostVsSubmask(b,c)&&"1"==checkBits(b)&&k.push("Start IP Address: "+b[0]+"."+b[1]+"."+b[2]+"."+b[3]+" isn't a valid address");"0.0.0.0"==getIpString(d)?
k.push("End IP Address:  IP address may not be 0.0.0.0. IP address must consist of 4 fields. Each field's value must be between 0 and 255, without any spaces. At least one of the values must be greater than 0."):checkHostVsSubmask(d,c)&&"1"==checkBits(d)&&k.push("End IP Address: "+d[0]+"."+d[1]+"."+d[2]+"."+d[3]+" isn't a valid address");if(0<k.length)return k;h=g=f=!0;e=!1;if((a[0]&c[0])!=(b[0]&c[0])||(a[1]&c[1])!=(b[1]&c[1])||(a[2]&c[2])!=(b[2]&c[2])||(a[3]&c[3])!=(b[3]&c[3]))g=!1;if((a[0]&c[0])!=
(d[0]&c[0])||(a[1]&c[1])!=(d[1]&c[1])||(a[2]&c[2])!=(d[2]&c[2])||(a[3]&c[3])!=(d[3]&c[3]))h=!1;g&&h?validateDHCPRange(b,d,a,c)||k.push("Start IP Address, End IP Address: The DHCP IP address range does not conform to the connection IP address and the DHCP subnet mask."):k.push((g?"":"Start IP Address")+(g||h?"":", ")+(h?"":"End IP Address")+":  The DHCP IP address range does not conform to the connection IP address and the DHCP subnet mask.");if(255==c[0]&&255==c[1]&&255==c[2]&&255==c[3]||c[0]<c[1]||
c[1]<c[2]||c[2]<c[3])f=!1;g=!1;for(h=0;4>h;h++){for(q=7;-1<q;q--){if((l=1==(c[h]>>q&1))&&g){f=!1;break}l||(g=!0)}if(!f)break}if(f){f=f=c=!1;for(g=0;4>g;g++){h=b[g];q=d[g];q>h&&(f=!0);if(h>q&&!f)break;h!=q&&(c=!0)}getIpString(b)===getIpString(d)&&(c=!0);c||(e=!0,k.push("IP Addresses: Start IP address is greater than End IP address."));if(f=isIPWithinRange(a,b,d))e=!0,k.push("IP Addresses: The Device's IP address should not be in the range of the IP pool");e||checkIPRange(b,d)||k.push("The number of IP Addresses in the DHCP IP address range must not be more than 256.")}else k.push("Subnet Mask: Subnet mask must consist of 4 fields. Each field's value must be between 0 and 255, constructing a contiguous string of binary ones. The default mask value is 255.255.255.0.");
return k}function validateIPv6(a){a=a.split(":");if(3>a.length||8<a.length)return!1;for(var b=0,d=0;d<a.length;d++)if(""===a[d])b++;else if(!/^[a-f0-9]{1,4}$/i.test(a[d]))return!1;return 1==b?""!==a[a.length-1]&&""!==a[0]:2==b?""===a[a.length-1]&&""===a[a.length-2]:3==b&&3==a.length?!0:2<b?!1:8==a.length}
function getPrefixLength(a){if(!validateIPv6(a))return-1;a=a.split(":");for(var b=0,d=0,c=!1,d=a.length-1;0<=d;d--)if(""!==a[d]){var e=parseInt(a[d],16);if(0!==e){for(b=0;16>b;b++)if(1==(e>>b&1)){c=!0;break}if(c)break}}return c?16-b+16*d:-1}function validatePrefixLength(a){a=a.split("/");if(2!=a.length||!validateIPv6(a[0])||""===a[1]||isNaN(a[1]))return!1;var b=getPrefixLength(a[0]);return-1!=b&&128!=b&&b<=parseInt(a[1])&&16<=parseInt(a[1])}
function validateHostname(a){if(!/[a-z0-9]/i.test(a)||!/^[a-z0-9]$|^[a-z0-9][a-z0-9\-\_\.]{0,}[a-z0-9]$/i.test(a))return!1;a=a.split(".");for(var b=0;b<a.length;b++)if(63<a[b].length||0==a[b].length)return!1;return!0}function validateLocalDomain(a){if(!/[a-z0-9]/i.test(a)||!/^[a-z0-9]$|^[a-z0-9][a-z0-9\-\_\.]{0,}[a-z0-9]$/i.test(a))return!1;a=a.split(".");for(var b=0;b<a.length;b++)if(63<a[b].length)return!1;return!0}
function validateLocalDomains(a){if(!/[a-z0-9]/i.test(a)||!/^[a-z0-9]$|^[a-z0-9][a-z0-9\-\_\.]{0,}[a-z0-9]$/i.test(a))return!1;for(var b=a.split("."),d=0;d<b.length;d++)if(63<b[d].length||0==b[d].length)return!1;return-1==a.indexOf("--")&&-1==a.indexOf("-.")&&-1==a.indexOf(".-")&&-1==a.indexOf("_-")&&-1==a.indexOf("__")&&-1==a.indexOf("_.")&&-1==a.indexOf("._")}function hasADot(a){return null!=a&&void 0!=a&&-1!=a.indexOf(".")?!0:!1}
function validateIpDomain(a){var b=splitIpArr(a);return validateIp(b)||validateIPv6(a)?!0:validateHostname(a)}
function isScheduleActive(a,b){if(null===a||"Always"===a||""===a)return"Active";var d=["Active","Inactive"];a.activeDuring||(d=["Inactive","Active"]);var c=b.day();0==c&&(c=7);for(var c=c-1,e=b.hour(),f=b.minute(),g=0;g<a.timeSegments.length;g++)if(-1!=String(a.timeSegments[g].daysOfTheWeek).indexOf(c))for(var h=0;h<a.timeSegments[g].hourRanges.length;h++){var k=a.timeSegments[g].hourRanges[h].startTimeHour,l=a.timeSegments[g].hourRanges[h].endTimeHour,q=a.timeSegments[g].hourRanges[h].startTimeMinute,
y=a.timeSegments[g].hourRanges[h].endTimeMinute;if(k==l&&q<=y){if(k==e&&l==e&&q<=f&&y>f)return d[0]}else if(k<l){if(e>k&&e<l||k==e&&f>=q||l==e&&f<y)return d[0]}else if(k<e||k==e&&q<=f||l>e||l==e&&y>f)return d[0]}return d[1]}
function parsePartial(a,b,d){var c=0;do{var e={};e.time=b.substring(d,d+20);var f=moment().subtract("days",1),g=moment().subtract("weeks",1),h=moment(b.substring(d,d+20),"MMM DD hh:mm:ss YYYY");e.soYday=h>f?"yes":"no";e.lWeek=h>g?1:0;f=b.indexOf("\n",d);-1==f&&(f=b.length);d=b.substring(d+20,f);-1==d.indexOf(":")?d=f+1:(g=d.substring(0,d.indexOf(":")).split(" "),e.event=g[2],e.type=g[1].split(".")[1],e.details=d.substring(d.indexOf(":")+1),a.push(e),d=f+1,c++)}while(100>c&&d<b.length);return d}
function validateGivenHostName(a){var b=!0;return b=RegExp(/^(?!:\/\/)([a-zA-Z0-9]+\.)?[a-zA-Z0-9][a-zA-Z0-9-]+\.[a-zA-Z]{2,6}?$/).test(a)}
function setupLoggingCtrl(a,b,d,c){a.valid=!0;a.logId=b;a.DisplayNum=50;a.logOpts="op1";a.refresh=function(){a.enableLogging&&d.get("api/settings/log/"+a.logId).success(function(b,c,d,h){a.items=[];a.log=b;a.index=0;a.parseLog()})};a.$on("$destroy",function(){a.valid=!1});a.dateConvert=function(a,b,c){var d=a+":"+b;if(void 0!==a&&void 0!==b&&void 0!==c)return a=Number(d.match(/^(\d+)/)[1]),d=Number(d.match(/:(\d+)/)[1]),"PM"==c&&12>a&&(a+=12),"AM"==c&&12==a&&(a-=12),c=a.toString(),b=d.toString(),
10>a&&(c="0"+c),10>d&&(b="0"+b),c+":"+b+":00"};a.viewOpts=function(){a.showOpts=!0};a.showFiltered=function(b,c,d){a.showOpts=!1;a.filterItems=[];b=moment(b,"MMM DD hh:mm:ss YYYY");c=moment(c,"MMM DD hh:mm:ss YYYY");if(d instanceof Array)for(var h=0;h<d.length;h++)moment(d[h].time,"MMM DD hh:mm:ss YYYY")>b&&moment(d[h].time,"MMM DD hh:mm:ss YYYY")<c&&a.filterItems.push(d[h])};a.showNewLog=function(b){a.showOpts=!1};a.clearLogger=function(b){b&&(a.isOK=!0)};a.loadMore=function(b){a.DisplayNum+=50};
a.cancelOK=function(){a.isOK=!1;a.showOpts=!1};a.clearLog=function(){a.isOK=!1;c.remove({id:a.logId},function(){a.refresh()})};a.parseLog=function(){window.setTimeout(function(){a.index=parsePartial(a.items,a.log,a.index);a.$apply();a.valid&&a.index<a.log.length&&a.parseLog()},1)};a.refresh()}function compare(a,b){return a.name<b.name?-1:a.name>b.name?1:0}
function sortListItems(a){for(var b=[],d=0;d<a.length;d++){a[d].name=unescape(a[d].name);a[d].description=unescape(a[d].description);a[d].displayLabel=a[d].name;""!=a[d].description&&(a[d].displayLabel+=" ("+a[d].description+")");var c={};c.name=a[d].name.toLowerCase();c.oldName=a[d].name;b.push(c)}b.sort(compare);for(var c=[],e,d=0;d<b.length;d++)for(var f=0;f<a.length;f++)if(a[f].name===b[d].oldName){e=a[f];c.push(e);a.splice(f,1);break}return c}
function uuid(){var a="",b,d;for(b=0;32>b;b++){d=16*Math.random()|0;if(8==b||12==b||16==b||20==b)a+="-";a+=(12==b?4:16==b?d&3|8:d).toString(16)}return a}function checkDeviceIP(a){a.shownIPAddress=a.ipAddress;a.shownIP6Address=a.ipv6Address;!1==a.status&&("0.0.0.0"==a.ipAddress&&(a.shownIPAddress="n/a"),"::"==a.ipv6Address&&(a.shownIP6Address="n/a"));return a}function filterOutStb(a){for(var b=0;b<a.length;b++)a[b].isStb&&(a.splice(b,1),b--);return a}
function validateEmail(a){return/^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$/.test(a)?!0:!1}
function findTimeNow(a){var b=parseInt(a.timeZone);switch(parseInt(a.timeZone)){case -5:b="EST5EDT";break;case -6:b="CST6CDT";break;case -7:b="MST7MDT";break;case -8:b="PST8PDT";break;case -9:b="America/Anchorage";break;case -10:b="HST";break;case -11:b="MST";break;default:b="WET"}if(void 0==moment.tz)return a=window.moment.unix(a.localTime).tz(b),window.moment(a);a=moment.unix(a.localTime).tz(b);return moment(a)}
function getStatusTitle(a){switch(Number(a)){case 0:return"Updated";case 1:return"In progress...";case 2:return"Router offline";case 3:return"DDNS server offline";case 4:return"Failed - Settings";case 5:return"Failed - Other";case 6:return"DDNS Server Error"}}function validateSubMask(a){return 255>a[0]||255>a[1]||254>a[2]?!1:!0}
function checkHostVsSubmask(a,b){var d=!1;return d="255"==b[0]&&"255"==b[1]&&"255"==b[2]&&"255"==b[3]?!0:"255"==b[0]&&"255"==b[1]&&"255"==b[2]&&"254"==b[3]?!0:"255"==b[0]&&"255"==b[1]&&"255"==b[2]&&"252"==b[3]?checkHostVsSubmaskRange(a,4):"255"==b[0]&&"255"==b[1]&&"255"==b[2]&&"248"==b[3]?checkHostVsSubmaskRange(a,8):"255"==b[0]&&"255"==b[1]&&"255"==b[2]&&"240"==b[3]?checkHostVsSubmaskRange(a,16):"255"==b[0]&&"255"==b[1]&&"255"==b[2]&&"224"==b[3]?checkHostVsSubmaskRange(a,32):"255"==b[0]&&"255"==
b[1]&&"255"==b[2]&&"192"==b[3]?checkHostVsSubmaskRange(a,64):"255"==b[0]&&"255"==b[1]&&"255"==b[2]&&"128"==b[3]?checkHostVsSubmaskRange(a,128):"255"==b[0]&&"255"==b[1]&&"255"==b[2]&&"0"==b[3]?checkHostVsSubmaskRange(a,256):"255"==b[0]&&"255"==b[1]&&"254"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges(a,256,2):"255"==b[0]&&"255"==b[1]&&"252"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges(a,256,4):"255"==b[0]&&"255"==b[1]&&"248"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges(a,256,8):"255"==b[0]&&"255"==b[1]&&"240"==
b[2]&&"0"==b[3]?checkHostVsSubmaskRanges(a,256,16):"255"==b[0]&&"255"==b[1]&&"224"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges(a,256,32):"255"==b[0]&&"255"==b[1]&&"192"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges(a,256,64):"255"==b[0]&&"255"==b[1]&&"128"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges(a,256,128):"255"==b[0]&&"255"==b[1]&&"0"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges(a,256,256):"255"==b[0]&&"254"==b[1]&&"0"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges1(a,256,2):"255"==b[0]&&"252"==b[1]&&"0"==b[2]&&
"0"==b[3]?checkHostVsSubmaskRanges1(a,256,4):"255"==b[0]&&"248"==b[1]&&"0"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges1(a,256,8):"255"==b[0]&&"240"==b[1]&&"0"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges1(a,256,16):"255"==b[0]&&"224"==b[1]&&"0"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges1(a,256,32):"255"==b[0]&&"192"==b[1]&&"0"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges1(a,256,64):"255"==b[0]&&"128"==b[1]&&"0"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges1(a,256,128):"255"==b[0]&&"0"==b[1]&&"0"==b[2]&&"0"==b[3]?
checkHostVsSubmaskRanges1(a,256,256):"254"==b[0]&&"0"==b[1]&&"0"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges2(a,256,2):"252"==b[0]&&"0"==b[1]&&"0"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges2(a,256,4):"248"==b[0]&&"0"==b[1]&&"0"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges2(a,256,8):"240"==b[0]&&"0"==b[1]&&"0"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges2(a,256,16):"224"==b[0]&&"0"==b[1]&&"0"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges2(a,256,32):"192"==b[0]&&"0"==b[1]&&"0"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges2(a,
256,64):"128"==b[0]&&"0"==b[1]&&"0"==b[2]&&"0"==b[3]?checkHostVsSubmaskRanges2(a,256,128):!0}function checkHostVsSubmaskRange(a,b){var d=!1;""==String(a[3])&&(d=!0);if(255<a[3]||0>a[3])d=!0;if(0==a[3]%b||a[3]%b==b-1)d=!0;return d}function checkHostVsSubmaskRanges(a,b,d){var c=!1;""==String(a[3])&&(c=!0);if(255<a[3]||0>a[3])c=!0;0==a[2]%d&&0==a[3]%b&&(c=!0);a[2]%d==d-1&&a[3]%b==b-1&&(c=!0);return c}
function checkHostVsSubmaskRanges1(a,b,d){b=!1;""==String(a[3])&&(b=!0);if(255<a[3]||0>a[3])b=!0;0==a[1]%d&&0==a[3]&&0==a[2]&&(b=!0);a[1]%d==d-1&&255==a[3]&&255==a[2]&&(b=!0);return b}function checkHostVsSubmaskRanges2(a,b,d){b=!1;""==String(a[3])&&(b=!0);if(255<a[3]||0>a[3])b=!0;0==a[0]%d&&0==a[3]&&0==a[2]&&0==a[1]&&(b=!0);a[0]%d==d-1&&255==a[3]&&255==a[2]&&255==a[1]&&(b=!0);return b}
function checkForValidSubnetMaskRange(a){var b=!1;if("255"==a[0]&&"255"==a[1]&&"255"==a[2])switch(String(a[3])){case "252":case "248":case "240":case "224":case "192":case "128":case "0":b=!1;break;default:b=!0}else if("255"==a[0]&&"255"==a[1]&&"0"==a[3])switch(String(a[2])){case "255":case "254":case "252":case "248":case "240":case "224":case "192":case "128":case "0":b=!1;break;default:b=!0}else if("255"==a[0]&&"0"==a[2]&&"0"==a[3])switch(String(a[1])){case "255":case "254":case "252":case "248":case "240":case "224":case "192":case "128":case "0":b=
!1;break;default:b=!0}else b=!0;return b}
function checkForValidSubnetMaskRangeBroadband(a){var b=!1;if("255"==a[0]&&"255"==a[1]&&"255"==a[2])switch(String(a[3])){case "252":case "248":case "240":case "224":case "192":case "128":case "0":b=!1;break;default:b=!0}else if("255"==a[0]&&"255"==a[1]&&"0"==a[3])switch(String(a[2])){case "255":case "254":case "252":case "248":case "240":case "224":case "192":case "128":case "0":b=!1;break;default:b=!0}else if("255"==a[0]&&"0"==a[2]&&"0"==a[3])switch(String(a[1])){case "255":case "254":case "252":case "248":case "240":case "224":case "192":case "128":case "0":b=!1;
break;default:b=!0}else if("0"==a[1]&&"0"==a[2]&&"0"==a[3])switch(String(a[0])){case "255":case "254":case "252":case "248":case "240":b=!1;break;default:b=!0}else b=!0;return b}
function checkFullListOfSubnetMaskRange(a){var b=!1;return b="0"==a[0]&&"0"==a[1]&&"0"==a[2]&&"0"==a[3]?!0:"255"!=a[0]||"255"!=a[1]||"255"!=a[2]||checkSubListOfSubnetMaskRange(a[3])?"255"!=a[0]||"255"!=a[1]||checkSubListOfSubnetMaskRange(a[2])||"0"!=String(a[3])?"255"!=a[0]||checkSubListOfSubnetMaskRange(a[1])||"0"!=String(a[2])||"0"!=String(a[3])?checkSubListOfSubnetMaskRange(a[0])||"0"!=String(a[1])||"0"!=String(a[2])||"0"!=String(a[3])?!0:!1:!1:!1:!1}
function checkSubListOfSubnetMaskRange(a){var b=!1;switch(String(a)){case "255":case "254":case "252":case "248":case "240":case "224":case "192":case "128":case "0":b=!1;break;default:b=!0}return b}function isIPWithinRange(a,b,d){var c=!1;a=calDevices(a);b=calDevices(b);d=calDevices(d);b<=a&&a<=d&&(c=!0);return c}
function calDevices(a){var b=0;0!=Number(a[0])&&(b+=16777216*Number(a[0]));0!=Number(a[1])&&(b+=65536*Number(a[1]));0!=Number(a[2])&&(b+=256*Number(a[2]));0!=Number(a[3])&&(b+=Number(a[3]));return b}function checkIPRange(a,b){var d=!0;256<calDevices(b)-calDevices(a)+1&&(d=!1);return d}function checkBits(a){return 0==a[3]%2?"0":"1"}function getSubnetID(a,b){for(var d=getBinary(a),c=getBinary(b),e=[],f=[],g=0;4>g;g++)e[g]=addBinary(c[g],d[g]).toString(10),f[g]=toDecimal(e[g]);return f}
function validateDHCPRange(a,b,d,c){var e=null,e=getDHCPRange(d,c);return void 0!=e&&null!=e&&isIPWithinRange(a,e.START_ADDR,e.END_ADDR)&&isIPWithinRange(b,e.START_ADDR,e.END_ADDR)?!0:!1}function getDHCPRange(a,b){var d=null,c=null,c=c=null,d={},c=getSubnetID(a,b),d=angular.copy(c);d[3]=parseInt(d[3])+1;c=getBroadCastAddress(b,c);c=angular.copy(c);c[3]=parseInt(c[3])-1;return d={START_ADDR:d,END_ADDR:c}}
function getBroadCastAddress(a,b){getBinary(a);for(var d=getBinary(b),c=getInverseBinary(a),e=[],f=[],g=0;4>g;g++)e[g]=orBinary(c[g],d[g]).toString(10),f[g]=toDecimal(e[g]);return f}function orBinary(a,b){for(var d=[],c,e=0;8>e;e++)d[e]=(parseInt(a[e])|parseInt(b[e])).toString(10),c=0==e?d[e]:c+d[e];return c}function getInverseBinary(a){for(var b=[],d=0;4>d;d++)b[d]=toInverseBinary(a[d]);return b}
function toInverseBinary(a){a=parseInt(a,10).toString(2);for(var b,d=[1,1,1,1,1,1,1,1],c=0;8>c;c++)b=0==c?parseInt(parseInt(d[c])^parseInt(a[c])).toString(10):b+parseInt(parseInt(d[c])^parseInt(a[c])).toString(10);return b}function addBinary(a,b){for(var d=[],c,e=0;8>e;e++)d[e]=(parseInt(a[e])&parseInt(b[e])).toString(10),c=0==e?d[e]:c+d[e];return c}function getBinary(a){for(var b=[],d=0;4>d;d++)b[d]=toBinary(a[d]);return b}
function toBinary(a){a=parseInt(a,10).toString(2);var b=null;if(8>a.length){for(var b="0",d=8-a.length;1<d;d--)b+="0";b+=a}null==b&&(b=a);return b}var toDecimal=function(a){return parseInt(a,2).toString(10)};angular.module("wireless.controllers",[]).controller("WirelessCtrl",["$scope","$route","Wireless","$rootScope",function(a,b,d,c){a.tab=b.current.tab;a.section=b.current.section;a.wirelessName=["2.4 GHz","5 GHz"];a.nMode=["Performance Mode","N Only Mode"];a.wirelessInterfaces=d.query(function(){for(var b=0;b<a.wirelessInterfaces.length;b++)a.wirelessInterfaces[b].security.wpa.key=unescape(a.wirelessInterfaces[b].security.wpa.key),a.wirelessInterfaces[b].ssid=unescape(a.wirelessInterfaces[b].ssid);
a.wep=[];a.wep.push(a.wirelessInterfaces[0].security.wep.settings[a.wirelessInterfaces[0].security.wep.activeSetting]);a.wep.push(a.wirelessInterfaces[1].security.wep.settings[a.wirelessInterfaces[1].security.wep.activeSetting]);c.wpsLinkEnable=a.wirelessInterfaces[0].radioEnabled||a.wirelessInterfaces[1].radioEnabled?!0:!1})}]).controller("WirelessAdvanceCtrl",["$scope","$route","Wireless",function(a,b,d){a.wirelessInterfaces=d.query(function(){})}]).controller("WirelessBasicCtrl",["$scope","$route",
"Wireless","securityTips","$timeout","WPS","$rootScope",function(a,b,d,c,e,f,g){a.tab=b.current.tab;a.section=b.current.section;a.errorMessages=[];a.showErrorPage=!1;a.saveChannel=!1;a.hasApplyChanges=!1;a.isW24WEPOn=!1;a.wpsIsEnabled=!1;var h=d.query(function(){a.wirelessA=h[0];a.wirelessB=h[1];a.saveChannel=a.wirelessA.saveChannel;a.wepA={keyLength:a.wirelessA.security.wep.settings[a.wirelessA.security.wep.activeSetting].keyLength,entryMethod:a.wirelessA.security.wep.settings[a.wirelessA.security.wep.activeSetting].entryMethod,
key:a.wirelessA.security.wep.settings[a.wirelessA.security.wep.activeSetting].key};a.wepB={keyLength:a.wirelessB.security.wep.settings[a.wirelessB.security.wep.activeSetting].keyLength,entryMethod:a.wirelessB.security.wep.settings[a.wirelessB.security.wep.activeSetting].entryMethod,key:a.wirelessB.security.wep.settings[a.wirelessB.security.wep.activeSetting].key};a.wepChanged(a.wepA);a.wepChanged(a.wepB);a.oldAType=a.wirelessA.security.type;a.oldBType=a.wirelessB.security.type;a.wirelessA.ssid=unescape(a.wirelessA.ssid);
a.wirelessB.ssid=unescape(a.wirelessB.ssid);a.wAtype=a.wirelessA.security.enabled?0==a.wirelessA.security.type?0:1:1;a.wBtype=a.wirelessB.security.enabled?0==a.wirelessB.security.type?0:1:1;a.isW24WEPOn=a.wAtype;g.wpsLinkEnable=a.wirelessA.radioEnabled||a.wirelessB.radioEnabled?!0:!1;a.hasApplyChanges=!1;var b=f.get({id:0},function(){a.wpsIsEnabled=b.enabled;a.wpsIsEnabled=a.wpsIsEnabled?!0:!1})});a.rdbtnChange=function(b){1==b&&c.showWEPMessage().then(function(b){"cancel"!=b&&a.wirelessUpdate()})};
a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.wepChanged=function(a){var b=10,b=0==a.keyLength?0==a.entryMethod?10:5:0==a.entryMethod?26:13;a.key.length>b&&(a.key=a.key.substr(0,b));a.charactersLeft=b-a.key.length};a.validateSsid=function(b,c){(1>b.length||64<b.length||!/^[0-9a-zA-Z\!\"\#\$\%\&\u2019\'\(\)\*\+\,\-\.\/\:\;\<\=\>\?\@\[\\\]\^\_\`\{\|\}\~\ ]+$/i.test(b))&&a.errorMessages.push(c+" Service Set Identifier must consist of 1 to 64 characters and must not contain any special character.")};
a.wirelessUpdate=function(){a.wirelessA.ssid=encodeURIComponent(a.wirelessA.ssid);a.wirelessB.ssid=encodeURIComponent(a.wirelessB.ssid);a.hasApplyChanges=!0;a.wirelessA.$update(function(){a.wirelessB.$update(function(){c.showSaving("Save Settings","Saving your settings. Please wait...",15E3)})})};a.checkWEP=function(){a.wirelessA.radioEnabled&&0==a.wAtype&&a.wpsIsEnabled&&4==a.wirelessA.mode?a.enableWEP():a.wirelessA.radioEnabled&&0==a.wAtype&&(a.wpsIsEnabled||1==a.wirelessA.mode||8==a.wirelessA.mode)?
a.enableWEP1():a.wirelessA.radioEnabled&&1==a.wAtype&&0==a.isW24WEPOn?a.rdbtnChange(a.wAtype):a.wirelessUpdate()};a.enableWEP=function(){c.showCustomMessage("Warning",["If WEP is enabled for the 2.4 GHz wireless network, then WPS will be disabled for the 2.4 GHz wireless network.","Are you sure you want to enable WEP?"]).then(function(b){"cancel"!=b&&a.wirelessUpdate()})};a.enableWEP1=function(){c.showCustomMessage1("Warning",["Turning on WEP will change your 2.4 GHz wireless mode to Legacy Mode (802.11b/g) and disable Wi-Fi Protected Setup.",
"Press OK to continue or Cancel."]).then(function(b){"cancel"!=b&&(a.wirelessA.mode=4,a.wirelessUpdate())})};a.save=function(){!1==a.hasApplyChanges&&(a.errorMessages=[],a.wirelessA.channelDesired=parseInt(a.wirelessA.channelDesired),a.wirelessB.channelDesired=parseInt(a.wirelessB.channelDesired),a.wepA.keyLength=parseInt(a.wepA.keyLength),a.wepA.entryMethod=parseInt(a.wepA.entryMethod),a.wepB.keyLength=parseInt(a.wepB.keyLength),a.wepB.entryMethod=parseInt(a.wepB.entryMethod),0==a.wAtype&&validateWepSettings(a.wepA,
!0,"2.4 GHz Wireless",a.errorMessages),0==a.wBtype&&validateWepSettings(a.wepB,!0,"5.0 GHz Wireless",a.errorMessages),a.validateSsid(a.wirelessA.ssid,"2.4 GHz Wireless"),a.validateSsid(a.wirelessB.ssid,"5.0 GHz Wireless"),0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.wirelessA.saveChannel=a.saveChannel,a.wirelessB.saveChannel=a.saveChannel,0==a.wAtype?(a.wirelessA.security.type=0,a.wirelessA.security.wep.settings[a.wirelessA.security.wep.activeSetting]=a.wepA,a.wirelessA.security.enabled=
!0):0==a.oldAType?a.wirelessA.security.enabled=!1:1==a.wAtype&&(a.wirelessA.security.type=a.oldAType),a.checkWEP()))}}]).controller("WirelessSSIDBroadcast",["$scope","$route","$routeParams","$location","Wireless","securityTips",function(a,b,d,c,e,f){a.tab=b.current.tab;a.section=b.current.section;var g=d.id;a.wirelessName=0==g?"2.4 GHz":"5 GHz";var h=e.get({id:g},function(){a.ssidBroadcast=h.ssidBroadcast});a.wirelessUpdate=function(){e.update({id:g},{ssidBroadcast:a.ssidBroadcast},function(){c.path("/wireless/advanced")})};
a.save=function(){a.ssidBroadcast?a.wirelessUpdate():f.showCustomMessage("Warning",["If SSID Broadcast is disabled for the "+a.wirelessName+" wireless network, and then WPS will also be disabled for the "+a.wirelessName+" wireless network.","Are you sure you want to disable SSID Broadcast?"]).then(function(b){"cancel"!=b&&a.wirelessUpdate()})}}]).controller("WirelessMode",["$scope","$route","$location","Wireless","securityTips",function(a,b,d,c,e){a.tab=b.current.tab;a.section=b.current.section;var f=
c.query(function(){a.modeA=f[0].mode;a.modeB=f[1].mode;a.wirelessAEnabled=f[0].radioEnabled;a.wAtype=f[0].security.enabled?0==f[0].security.type?0:1:1});a.wirelessUpdate=function(){c.update({id:0},{mode:parseInt(a.modeA)},function(){c.update({id:1},{mode:parseInt(a.modeB)},function(){d.path("/wireless/advanced")})})};a.enableWEP=function(){0!=a.wAtype||!a.wirelessAEnabled||1!=a.modeA&&8!=a.modeA?a.wirelessUpdate():e.showCustomMessage2("Warning",["Compatibility Mode and Performance Mode are not compatible with WEP security. You must first select WPA/WPA2 Mixed Mode or WPA2 security before enabling Compatibility or Performance mode."])};
a.save=function(){a.enableWEP()}}]).controller("WirelessTransmissionCtrl",["$scope","$route","$routeParams","$location","WirelessTransmission",function(a,b,d,c,e){a.tab=b.current.tab;a.section=b.current.section;a.errorMessages=[];a.showErrorPage=!1;a.confirmed=!(null!=d.warn&&"true"==d.warn);a.trans1=e.get({id:0});a.trans2=e.get({id:1});a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.save=function(){a.errorMessages=[];a.trans1.ctsProtection=parseInt(a.trans1.ctsProtection);a.trans1.ctsProtectionType=
parseInt(a.trans1.ctsProtectionType);a.trans2.ctsProtection=parseInt(a.trans2.ctsProtection);a.trans2.ctsProtectionType=parseInt(a.trans2.ctsProtectionType);validateTransmissionSettings(a.trans1,"2.4 GHz Wireless",a.errorMessages);validateTransmissionSettings(a.trans2,"5.0 GHz Wireless",a.errorMessages);0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.trans1.channelWidth=parseInt(a.trans1.channelWidth),a.trans2.channelWidth=parseInt(a.trans2.channelWidth),a.trans1.$update({id:0},
function(){a.trans2.$update({id:1},function(){c.path("/wireless/advanced")})}))}}]).controller("WirelessWmmCtrl",["$scope","$route","$routeParams","$location","WirelessWmm",function(a,b,d,c,e){a.tab=b.current.tab;a.section=b.current.section;a.wirelessName=0==d.id?"2.4 GHz":"5 GHz";a.qos=e.get({id:d.id});a.enabledClick=function(){a.qos.enabled||(a.qos.powerSave=!1)};a.save=function(){a.qos.$update({id:d.id},function(){location.reload()})}}]).controller("WirelessWEPCtrl",["$scope","$route","$routeParams",
"$location","WEP","securityTips","WPS","Wireless",function(a,b,d,c,e,f,g,h){a.tab=b.current.tab;a.section=b.current.section;a.showErrorPage=!1;a.errorMessages=[];var k=d.id;a.wirelessName=0==k?"2.4 GHz":"5 GHz";a.wep=e.get({id:k},function(){var b=g.get({id:0},function(){a.wpsIsEnabled=b.enabled;a.wirelessCmd=h.query(function(){a.wirelessACmd=a.wirelessCmd[0];a.wpsIsEnabled=a.wpsIsEnabled?!0:!1;a.ipAddress=splitIpArr(a.wep.serverIp)})})});a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,
0)};a.wepChanged=function(b){b=a.wep.settings[b];var c=10,c=0==b.keyLength?0==b.entryMethod?10:5:0==b.entryMethod?26:13;b.key.length>c&&(b.key=b.key.substr(0,c))};a.wirelessUpdate=function(b){e.update({id:k},{activeSetting:a.wep.activeSetting,mode:a.wep.mode,authenticationType:a.wep.authenticationType,settings:a.wep.settings},function(){1==b?h.update({id:0},{mode:4},function(){c.path("/wireless/advanced")}):c.path("/wireless/advanced")})};a.checkWEP=function(){a.wirelessACmd.radioEnabled&&a.wpsIsEnabled&&
4==a.wirelessACmd.mode?a.enableWEP():a.wirelessACmd.radioEnabled&&(a.wpsIsEnabled||1==a.wirelessACmd.mode||8==a.wirelessACmd.mode)?a.enableWEP1():a.wirelessUpdate(0)};a.enableWEP=function(){f.showCustomMessage("Warning",["If WEP is enabled for the 2.4 GHz wireless network, then WPS will be disabled for the 2.4 GHz wireless network.","Are you sure you want to enable WEP?"]).then(function(b){"ok"==b&&a.wirelessUpdate(0)})};a.enableWEP1=function(){f.showCustomMessage1("Warning",["Turning on WEP will change your 2.4 GHz wireless mode to Legacy Mode (802.11b/g) and disable Wi-Fi Protected Setup.",
"Press OK to continue or Cancel."]).then(function(b){"ok"==b&&a.wirelessUpdate(1)})};a.save=function(){a.errorMessages=[];a.wep.authenticationType=parseInt(a.wep.authenticationType);for(var b=0;b<a.wep.settings.length;b++)a.wep.settings[b].entryMethod=parseInt(a.wep.settings[b].entryMethod),a.wep.settings[b].keyLength=parseInt(a.wep.settings[b].keyLength),validateWepSettings(a.wep.settings[b],b==a.wep.activeSetting,"Key #"+(b+1),a.errorMessages);0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,
0)):a.checkWEP()}}]).controller("WirelessWPACtrl",["$scope","$route","$routeParams","$location","WPA",function(a,b,d,c,e){a.tab=b.current.tab;a.section=b.current.section;a.whichKey=1;a.keyType=0;a.errorMessages=[];a.showErrorPage=!1;var f=d.id;a.wirelessName=0==f?"2.4 GHz":"5 GHz";a.wpaType=0==b.current.wpa?"WPA2/WPA mixed mode":"WPA2";a.wpa=e.get({id:f},function(){a.wpa.key=unescape(a.wpa.key);a.wpa.type=b.current.wpa});a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.validateWpaKey=
function(b){8>b.length&&a.errorMessages.push("Pre-Shared Key: Pass-Phrase has to be at least 8 characters long.")};a.save=function(){a.errorMessages=[];a.wpa.groupKeyUpdateIntervalEnabled&&(isNaN(a.wpa.groupKeyUpdateInterval)||900>a.wpa.groupKeyUpdateInterval||86400<a.wpa.groupKeyUpdateInterval)&&a.errorMessages.push("Group Key Update Interval: Please enter a numeric value between 900 and 86400.");a.validateWpaKey(a.wpa.key);0!=a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.wpa.groupKeyUpdateIntervalEnabled||
(a.wpa.groupKeyUpdateInterval=0),a.wpa.encryptionAlgorithm=parseInt(a.wpa.encryptionAlgorithm),e.update({id:f},{type:a.wpa.type,mode:a.wpa.mode,encryptionAlgorithm:a.wpa.encryptionAlgorithm,groupKeyUpdateInterval:a.wpa.groupKeyUpdateInterval,groupKeyUpdateIntervalEnabled:a.wpa.groupKeyUpdateIntervalEnabled,key:escape(a.wpa.key).replace(/\+/g,"%2B")},function(){c.path("/wireless/advanced")}))}}]).controller("WirelessMACFilterCtrl",["$scope","$route","$location","WirelessMACFilter",function(a,b,d,c){a.tab=
b.current.tab;a.section=b.current.section;a.newMac="";a.filter0=c.get({id:0});a.filter1=c.get({id:1});a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.checkFilters=function(b){for(var c=0;c<b.length;c++)if(17!=b[c].length||!validateMac(b[c])||/[0\:]{17}$/.test(b[c])||/[f\:]{17}$/i.test(b[c])||parseInt(b[c].split(":")[0],16)&1){a.errorMessages.push("Invalid MAC Address format: Please try again.");break}};a.save=function(){a.errorMessages=[];a.checkFilters(a.filter0.macs);0==a.errorMessages.length&&
a.checkFilters(a.filter1.macs);0<a.errorMessages.length?(a.showErrorPage=!0,window.scrollTo(0,0)):(a.filter0.mode=parseInt(a.filter0.mode),a.filter1.mode=parseInt(a.filter1.mode),a.filter0.$update({id:0},function(){a.filter1.$update({id:1},function(){d.path("/wireless/advanced")})}))};a.removeMac=function(b,c){0==b?a.filter0.macs.splice(c,1):a.filter1.macs.splice(c,1)};a.addFilter=function(b){if(0==b){if(0!=a.newMac0.replace(/^\s+|\s+$/g,"").length){for(b=0;b<a.filter0.macs.length;b++)if(a.newMac0==
a.filter0.macs[b])return;a.filter0.macs.push(a.newMac0)}}else if(0!=a.newMac1.replace(/^\s+|\s+$/g,"").length){for(b=0;b<a.filter1.macs.length;b++)if(a.newMac1==a.filter1.macs[b])return;a.filter1.macs.push(a.newMac1)}}}]).controller("WifiSetupCtrl",["$scope","$route","$location","WPS","Devices","Wireless","securityTips","WirelessMACFilter",function(a,b,d,c,e,f,g,h){a.tab=b.current.tab;a.section=b.current.section;a.valid=!0;a.apLockDown=!1;a.erEnabled=!1;a.apPin="";a.erCanEnabled=!0;a.onlyNumbers=
/^\d+$/;a.wirelessWpsAreOn=!0;a.filtersAreFine=!0;a.$on("$destroy",function(){a.valid=!1});var k=0;a.refresh=function(){var b=c.get({id:0},function(){var c=f.query(function(){a.filter0=h.get({id:0},function(){a.filter1=h.get({id:1},function(){a.wirelessWpsAreOn=!0;a.filtersAreFine=!0;a.filter0.enabled&&0==a.filter0.mode&&0==a.filter0.macs.length||(a.filtersAreFine=!1);a.filter1.enabled&&0==a.filter1.mode&&0==a.filter1.macs.length||(a.filtersAreFine=!1);a.wire0=c[0].radioEnabled;a.wire1=c[1].radioEnabled;
var d=c[0].wpsEnabled,e=c[1].wpsEnabled;a.wire0||a.wire1||(a.wirelessWpsAreOn=!1);d||e||(a.wirelessWpsAreOn=!1);if(!0==b.apLockDown||!1==b.apLockDown)a.apLockDown=b.apLockDown;if(!0==b.erEnabled||!1==b.erEnabled)a.erEnabled=b.erEnabled;if(b.apPin)for(a.apPin=b.apPin;8>String(a.apPin).length;)a.apPin="0"+String(a.apPin);""!=a.apPin&&(a.erCanEnabled=!1);a.enabled=b.enabled;a.enabled&&!a.wirelessWpsAreOn&&(a.enabled=!1);a.trigger=b.trigger;d=!1;!0==a.isCancelled&&(b.status=0,a.timeString="",a.isCancelled=
!1);if(0==a.currentStep)0!=b.status&&(a.currentStep=1,k=(new Date).getTime(),a.timeString="2 minutes",d=!0);else if(3==a.currentStep)3==b.lastStatus?a.currentStep=5:4==b.lastStatus?(a.mac=b.device,a.currentStep=4):0==b.status&&1==b.lastStatus?a.currentStep=0:d=!0;else if(1==a.currentStep||2==a.currentStep){2==b.status?(a.currentStep=3,d=!0):3==b.lastStatus?a.currentStep=5:4==b.lastStatus?(a.mac=b.device,a.currentStep=4):0==b.status&&1==b.lastStatus?a.currentStep=0:d=!0;if(!d)return;e=120-Math.floor(((new Date).getTime()-
k)/1E3);if(0>=e){a.currentStep=5;return}d=Math.floor(e/60);e%=60;a.timeString="";0<d&&(a.timeString=d+" minute"+(1<d?"s":"")+(0<e?", ":""));0<e&&(a.timeString+=e+" second"+(1<e?"s":""));d=!0}d&&a.valid&&window.setTimeout(a.refresh,1E3)})})})})};a.refresh();a.currentStep=0;a.clientWpsPin="";a.toggleOnOffSave=function(){c.update({id:0},{enabled:!a.enabled},function(){a.currentStep=0;a.refresh()})};a.toggleOnOff=function(){a.enabled?a.toggleOnOffSave():a.wire0||a.wire1?a.wirelessWpsAreOn||a.filtersAreFine?
a.toggleOnOffSave():g.showCustomMessage3("Warning",["Wi-Fi Protected Setup (WPS) cannot be used if WEP security is enabled or SSID broadcast is disabled or if MAC address authentication is enabled with an empty white list.","To use WPS, change your wireless security mode and/or enable SSID broadcast and/or add a MAC address to the mac authentication table."]):g.showCustomMessage3("Warning",["Wi-Fi Protected Setup (WPS) is disabled because both Wi-Fi radios(2.4GHz and 5GHz) have been turned off.",
"Please enable Wi-Fi on one or both radios to enable WPS."])};a.pushButtonConfig=function(){c.update({id:0},{trigger:!a.trigger,pin:""},function(){k=(new Date).getTime();a.currentStep=1;window.setTimeout(a.testConnection,3E3)})};a.testConnection=function(){a.refresh()};a.errorPageOk=function(){a.showErrorPage=!1;window.scrollTo(0,0)};a.register=function(){a.errorMessages=[];var b=!1;-1==String(a.clientWpsPin).indexOf("-")&&-1==String(a.clientWpsPin).indexOf(" ")?/^[0-9]{8}$/.test(a.clientWpsPin)||
/^[0-9]{4}$/.test(a.clientWpsPin)||(b=!0):/^[0-9- ]{9}$/.test(a.clientWpsPin)||/^[0-9- ]{5}$/.test(a.clientWpsPin)||(b=!0);b&&a.errorMessages.push("Error: Invalid PIN. Please enter a valid WPS PIN, which consists of either four or eight numeric digits, and can typically be found printed on your wireless client device or in its documentation.");if(0<a.errorMessages.length)a.showErrorPage=!0,window.scrollTo(0,0);else if(""==a.clientWpsPin)a.pushButtonConfig();else var b=a.clientWpsPin.replace(/ /g,
"").replace(/-/g,""),d=c.update({id:0},{pin:b},function(){"00000000"==d.pin?(a.errorMessages.push("Error: Invalid PIN. Please enter a valid WPS PIN, which consists of either four or eight numeric digits, and can typically be found printed on your wireless client device or in its documentation."),0<a.errorMessages.length&&(a.showErrorPage=!0,window.scrollTo(0,0))):(k=(new Date).getTime(),a.currentStep=2,window.setTimeout(a.testConnection,3E3))})};a.cancel=function(){c.update({id:0},{trigger:!a.trigger,
pin:""},function(){a.currentStep=0;a.isCancelled=!0;k=0})};a.connect=function(){a.currentStep=4};a.completed=function(){a.currentStep=0;a.clientWpsPin=""};a.sendErEnabled=function(b){c.update({id:0},{erEnabled:b},function(){a.refresh()})}}]);
